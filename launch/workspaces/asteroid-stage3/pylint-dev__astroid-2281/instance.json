{
  "all_hints_text": "Hi thanks, for the report.\r\n\r\nRegarding v. 2.0, even then the `AstroidManager` was already documented as a singleton/borg, so it was already acting like a wrapper for class constants. Do you have an example of code that worked on 2.0 by manipulating instance attributes that doesn't work on 3.0.0a9?\r\n\r\nIn 2.0, the instance of an AstroidManager used to get the limit is a module constant. Without seeing a reproducer in more detail, it's hard to see where your expectations are being violated. Any more concrete info you can provide will be appreciated.\nThanks for your answer.\r\n\r\nIndeed, thanks to your comment, I better understand what was done in 2.0.0.\r\n\r\nI have no example of this working with 2.0.0, I only referred to the documentation to show that it should be possible to tune the `max_inferable_values` by setting a flag on `astroid.MANAGER`.\r\n\r\nSo, in my case, I want to be able to change the value of `max_inferable_values` used in `NodeNG.infer`.\r\nBut, from my current understanding, `max_inferable_values` was (and is) not tunable by the user, is that right?\nIt should be tunable if you set the class variable, as opposed to the (nonexistent) instance variable. (astroid.MANAGER is an instance, astroid.manager.AstroidManager is a class).\r\n\r\nWe can improve this situation though by creating instance properties that set the class properties like #2204. I'll make a PR.\n\n",
  "base_commit": "eeb25171571e8c84a18044aa7bba80d57d7ea1ef",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/85f62fc5802ffccb847da30b4b33f5ffb3ea8963",
    "https://github.com/pylint-dev/astroid/commit/21297b3e6c594c5034a06fdcfbe847c46918ea93",
    "https://github.com/pylint-dev/astroid/commit/18f878b36c62b72fb02452b52a8d1cd74647e382",
    "https://github.com/pylint-dev/astroid/commit/f205d8a2ea270a9ea2c64eed5a2034c1a60815f9"
  ],
  "created_at": "2023-08-21T12:32:08Z",
  "hints_text": "Hi thanks, for the report.\r\n\r\nRegarding v. 2.0, even then the `AstroidManager` was already documented as a singleton/borg, so it was already acting like a wrapper for class constants. Do you have an example of code that worked on 2.0 by manipulating instance attributes that doesn't work on 3.0.0a9?\r\n\r\nIn 2.0, the instance of an AstroidManager used to get the limit is a module constant. Without seeing a reproducer in more detail, it's hard to see where your expectations are being violated. Any more concrete info you can provide will be appreciated.\n\n",
  "instance_id": "pylint-dev__astroid-2281",
  "issue_numbers": [
    2280
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 5b2ff4d0bb..8d8b068cd9 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -326,6 +326,11 @@ Release date: 2023-03-06\n \n   Refs #1780\n \n+* ``max_inferable_values`` can now be set on ``AstroidManager`` instances, e.g. ``astroid.MANAGER``\n+  besides just the ``AstroidManager`` class itself.\n+\n+  Closes #2280\n+\n * ``Astroid`` now retrieves the default values of keyword only arguments and sets them on\n   ``Arguments.kw_defaults``.\n \ndiff --git a/astroid/manager.py b/astroid/manager.py\nindex 8a57894c0f..65622cfa14 100644\n--- a/astroid/manager.py\n+++ b/astroid/manager.py\n@@ -59,10 +59,10 @@ class AstroidManager:\n         \"_failed_import_hooks\": [],\n         \"always_load_extensions\": False,\n         \"optimize_ast\": False,\n+        \"max_inferable_values\": 100,\n         \"extension_package_whitelist\": set(),\n         \"_transform\": TransformVisitor(),\n     }\n-    max_inferable_values: ClassVar[int] = 100\n \n     def __init__(self) -> None:\n         # NOTE: cache entries are added by the [re]builder\n@@ -90,6 +90,14 @@ def optimize_ast(self) -> bool:\n     def optimize_ast(self, value: bool) -> None:\n         AstroidManager.brain[\"optimize_ast\"] = value\n \n+    @property\n+    def max_inferable_values(self) -> int:\n+        return AstroidManager.brain[\"max_inferable_values\"]\n+\n+    @max_inferable_values.setter\n+    def max_inferable_values(self, value: int) -> None:\n+        AstroidManager.brain[\"max_inferable_values\"] = value\n+\n     @property\n     def register_transform(self):\n         # This and unregister_transform below are exported for convenience\ndiff --git a/astroid/nodes/node_ng.py b/astroid/nodes/node_ng.py\nindex 7f37d4a052..a86cbb1044 100644\n--- a/astroid/nodes/node_ng.py\n+++ b/astroid/nodes/node_ng.py\n@@ -165,7 +165,7 @@ def infer(\n \n         # Limit inference amount to help with performance issues with\n         # exponentially exploding possible results.\n-        limit = AstroidManager.max_inferable_values\n+        limit = AstroidManager().max_inferable_values\n         for i, result in enumerate(self._infer(context=context, **kwargs)):\n             if i >= limit or (context.nodes_inferred > context.max_inferred):\n                 results.append(util.Uninferable)\ndiff --git a/astroid/typing.py b/astroid/typing.py\nindex 1e2e1841ce..acb5418fd5 100644\n--- a/astroid/typing.py\n+++ b/astroid/typing.py\n@@ -43,6 +43,7 @@ class AstroidManagerBrain(TypedDict):\n     _failed_import_hooks: list[Callable[[str], nodes.Module]]\n     always_load_extensions: bool\n     optimize_ast: bool\n+    max_inferable_values: int\n     extension_package_whitelist: set[str]\n     _transform: transforms.TransformVisitor\n \n",
  "problem_statement": "`max_inferable_values` is only tunable on the class\n### Steps to reproduce\r\n\r\nSet `MANAGER.max_inferable_values` to any arbitrary number:\r\n```py\r\nastroid.MANAGER.max_inferable_values = 1_000\r\n```\r\n\r\n### Current behavior\r\nthe `limit` defined in `NodeNG.infer` will still be the default limit (100).\r\nIt comes from the fact that `limit` is defined by `AstroidManager.max_inferable_values` (the class) and not the `MANAGER` instance, like it was in `2.0.0`:\r\n```py\r\nclass NodeNG:\r\n    ...\r\n    def infer(...):\r\n        ...\r\n        limit = AstroidManager.max_inferable_values  # 100\r\n        ...\r\n\r\n```\r\n\r\n### Expected behavior\r\n[Since `2.0.0`](https://pylint.readthedocs.io/projects/astroid/en/latest/changelog.html#what-s-new-in-astroid-2-0) the limit should be tunable:\r\n\r\n> _\"Limit the maximum amount of interable result in an NodeNG.infer() call to 100 by default for performance issues with variables with large amounts of possible values. The max inferable value can be tuned by setting the max_inferable_values flag on astroid.MANAGER.\"_\r\n\r\nI saw no update in the changelog regarding this, so the limit should be `1_000` in my case, not `100`.\r\n\r\n### `python -c \"from astroid import __pkginfo__; print(__pkginfo__.version)\"` output\r\n3.0.0a9\r\n(I also tried with 2.15.6)\n",
  "pull_number": 2281,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/test_manager.py b/tests/test_manager.py\nindex af3975aae1..a55fae1932 100644\n--- a/tests/test_manager.py\n+++ b/tests/test_manager.py\n@@ -405,6 +405,19 @@ def test_borg(self) -> None:\n         second_built = second_manager.ast_from_module_name(\"builtins\")\n         self.assertIs(built, second_built)\n \n+    def test_max_inferable_values(self) -> None:\n+        mgr = manager.AstroidManager()\n+        original_limit = mgr.max_inferable_values\n+\n+        def reset_limit():\n+            nonlocal original_limit\n+            manager.AstroidManager().max_inferable_values = original_limit\n+\n+        self.addCleanup(reset_limit)\n+\n+        mgr.max_inferable_values = 4\n+        self.assertEqual(manager.AstroidManager.brain[\"max_inferable_values\"], 4)\n+\n \n class ClearCacheTest(unittest.TestCase):\n     def test_clear_cache_clears_other_lru_caches(self) -> None:\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/eeb25171571e8c84a18044aa7bba80d57d7ea1ef"
}