{
  "all_hints_text": "@gpshead thanks for the report.\n\n",
  "base_commit": "efc5be48e8294cea6c5335a3ad0821fa920fd1e6",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/9d4082a518198037f5ac564ea4c111584d4d648f",
    "https://github.com/pylint-dev/astroid/commit/0cbce24ba586144114e9f51c1242523c3362a2f9",
    "https://github.com/pylint-dev/astroid/commit/dffd1bfbdeb19be77a9d2f08a2fa7d76f206d39a"
  ],
  "created_at": "2021-05-16T07:13:50Z",
  "hints_text": "@gpshead thanks for the report.\n\n",
  "instance_id": "pylint-dev__astroid-993",
  "issue_numbers": [
    922
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 9d7b945fde..6097526bbd 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -37,6 +37,10 @@ Release Date: TBA\n   Closes PyCQA/pylint#3535\n   Closes PyCQA/pylint#4358\n \n+* Update random brain to fix a crash with inference of some sequence elements\n+\n+  Closes #922\n+\n \n What's New in astroid 2.5.6?\n ============================\ndiff --git a/astroid/brain/brain_random.py b/astroid/brain/brain_random.py\nindex ee5506cbae..6efd1ff134 100644\n--- a/astroid/brain/brain_random.py\n+++ b/astroid/brain/brain_random.py\n@@ -9,6 +9,8 @@\n \n \n def _clone_node_with_lineno(node, parent, lineno):\n+    if isinstance(node, astroid.EvaluatedObject):\n+        node = node.original\n     cls = node.__class__\n     other_fields = node._other_fields\n     _astroid_fields = node._astroid_fields\n",
  "problem_statement": "__init__() got an unexpected keyword argument 'lineno' from brain_random.py\n### Steps to reproduce & current behavior\r\n```\r\n~/tempenv$ pylint --version\r\npylint 2.7.2\r\nastroid 2.5.1\r\nPython 3.8.7 (default, Dec 22 2020, 10:37:26)\r\n[GCC 10.2.0]\r\n(tempenv) ~/tempenv$ cat example.py\r\nclass A:\r\n    pass\r\n\r\nb = sample(list({1: A()}.values()), 1)\r\n(tempenv) ~/tempenv$ pylint example.py\r\n************* Module example\r\nexample.py:1:0: C0114: Missing module docstring (missing-module-docstring)\r\nexample.py:1:0: C0103: Class name \"A\" doesn't conform to PascalCase naming style (invalid-name)\r\nexample.py:1:0: C0115: Missing class docstring (missing-class-docstring)\r\nexample.py:1:0: R0903: Too few public methods (0/2) (too-few-public-methods)\r\nTraceback (most recent call last):\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/astroid/__init__.py\", line 94, in _inference_tip_cached\r\n    return iter(_cache[func, node])\r\nKeyError: (<function infer_random_sample at 0x7f5d412c5940>, <Call l.4 at 0x7f5d40decf70>)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/gps/tempenv/bin/pylint\", line 8, in <module>\r\n    sys.exit(run_pylint())\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/__init__.py\", line 22, in run_pylint\r\n    PylintRun(sys.argv[1:])\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/lint/run.py\", line 358, in __init__\r\n    linter.check(args)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/lint/pylinter.py\", line 862, in check\r\n    self._check_files(\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/lint/pylinter.py\", line 896, in _check_files\r\n    self._check_file(get_ast, check_astroid_module, name, filepath, modname)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/lint/pylinter.py\", line 922, in _check_file\r\n    check_astroid_module(ast_node)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/lint/pylinter.py\", line 1054, in check_astroid_module\r\n    retval = self._check_astroid_module(\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/lint/pylinter.py\", line 1099, in _check_astroid_module\r\n    walker.walk(ast_node)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/utils/ast_walker.py\", line 75, in walk\r\n    self.walk(child)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/utils/ast_walker.py\", line 75, in walk\r\n    self.walk(child)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/utils/ast_walker.py\", line 72, in walk\r\n    callback(astroid)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/checkers/base.py\", line 1968, in visit_assignname\r\n    if isinstance(utils.safe_infer(assign_type.value), astroid.ClassDef):\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/pylint/checkers/utils.py\", line 1205, in safe_infer\r\n    value = next(infer_gen)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/astroid/node_classes.py\", line 360, in infer\r\n    yield from self._explicit_inference(self, context, **kwargs)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/wrapt/wrappers.py\", line 566, in __call__\r\n    return self._self_wrapper(self.__wrapped__, self._self_instance,\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/astroid/__init__.py\", line 96, in _inference_tip_cached\r\n    result = func(*args, **kwargs)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/astroid/brain/brain_random.py\", line 56, in infer_random_sample\r\n    new_elts = [\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/astroid/brain/brain_random.py\", line 57, in <listcomp>\r\n    _clone_node_with_lineno(elt, parent=new_node, lineno=new_node.lineno)\r\n  File \"/home/gps/tempenv/lib/python3.8/site-packages/astroid/brain/brain_random.py\", line 21, in _clone_node_with_lineno\r\n    new_node = cls(**init_params)\r\nTypeError: __init__() got an unexpected keyword argument 'lineno'\r\n```\r\n\r\n### Expected behavior\r\nA successful pylint run, probably highlighting that `simple` is undefined.\r\n\r\n### ``python -c \"from astroid import __pkginfo__; print(__pkginfo__.version)\"`` output\r\n2.5.1\r\n\r\n\r\nIf this winds up being a pylint issue, I guess refile it over there.  I filed here based on the bottom the traceback but that doesn't mean the problem originated in astroid.  I haven't spent time looking at the code.\n",
  "pull_number": 993,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_brain.py b/tests/unittest_brain.py\nindex 0e8c591198..26fad2e3bf 100644\n--- a/tests/unittest_brain.py\n+++ b/tests/unittest_brain.py\n@@ -1858,6 +1858,18 @@ def test_inferred_successfully(self):\n         elems = sorted(elem.value for elem in inferred.elts)\n         self.assertEqual(elems, [1, 2])\n \n+    def test_no_crash_on_evaluatedobject(self):\n+        node = astroid.extract_node(\n+            \"\"\"\n+        from random import sample\n+        class A: pass\n+        sample(list({1: A()}.values()), 1)\"\"\"\n+        )\n+        inferred = next(node.infer())\n+        assert isinstance(inferred, astroid.List)\n+        assert len(inferred.elts) == 1\n+        assert isinstance(inferred.elts[0], nodes.Call)\n+\n \n class SubprocessTest(unittest.TestCase):\n     \"\"\"Test subprocess brain\"\"\"\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/efc5be48e8294cea6c5335a3ad0821fa920fd1e6"
}