{
  "all_hints_text": "\n\n",
  "base_commit": "82b94253ac4165d8a49854e2685da63cea01f2e6",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/b0a88e4503b16ddeb306eabf4fe1313d223f15ec",
    "https://github.com/pylint-dev/astroid/commit/c1edabc2d13cd989e08847a77bca7f53e28f3d91",
    "https://github.com/pylint-dev/astroid/commit/cf76d1a0839b49b95b01e9f07a75fb65ae3237fe"
  ],
  "created_at": "2021-10-09T08:16:46Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-1209",
  "issue_numbers": [
    1208
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex b0a2db8880..9088e7bbc4 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -14,6 +14,11 @@ Release date: TBA\n \n * Add support for wrapt 1.13\n \n+* Fixes handling of nested partial functions\n+\n+  Closes pyCQA/pylint#2462\n+  Closes #1208\n+\n \n What's New in astroid 2.8.2?\n ============================\ndiff --git a/astroid/objects.py b/astroid/objects.py\nindex 4241c170e9..ba2e41780f 100644\n--- a/astroid/objects.py\n+++ b/astroid/objects.py\n@@ -265,10 +265,20 @@ def __init__(\n         # A typical FunctionDef automatically adds its name to the parent scope,\n         # but a partial should not, so defer setting parent until after init\n         self.parent = parent\n-        self.filled_positionals = len(call.positional_arguments[1:])\n         self.filled_args = call.positional_arguments[1:]\n         self.filled_keywords = call.keyword_arguments\n \n+        wrapped_function = call.positional_arguments[0]\n+        inferred_wrapped_function = next(wrapped_function.infer())\n+        if isinstance(inferred_wrapped_function, PartialFunction):\n+            self.filled_args = inferred_wrapped_function.filled_args + self.filled_args\n+            self.filled_keywords = {\n+                **inferred_wrapped_function.filled_keywords,\n+                **self.filled_keywords,\n+            }\n+\n+        self.filled_positionals = len(self.filled_args)\n+\n     def infer_call_result(self, caller=None, context=None):\n         if context:\n             current_passed_keywords = {\n",
  "problem_statement": "Nested partial functions lose track of previously-filled args/kwargs\n### Steps to reproduce\r\n\r\nCause of issue [#2462](https://github.com/PyCQA/pylint/issues/2462) for `pylint`\r\n\r\n### Current behavior\r\n\r\n```python\r\nnode = astroid.extract_node(\r\n    \"\"\"\r\nfrom functools import partial\r\ndef test(a, b, c):\r\n    return a + b + c\r\n\r\ntest1 = partial(test, 1)\r\ntest2 = partial(test1, 2)\r\ntest2(3)\r\n\"\"\"\r\n\r\ncall_site = astroid.arguments.CallSite.from_call(node)\r\ncalled_func = next(node.func.infer())\r\ncalled_args = called_func.filled_args + call_site.positional_arguments\r\n```\r\n\r\nThe `called_args` above will contain args for `2` and `3`, but not `1`, because the second call to `partial` overwrites the first, dropping `1` from the list of `filled_args`.\r\n\r\n### Expected behavior\r\n\r\nAll args/kwargs locked in by calls to `partial` should be present in the final function. I've written a test similar to the code example above and have implemented a fix, so I'll open a PR shortly.\r\n\r\n### `python -c \"from astroid import __pkginfo__; print(__pkginfo__.version)\"` output\r\n\r\n`2.6.6`\r\n\n",
  "pull_number": 1209,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_brain.py b/tests/unittest_brain.py\nindex e3362c925a..722e163180 100644\n--- a/tests/unittest_brain.py\n+++ b/tests/unittest_brain.py\n@@ -2986,6 +2986,34 @@ def scope():\n         assert set(mod_scope) == {\"test\", \"scope\", \"partial\"}\n         assert set(scope) == {\"test2\"}\n \n+    def test_multiple_partial_args(self) -> None:\n+        \"Make sure partials remember locked-in args.\"\n+        ast_node = astroid.extract_node(\n+            \"\"\"\n+        from functools import partial\n+        def test(a, b, c, d, e=5):\n+            return a + b + c + d + e\n+        test1 = partial(test, 1)\n+        test2 = partial(test1, 2)\n+        test3 = partial(test2, 3)\n+        test3(4, e=6) #@\n+        \"\"\"\n+        )\n+        expected_args = [1, 2, 3, 4]\n+        expected_keywords = {\"e\": 6}\n+\n+        call_site = astroid.arguments.CallSite.from_call(ast_node)\n+        called_func = next(ast_node.func.infer())\n+        called_args = called_func.filled_args + call_site.positional_arguments\n+        called_keywords = {**called_func.filled_keywords, **call_site.keyword_arguments}\n+        assert len(called_args) == len(expected_args)\n+        assert [arg.value for arg in called_args] == expected_args\n+        assert len(called_keywords) == len(expected_keywords)\n+\n+        for keyword, value in expected_keywords.items():\n+            assert keyword in called_keywords\n+            assert called_keywords[keyword].value == value\n+\n \n def test_http_client_brain() -> None:\n     node = astroid.extract_node(\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/82b94253ac4165d8a49854e2685da63cea01f2e6"
}