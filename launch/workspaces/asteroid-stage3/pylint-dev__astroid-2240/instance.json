{
  "all_hints_text": "Should the definition be changed as well? It states `args.arguments` returns required arguments, and AFAIK in the example none are required (I can call `a` without supplying any arguments).\r\n\r\nI tried running the following:\r\n\r\n```\r\n>>> node = extract_node(\"\"\"def a(kiwi, apple, *args, b=None, c=None, **kwargs): ...\"\"\")\r\n>>> node.args.arguments\r\n[<AssignName.kiwi l.1 at 0x7f5c55986b90>, <AssignName.apple l.1 at 0x7f5c55985a50>]\r\n```\r\n\r\nAnd it seems correct to me :thinking: \nhttps://github.com/pylint-dev/astroid/blob/fef38f2dd474b0dacd1dda3f15abbf61eb0e9a71/astroid/nodes/node_classes.py#L685-L688\r\n\r\nThe docstring seems to be correct?\nDepends on how you parse the language. \"positional and keyword\" could describe the argument `kiwi` and exclude keyword-only arguments.\r\n\r\nEssentially, the crux of this is whether we should\r\n- leave the function as is, and audit everywhere that uses it (given that we keep finding bugs)\r\n- change the function\r\n\r\n@crazybolillo have you happened to sample the places that use this function to be able to offer a view on that? I'd be eager to hear it!\nI think I got confused about the documentation :sob:. I was reading the docstring for `args` (`node.args.args` in the example):\r\n\r\nhttps://github.com/pylint-dev/astroid/blob/d4f4452fe089f600bf9144ffdcd8e698816df3c2/astroid/nodes/node_classes.py#L554-L555\r\n\r\n but we are dealing with `arguments` (`node.args.arguments`). I will review the code further to see if I can come up with something\r\n\r\n\nI also misunderstood the documentation or it's wrong and #2240 is the fix.\n\n",
  "base_commit": "514991036806e9cda2b12cef8ab3184ac373bd6c",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/2bec9665f39241fd402e33a3babb0cecf8331140",
    "https://github.com/pylint-dev/astroid/commit/980a2d5bde5d0191db4ca21786bd4a688620078c",
    "https://github.com/pylint-dev/astroid/commit/9503e9ae1d1b4c7bd9838673a2791f7640d07523",
    "https://github.com/pylint-dev/astroid/commit/de7d8191f21d4b3fe214eefd570d83c20ce395b6",
    "https://github.com/pylint-dev/astroid/commit/b0d21533fbf46fc13d3a61f04bbfba8432ac413e"
  ],
  "created_at": "2023-07-06T20:52:39Z",
  "hints_text": "Should the definition be changed as well? It states `args.arguments` returns required arguments, and AFAIK in the example none are required (I can call `a` without supplying any arguments).\r\n\r\nI tried running the following:\r\n\r\n```\r\n>>> node = extract_node(\"\"\"def a(kiwi, apple, *args, b=None, c=None, **kwargs): ...\"\"\")\r\n>>> node.args.arguments\r\n[<AssignName.kiwi l.1 at 0x7f5c55986b90>, <AssignName.apple l.1 at 0x7f5c55985a50>]\r\n```\r\n\r\nAnd it seems correct to me :thinking: \nhttps://github.com/pylint-dev/astroid/blob/fef38f2dd474b0dacd1dda3f15abbf61eb0e9a71/astroid/nodes/node_classes.py#L685-L688\r\n\r\nThe docstring seems to be correct?\nDepends on how you parse the language. \"positional and keyword\" could describe the argument `kiwi` and exclude keyword-only arguments.\r\n\r\nEssentially, the crux of this is whether we should\r\n- leave the function as is, and audit everywhere that uses it (given that we keep finding bugs)\r\n- change the function\r\n\r\n@crazybolillo have you happened to sample the places that use this function to be able to offer a view on that? I'd be eager to hear it!\nI think I got confused about the documentation :sob:. I was reading the docstring for `args` (`node.args.args` in the example):\r\n\r\nhttps://github.com/pylint-dev/astroid/blob/d4f4452fe089f600bf9144ffdcd8e698816df3c2/astroid/nodes/node_classes.py#L554-L555\r\n\r\n but we are dealing with `arguments` (`node.args.arguments`). I will review the code further to see if I can come up with something\r\n\r\n\n\n",
  "instance_id": "pylint-dev__astroid-2240",
  "issue_numbers": [
    2213
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex ac2231efa5..41d6a31273 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -6,6 +6,11 @@ What's New in astroid 3.0.0?\n =============================\n Release date: TBA\n \n+* Return all existing arguments when calling ``Arguments.arguments()``. This also means ``find_argname`` will now\n+  use the whole list of arguments for its search.\n+\n+  Closes #2213\n+\n * Add support for Python 3.12, including PEP 695 type parameter syntax.\n \n   Closes #2201\ndiff --git a/astroid/arguments.py b/astroid/arguments.py\nindex 43c0a265ca..d2dca776d5 100644\n--- a/astroid/arguments.py\n+++ b/astroid/arguments.py\n@@ -181,7 +181,13 @@ def infer_argument(\n \n         positional = self.positional_arguments[: len(funcnode.args.args)]\n         vararg = self.positional_arguments[len(funcnode.args.args) :]\n-        argindex = funcnode.args.find_argname(name)[0]\n+\n+        # preserving previous behavior, when vararg and kwarg were not included in find_argname results\n+        if name in [funcnode.args.vararg, funcnode.args.kwarg]:\n+            argindex = None\n+        else:\n+            argindex = funcnode.args.find_argname(name)[0]\n+\n         kwonlyargs = {arg.name for arg in funcnode.args.kwonlyargs}\n         kwargs = {\n             key: value\ndiff --git a/astroid/nodes/node_classes.py b/astroid/nodes/node_classes.py\nindex e7149219b2..014955cf06 100644\n--- a/astroid/nodes/node_classes.py\n+++ b/astroid/nodes/node_classes.py\n@@ -605,7 +605,9 @@ def _infer(\n DEPRECATED_ARGUMENT_DEFAULT = \"DEPRECATED_ARGUMENT_DEFAULT\"\n \n \n-class Arguments(_base_nodes.AssignTypeNode):\n+class Arguments(\n+    _base_nodes.AssignTypeNode\n+):  # pylint: disable=too-many-instance-attributes\n     \"\"\"Class representing an :class:`ast.arguments` node.\n \n     An :class:`Arguments` node represents that arguments in a\n@@ -704,7 +706,20 @@ class Arguments(_base_nodes.AssignTypeNode):\n     kwargannotation: NodeNG | None\n     \"\"\"The type annotation for the variable length keyword arguments.\"\"\"\n \n-    def __init__(self, vararg: str | None, kwarg: str | None, parent: NodeNG) -> None:\n+    vararg_node: AssignName | None\n+    \"\"\"The node for variable length arguments\"\"\"\n+\n+    kwarg_node: AssignName | None\n+    \"\"\"The node for variable keyword arguments\"\"\"\n+\n+    def __init__(\n+        self,\n+        vararg: str | None,\n+        kwarg: str | None,\n+        parent: NodeNG,\n+        vararg_node: AssignName | None = None,\n+        kwarg_node: AssignName | None = None,\n+    ) -> None:\n         \"\"\"Almost all attributes can be None for living objects where introspection failed.\"\"\"\n         super().__init__(\n             parent=parent,\n@@ -720,6 +735,9 @@ def __init__(self, vararg: str | None, kwarg: str | None, parent: NodeNG) -> Non\n         self.kwarg = kwarg\n         \"\"\"The name of the variable length keyword arguments.\"\"\"\n \n+        self.vararg_node = vararg_node\n+        self.kwarg_node = kwarg_node\n+\n     # pylint: disable=too-many-arguments\n     def postinit(\n         self,\n@@ -780,8 +798,21 @@ def fromlineno(self) -> int:\n \n     @cached_property\n     def arguments(self):\n-        \"\"\"Get all the arguments for this node, including positional only and positional and keyword\"\"\"\n-        return list(itertools.chain((self.posonlyargs or ()), self.args or ()))\n+        \"\"\"Get all the arguments for this node. This includes:\n+        * Positional only arguments\n+        * Positional arguments\n+        * Keyword arguments\n+        * Variable arguments (.e.g *args)\n+        * Variable keyword arguments (e.g **kwargs)\n+        \"\"\"\n+        retval = list(itertools.chain((self.posonlyargs or ()), (self.args or ())))\n+        if self.vararg_node:\n+            retval.append(self.vararg_node)\n+        retval += self.kwonlyargs or ()\n+        if self.kwarg_node:\n+            retval.append(self.kwarg_node)\n+\n+        return retval\n \n     def format_args(self, *, skippable_names: set[str] | None = None) -> str:\n         \"\"\"Get the arguments formatted as string.\n@@ -911,15 +942,20 @@ def default_value(self, argname):\n         :raises NoDefault: If there is no default value defined for the\n             given argument.\n         \"\"\"\n-        args = self.arguments\n+        args = [\n+            arg for arg in self.arguments if arg.name not in [self.vararg, self.kwarg]\n+        ]\n+\n+        index = _find_arg(argname, self.kwonlyargs)[0]\n+        if index is not None and self.kw_defaults[index] is not None:\n+            return self.kw_defaults[index]\n+\n         index = _find_arg(argname, args)[0]\n         if index is not None:\n-            idx = index - (len(args) - len(self.defaults))\n+            idx = index - (len(args) - len(self.defaults) - len(self.kw_defaults))\n             if idx >= 0:\n                 return self.defaults[idx]\n-        index = _find_arg(argname, self.kwonlyargs)[0]\n-        if index is not None and self.kw_defaults[index] is not None:\n-            return self.kw_defaults[index]\n+\n         raise NoDefault(func=self.parent, name=argname)\n \n     def is_argument(self, name) -> bool:\n@@ -934,11 +970,7 @@ def is_argument(self, name) -> bool:\n             return True\n         if name == self.kwarg:\n             return True\n-        return (\n-            self.find_argname(name)[1] is not None\n-            or self.kwonlyargs\n-            and _find_arg(name, self.kwonlyargs)[1] is not None\n-        )\n+        return self.find_argname(name)[1] is not None\n \n     def find_argname(self, argname, rec=DEPRECATED_ARGUMENT_DEFAULT):\n         \"\"\"Get the index and :class:`AssignName` node for given name.\n@@ -956,7 +988,9 @@ def find_argname(self, argname, rec=DEPRECATED_ARGUMENT_DEFAULT):\n                 stacklevel=2,\n             )\n         if self.arguments:\n-            return _find_arg(argname, self.arguments)\n+            index, argument = _find_arg(argname, self.arguments)\n+            if argument:\n+                return index, argument\n         return None, None\n \n     def get_children(self):\ndiff --git a/astroid/nodes/scoped_nodes/scoped_nodes.py b/astroid/nodes/scoped_nodes/scoped_nodes.py\nindex 52bb39ffad..21bad2fecc 100644\n--- a/astroid/nodes/scoped_nodes/scoped_nodes.py\n+++ b/astroid/nodes/scoped_nodes/scoped_nodes.py\n@@ -963,11 +963,7 @@ def argnames(self) -> list[str]:\n             names = [elt.name for elt in self.args.arguments]\n         else:\n             names = []\n-        if self.args.vararg:\n-            names.append(self.args.vararg)\n-        names += [elt.name for elt in self.args.kwonlyargs]\n-        if self.args.kwarg:\n-            names.append(self.args.kwarg)\n+\n         return names\n \n     def infer_call_result(\n@@ -1280,11 +1276,7 @@ def argnames(self) -> list[str]:\n             names = [elt.name for elt in self.args.arguments]\n         else:\n             names = []\n-        if self.args.vararg:\n-            names.append(self.args.vararg)\n-        names += [elt.name for elt in self.args.kwonlyargs]\n-        if self.args.kwarg:\n-            names.append(self.args.kwarg)\n+\n         return names\n \n     def getattr(\ndiff --git a/astroid/protocols.py b/astroid/protocols.py\nindex b5bd0d5cc0..e69ab5d6da 100644\n--- a/astroid/protocols.py\n+++ b/astroid/protocols.py\n@@ -352,14 +352,15 @@ def _arguments_infer_argname(\n     # more\n     from astroid import arguments  # pylint: disable=import-outside-toplevel\n \n-    if not (self.arguments or self.vararg or self.kwarg):\n+    if not self.arguments:\n         yield util.Uninferable\n         return\n \n+    args = [arg for arg in self.arguments if arg.name not in [self.vararg, self.kwarg]]\n     functype = self.parent.type\n     # first argument of instance/class method\n     if (\n-        self.arguments\n+        args\n         and getattr(self.arguments[0], \"name\", None) == name\n         and functype != \"staticmethod\"\n     ):\n@@ -388,7 +389,7 @@ def _arguments_infer_argname(\n     if name == self.vararg:\n         vararg = nodes.const_factory(())\n         vararg.parent = self\n-        if not self.arguments and self.parent.name == \"__init__\":\n+        if not args and self.parent.name == \"__init__\":\n             cls = self.parent.parent.scope()\n             vararg.elts = [cls.instantiate_class()]\n         yield vararg\ndiff --git a/astroid/rebuilder.py b/astroid/rebuilder.py\nindex e7781741ce..17a6ffe57f 100644\n--- a/astroid/rebuilder.py\n+++ b/astroid/rebuilder.py\n@@ -21,6 +21,7 @@\n from astroid.const import IS_PYPY, PY38, PY39_PLUS, PY312_PLUS, Context\n from astroid.manager import AstroidManager\n from astroid.nodes import NodeNG\n+from astroid.nodes.node_classes import AssignName\n from astroid.nodes.utils import Position\n from astroid.typing import InferenceResult\n \n@@ -561,10 +562,33 @@ def visit_arguments(self, node: ast.arguments, parent: NodeNG) -> nodes.Argument\n         \"\"\"Visit an Arguments node by returning a fresh instance of it.\"\"\"\n         vararg: str | None = None\n         kwarg: str | None = None\n+        vararg_node = node.vararg\n+        kwarg_node = node.kwarg\n+\n         newnode = nodes.Arguments(\n             node.vararg.arg if node.vararg else None,\n             node.kwarg.arg if node.kwarg else None,\n             parent,\n+            AssignName(\n+                vararg_node.arg,\n+                vararg_node.lineno,\n+                vararg_node.col_offset,\n+                parent,\n+                end_lineno=vararg_node.end_lineno,\n+                end_col_offset=vararg_node.end_col_offset,\n+            )\n+            if vararg_node\n+            else None,\n+            AssignName(\n+                kwarg_node.arg,\n+                kwarg_node.lineno,\n+                kwarg_node.col_offset,\n+                parent,\n+                end_lineno=kwarg_node.end_lineno,\n+                end_col_offset=kwarg_node.end_col_offset,\n+            )\n+            if kwarg_node\n+            else None,\n         )\n         args = [self.visit(child, newnode) for child in node.args]\n         defaults = [self.visit(child, newnode) for child in node.defaults]\n",
  "problem_statement": "`.arguments` property ignores keyword-only args, *args, and **kwargs\n```python\r\n>>> from astroid import extract_node\r\n>>> node = extract_node(\"\"\"def a(*args, b=None, c=None, **kwargs): ...\"\"\")\r\n>>> node.args.arguments\r\n[]\r\n```\r\n\r\nExpected to find all the arguments from the function signature.\r\n\r\nThe wanted data can be found here:\r\n\r\n```python\r\n>>> node.args.vararg\r\n'args'\r\n>>> node.args.kwarg\r\n'kwargs'\r\n>>> node.args.kwonlyargs\r\n[<AssignName.b l.1 at 0x1048189b0>, <AssignName.c l.1 at 0x104818830>]\r\n```\r\n\r\nDiscussed at https://github.com/pylint-dev/pylint/pull/7577#discussion_r989000829.\r\n\r\nNotice that positional-only args are found for some reason \ud83e\udd37 \n",
  "pull_number": 2240,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/test_nodes.py b/tests/test_nodes.py\nindex 392544d716..6ea25fd846 100644\n--- a/tests/test_nodes.py\n+++ b/tests/test_nodes.py\n@@ -22,6 +22,7 @@\n     Uninferable,\n     bases,\n     builder,\n+    extract_node,\n     nodes,\n     parse,\n     test_utils,\n@@ -1975,3 +1976,38 @@ def test_str_repr_no_warnings(node):\n     test_node = node(**args)\n     str(test_node)\n     repr(test_node)\n+\n+\n+def test_arguments_contains_all():\n+    \"\"\"Ensure Arguments.arguments actually returns all available arguments\"\"\"\n+\n+    def manually_get_args(arg_node) -> set:\n+        names = set()\n+        if arg_node.args.vararg:\n+            names.add(arg_node.args.vararg)\n+        if arg_node.args.kwarg:\n+            names.add(arg_node.args.kwarg)\n+\n+        names.update([x.name for x in arg_node.args.args])\n+        names.update([x.name for x in arg_node.args.kwonlyargs])\n+\n+        return names\n+\n+    node = extract_node(\"\"\"def a(fruit: str, *args, b=None, c=None, **kwargs): ...\"\"\")\n+    assert manually_get_args(node) == {x.name for x in node.args.arguments}\n+\n+    node = extract_node(\"\"\"def a(mango: int, b=\"banana\", c=None, **kwargs): ...\"\"\")\n+    assert manually_get_args(node) == {x.name for x in node.args.arguments}\n+\n+    node = extract_node(\"\"\"def a(self, num = 10, *args): ...\"\"\")\n+    assert manually_get_args(node) == {x.name for x in node.args.arguments}\n+\n+\n+def test_arguments_default_value():\n+    node = extract_node(\n+        \"def fruit(eat='please', *, peel='no', trim='yes', **kwargs): ...\"\n+    )\n+    assert node.args.default_value(\"eat\").value == \"please\"\n+\n+    node = extract_node(\"def fruit(seeds, flavor='good', *, peel='maybe'): ...\")\n+    assert node.args.default_value(\"flavor\").value == \"good\"\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/514991036806e9cda2b12cef8ab3184ac373bd6c"
}