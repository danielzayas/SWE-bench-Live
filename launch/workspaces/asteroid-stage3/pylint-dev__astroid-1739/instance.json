{
  "all_hints_text": "Could you provide the version you tested against?\n@jacobtylerwalls 2.12.2\n\n",
  "base_commit": "93ca875a10c4ff84772d77e52f991882309ca7aa",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/1ed13b225a152f2b8073988e0f9824749a832907"
  ],
  "created_at": "2022-08-12T12:08:13Z",
  "hints_text": "Could you provide the version you tested against?\n@jacobtylerwalls 2.12.2\n\n",
  "instance_id": "pylint-dev__astroid-1739",
  "issue_numbers": [
    1737
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 587e675f1d..01e4676c97 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -24,6 +24,10 @@ Release date: TBA\n \n   Refs PyCQA/pylint#7265\n \n+* Fix a crash inferring invalid old-style string formatting with `%`.\n+\n+  Closes #1737\n+\n What's New in astroid 2.12.2?\n =============================\n Release date: 2022-07-12\ndiff --git a/astroid/inference.py b/astroid/inference.py\nindex 7c1db80408..942988b21c 100644\n--- a/astroid/inference.py\n+++ b/astroid/inference.py\n@@ -648,7 +648,7 @@ def _infer_old_style_string_formatting(\n \n     try:\n         return (nodes.const_factory(instance.value % values),)\n-    except (TypeError, KeyError):\n+    except (TypeError, KeyError, ValueError):\n         return (util.Uninferable,)\n \n \n",
  "problem_statement": "Inference crash in inferring value of `a % b`\n```python\r\nimport astroid\r\n\r\ncode = \"\"\"\r\ndef foo(x, y):\r\n    return (\"%\" + str(x)) % y\r\n\r\nfoo(\"123\", \"f\")\r\n\"\"\"\r\n\r\ntree = astroid.parse(code)\r\ncall_node = tree.body[1].value\r\nprint(list(call_node.infer()))\r\n```\r\n\r\nOutput:\r\n\r\n```text\r\nTraceback (most recent call last):\r\n  File \"/Users/tusharsadhwani/asd.py\", line 12, in <module>\r\n    print(list(call_node.infer()))\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/nodes/node_ng.py\", line 169, in infer\r\n    yield from self._infer(context=context, **kwargs)\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/decorators.py\", line 139, in raise_if_nothing_inferred\r\n    yield next(generator)\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/decorators.py\", line 108, in wrapped\r\n    for res in _func(node, context, **kwargs):\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/inference.py\", line 264, in infer_call\r\n    yield from callee.infer_call_result(caller=self, context=callcontext)\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/nodes/scoped_nodes/scoped_nodes.py\", line 1748, in infer_call_result\r\n    yield from returnnode.value.infer(context)\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/nodes/node_ng.py\", line 182, in infer\r\n    for i, result in enumerate(self._infer(context=context, **kwargs)):\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/decorators.py\", line 126, in yes_if_nothing_inferred\r\n    yield next(generator)\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/decorators.py\", line 108, in wrapped\r\n    for res in _func(node, context, **kwargs):\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/inference.py\", line 530, in _filter_operation_errors\r\n    for result in infer_callable(self, context):\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/inference.py\", line 879, in _infer_binop\r\n    yield from _infer_binary_operation(lhs, rhs, self, context, _get_binop_flow)\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/inference.py\", line 828, in _infer_binary_operation\r\n    results = list(method())\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/inference.py\", line 667, in _invoke_binop_inference\r\n    return iter(_infer_old_style_string_formatting(instance, other, context))\r\n  File \"/Users/tusharsadhwani/venv3/lib/python3.10/site-packages/astroid/inference.py\", line 650, in _infer_old_style_string_formatting\r\n    return (nodes.const_factory(instance.value % values),)\r\nValueError: incomplete format\r\n```\n",
  "pull_number": 1739,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_inference.py b/tests/unittest_inference.py\nindex 8673cdfcf0..767d2190e8 100644\n--- a/tests/unittest_inference.py\n+++ b/tests/unittest_inference.py\n@@ -6955,6 +6955,7 @@ def test_old_style_string_formatting(self, format_string: str) -> None:\n             \"My name is %s, I'm %s\" % ((fname,)*2)\n             \"\"\",\n             \"\"\"20 % 0\"\"\",\n+            \"\"\"(\"%\" + str(20)) % 0\"\"\",\n         ],\n     )\n     def test_old_style_string_formatting_uninferable(self, format_string: str) -> None:\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/93ca875a10c4ff84772d77e52f991882309ca7aa"
}