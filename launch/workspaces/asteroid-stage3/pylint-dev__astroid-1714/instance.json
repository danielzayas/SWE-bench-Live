{
  "all_hints_text": "Thanks for the report! [Failing action](https://github.com/apache/airflow/runs/7291353339?check_suite_focus=true).\r\n\r\nThe offending line is something like this:\r\n```\r\npackages/astroid/interpreter/_import/spec.py\", line 204, in find_module\r\nsubmodule_path = sys.modules.__path__\r\nAttributeError: module 'http.client' has no attribute '__path__'\r\n```\r\n\r\nEither we incorrectly classify ``http.client`` as a namespace package:\r\nhttps://github.com/PyCQA/astroid/blob/c9425824b06adc654ca2d5f7b1471f65f74f64f6/astroid/interpreter/_import/spec.py#L203\r\n\r\nOr it is a namespace package with a mangled `__path__` attribute.\r\n\r\n@jacobtylerwalls Does this ring a bell?\nThanks for the report. Looks like we need to add a `hasattr` guard. I noticed the failing job is running python 3.7? Is it reproducible on later versions?\nYep. same problems on 3.10 at least.\nBTW. I you have a candidate to test, I am happy to test it. For now we limited astroid to < 2.12 so we are good, but we do not like to keep the upper-binding on our dependencies :). \n@potiuk If you wanted to test #1714 that would be fantastic. I'm worried you might run into https://github.com/benjaminp/six/issues/261, but there is a workaround listed there.\nOn it.\nYep. Confirmed it fixes the problem (though some tests are failing for you :P ) . \r\n\r\n```\r\napache-airflow                                              : Building documentation\r\napache-airflow                                              : Running sphinx. The output is hidden until an error occurs.\r\napache-airflow                                              : Finished docs building successfully\r\nDocumentation build is successful\r\nroot@bdc147c580ac:/opt/airflow# pip freeze |  grep astroid\r\nastroid @ git+https://github.com/jacobtylerwalls/astroid.git@3df008431b1801e0b38896530481fbe93baf0317\r\n```\nNice! \r\n\r\n> (though some tests are failing for you :P )\r\n\r\nyeah, I was hoping to get a reproducer without `urllib3`, but my effort to repro with just six failed...\n@potiuk:\r\nWith encouragement from @DanielNoord I found a more correct implementation and pushed it to #1714, so you may be interested to try testing it again.\nSorrry for the delay. Had to catch up with stuff :)\r\n\r\nYep. Installed astroid from tip of https://github.com/jacobtylerwalls/astroid/tree/namespace-path-crash and it also solves the problem:\r\n\r\n\r\n![image](https://user-images.githubusercontent.com/595491/182443610-c6571b99-7892-4586-bb13-7d201ba93442.png)\r\n\r\n\n\n",
  "base_commit": "26296c3adc25097ea7f972131bb349ef99f82c6d",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/986f9a403fa21e6f123ec8b86178211b69d33c7d",
    "https://github.com/pylint-dev/astroid/commit/3df008431b1801e0b38896530481fbe93baf0317",
    "https://github.com/pylint-dev/astroid/commit/ee6f4edd21e41d75e9ea8a8ea06763b22d4ee669",
    "https://github.com/pylint-dev/astroid/commit/21fcabd2d3f0843540c4a49795a857b63b2a39d1",
    "https://github.com/pylint-dev/astroid/commit/b9b1e56d896080b3b1ee5e268a37a8cefc3ec74e",
    "https://github.com/pylint-dev/astroid/commit/ee7ecc168fbdeb80da2f330909b3b2ebc462801d"
  ],
  "created_at": "2022-07-16T14:15:56Z",
  "hints_text": "Thanks for the report! [Failing action](https://github.com/apache/airflow/runs/7291353339?check_suite_focus=true).\r\n\r\nThe offending line is something like this:\r\n```\r\npackages/astroid/interpreter/_import/spec.py\", line 204, in find_module\r\nsubmodule_path = sys.modules.__path__\r\nAttributeError: module 'http.client' has no attribute '__path__'\r\n```\r\n\r\nEither we incorrectly classify ``http.client`` as a namespace package:\r\nhttps://github.com/PyCQA/astroid/blob/c9425824b06adc654ca2d5f7b1471f65f74f64f6/astroid/interpreter/_import/spec.py#L203\r\n\r\nOr it is a namespace package with a mangled `__path__` attribute.\r\n\r\n@jacobtylerwalls Does this ring a bell?\nThanks for the report. Looks like we need to add a `hasattr` guard. I noticed the failing job is running python 3.7? Is it reproducible on later versions?\nYep. same problems on 3.10 at least.\nBTW. I you have a candidate to test, I am happy to test it. For now we limited astroid to < 2.12 so we are good, but we do not like to keep the upper-binding on our dependencies :). \n\n",
  "instance_id": "pylint-dev__astroid-1714",
  "issue_numbers": [
    1708
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 553c002722..4adc17c553 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -12,6 +12,10 @@ What's New in astroid 2.12.3?\n =============================\n Release date: TBA\n \n+* Fixed crash in ``ExplicitNamespacePackageFinder`` involving ``_SixMetaPathImporter``.\n+\n+  Closes #1708\n+\n * Fix unhandled `FutureWarning` from pandas import in cython modules\n \n   Closes #1717\ndiff --git a/astroid/interpreter/_import/util.py b/astroid/interpreter/_import/util.py\nindex c1694f8537..f082e9c4a7 100644\n--- a/astroid/interpreter/_import/util.py\n+++ b/astroid/interpreter/_import/util.py\n@@ -72,7 +72,8 @@ def is_namespace(modname: str) -> bool:\n         if found_spec and found_spec.submodule_search_locations:\n             last_submodule_search_locations = found_spec.submodule_search_locations\n \n-    if found_spec is None:\n-        return False\n-\n-    return found_spec.origin is None\n+    return (\n+        found_spec is not None\n+        and found_spec.submodule_search_locations is not None\n+        and found_spec.origin is None\n+    )\n",
  "problem_statement": "Astroid 2.12 breaks sphinx autoapi (at least for Airflow)\n### Steps to reproduce\r\n\r\n1. Checkout apache airlfow (https://github.com/apache/airflow)\r\n2. Install airflow with doc extras `pip install \".[doc]\"`\r\n3. Make sure to use latest astroid version `pip install --upgrade astroid` (2.12.1 should be installed)\r\n4. export PYTHONPATH=$(pwd)\r\n5. ./docs/build_docs.py --package-filter apache-airflow --one-pass-only --docs-only\r\n6. docs build fails with 111  errors similar to:\r\n```\r\n------------------------------ Error  95 --------------------\r\n  File \"/usr/local/lib/python3.7/site-packages/astroid/nodes/node_ng.py\", line 182, in infer\r\n------------------------------ Error  96 --------------------\r\n  File \"/usr/local/lib/python3.7/site-packages/astroid/nodes/scoped_nodes/scoped_nodes.py\", line 1842, in _is_metaclass\r\n```\r\n7. downgrade astroid to 2.11.7: `pip install astroid==2.11.7`\r\n8. ./docs/build_docs.py --package-filter apache-airflow --one-pass-only --docs-only\r\n9. Observe the build succeeds.\r\n\r\nNOTE. The above might fail because of libenchant could not be installed (especially on MacOS silicon) \r\n    You can reproduce it easily using our CI docker image - with all dependencies needed installed:\r\n\r\n1. docker run -it ghcr.io/apache/airflow/main/ci/python3.7:2af19f16a4d94e749bbf6c7c4704e02aac35fc11\r\n2. ./docs/build_docs.py --package-filter apache-airflow --one-pass-only --docs-only\r\n3. docs build fails with 111  errors similar to:\r\n```\r\n------------------------------ Error  95 --------------------\r\n  File \"/usr/local/lib/python3.7/site-packages/astroid/nodes/node_ng.py\", line 182, in infer\r\n------------------------------ Error  96 --------------------\r\n  File \"/usr/local/lib/python3.7/site-packages/astroid/nodes/scoped_nodes/scoped_nodes.py\", line 1842, in _is_metaclass\r\n```\r\n4. downgrade astroid to 2.11.7: `pip install astroid==2.11.7`\r\n5. ./docs/build_docs.py --package-filter apache-airflow --one-pass-only --docs-only\r\n6. Observe the build succeeds.\r\n\r\nAlso downgrading to 2.12.0 leads to failures.\r\nExample failure in CI: https://github.com/apache/airflow/runs/7291353339?check_suite_focus=true#step:9:6115\r\n\r\n### Current behavior\r\n\r\nVersion 2.12.*  of astroid causes sphinx autoapi to fail\r\nVersion 2.11.7 of astroid and before works.\r\n\r\n### Expected behavior\r\n\r\n* Version 2.12.* of astroid should work with sphinx autoapi \r\n\r\n```\r\npython -c \"from astroid import __pkginfo__; print(__pkginfo__.version)\"\r\n2.12.1\r\n```\n",
  "pull_number": 1714,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/requirements_test_brain.txt b/requirements_test_brain.txt\nindex 76f0ebd159..3cde923088 100644\n--- a/requirements_test_brain.txt\n+++ b/requirements_test_brain.txt\n@@ -7,3 +7,4 @@ PyQt6\n types-python-dateutil\n six\n types-six\n+urllib3\ndiff --git a/tests/unittest_modutils.py b/tests/unittest_modutils.py\nindex 96418b01ac..82bb76602a 100644\n--- a/tests/unittest_modutils.py\n+++ b/tests/unittest_modutils.py\n@@ -17,6 +17,7 @@\n from xml import etree\n from xml.etree import ElementTree\n \n+import pytest\n from pytest import CaptureFixture, LogCaptureFixture\n \n import astroid\n@@ -25,6 +26,13 @@\n \n from . import resources\n \n+try:\n+    import urllib3  # pylint: disable=unused-import\n+\n+    HAS_URLLIB3 = True\n+except ImportError:\n+    HAS_URLLIB3 = False\n+\n \n def _get_file_from_object(obj) -> str:\n     return modutils._path_from_filename(obj.__file__)\n@@ -439,5 +447,14 @@ def test_is_module_name_part_of_extension_package_whitelist_success(self) -> Non\n         )\n \n \n+@pytest.mark.skipif(not HAS_URLLIB3, reason=\"This test requires urllib3.\")\n+def test_file_info_from_modpath__SixMetaPathImporter() -> None:\n+    pytest.raises(\n+        ImportError,\n+        modutils.file_info_from_modpath,\n+        [\"urllib3.packages.six.moves.http_client\"],\n+    )\n+\n+\n if __name__ == \"__main__\":\n     unittest.main()\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/26296c3adc25097ea7f972131bb349ef99f82c6d"
}