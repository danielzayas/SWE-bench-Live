{
  "all_hints_text": "Looking more closely at [bpo-32892](https://bugs.python.org/issue32892), it looks like `ast.Constant` was actually added in 3.6, so it would be good to define `visit_constant` in any case. What changed in that PR is that the compiler now generates it in (many) more cases.\nAnd #616 should fix this issue.\nShould be fixed in master, going to create a dev release shortly. Thank you both for fixing this! \n\n",
  "base_commit": "5a85ae63fdfc9ab578c856728105a6822d1786fe",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/fccd5a5ecf8d6f079296f46a63d16e2ccbc94fbe"
  ],
  "created_at": "2018-09-29T17:29:49Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-616",
  "issue_numbers": [
    617
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex c7d0713213..f515bccc0b 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -34,6 +34,8 @@ Release Date: TBA\n \n      Close PyCQA/pylint#2434\n \n+   * Make compatible with AST changes in Python 3.8.\n+\n \n What's New in astroid 2.0.4?\n ============================\ndiff --git a/astroid/as_string.py b/astroid/as_string.py\nindex b633850928..4528bb0be3 100644\n--- a/astroid/as_string.py\n+++ b/astroid/as_string.py\n@@ -188,6 +188,8 @@ def visit_comprehension(self, node):\n \n     def visit_const(self, node):\n         \"\"\"return an astroid.Const node as string\"\"\"\n+        if node.value is Ellipsis:\n+            return '...'\n         return repr(node.value)\n \n     def visit_continue(self, node):\n@@ -273,7 +275,7 @@ def visit_exec(self, node):\n \n     def visit_extslice(self, node):\n         \"\"\"return an astroid.ExtSlice node as string\"\"\"\n-        return ','.join([dim.accept(self) for dim in node.dims])\n+        return ', '.join([dim.accept(self) for dim in node.dims])\n \n     def visit_for(self, node):\n         \"\"\"return an astroid.For node as string\"\"\"\n@@ -430,8 +432,15 @@ def visit_slice(self, node):\n \n     def visit_subscript(self, node):\n         \"\"\"return an astroid.Subscript node as string\"\"\"\n-        return '%s[%s]' % (self._precedence_parens(node, node.value),\n-                           node.slice.accept(self))\n+        idx = node.slice\n+        if idx.__class__.__name__.lower() == 'index':\n+            idx = idx.value\n+        idxstr = idx.accept(self)\n+        if idx.__class__.__name__.lower() == 'tuple' and idx.elts:\n+            # Remove parenthesis in tuple and extended slice.\n+            # a[(::1, 1:)] is not valid syntax.\n+            idxstr = idxstr[1:-1]\n+        return '%s[%s]' % (self._precedence_parens(node, node.value), idxstr)\n \n     def visit_tryexcept(self, node):\n         \"\"\"return an astroid.TryExcept node as string\"\"\"\ndiff --git a/astroid/rebuilder.py b/astroid/rebuilder.py\nindex c37128fa23..3cac708350 100644\n--- a/astroid/rebuilder.py\n+++ b/astroid/rebuilder.py\n@@ -479,6 +479,7 @@ def visit_expr(self, node, parent):\n         newnode.postinit(self.visit(node.value, newnode))\n         return newnode\n \n+    # Not used in Python 3.8+.\n     def visit_ellipsis(self, node, parent):\n         \"\"\"visit an Ellipsis node by returning a fresh instance of it\"\"\"\n         return nodes.Ellipsis(getattr(node, 'lineno', None),\n@@ -509,6 +510,7 @@ def visit_exec(self, node, parent):\n                          _visit_or_none(node, 'locals', self, newnode))\n         return newnode\n \n+    # Not used in Python 3.8+.\n     def visit_extslice(self, node, parent):\n         \"\"\"visit an ExtSlice node by returning a fresh instance of it\"\"\"\n         newnode = nodes.ExtSlice(parent=parent)\n@@ -641,6 +643,7 @@ def visit_import(self, node, parent):\n             parent.set_local(name.split('.')[0], newnode)\n         return newnode\n \n+    # Not used in Python 3.8+.\n     def visit_index(self, node, parent):\n         \"\"\"visit a Index node by returning a fresh instance of it\"\"\"\n         newnode = nodes.Index(parent=parent)\n@@ -702,12 +705,19 @@ def visit_name(self, node, parent):\n             self._save_assignment(newnode)\n         return newnode\n \n+    def visit_constant(self, node, parent):\n+        \"\"\"visit a Constant node by returning a fresh instance of Const\"\"\"\n+        return nodes.Const(node.value, getattr(node, 'lineno', None),\n+                           getattr(node, 'col_offset', None), parent)\n+\n+    # Not used in Python 3.8+.\n     def visit_str(self, node, parent):\n         \"\"\"visit a String/Bytes node by returning a fresh instance of Const\"\"\"\n         return nodes.Const(node.s, getattr(node, 'lineno', None),\n                            getattr(node, 'col_offset', None), parent)\n     visit_bytes = visit_str\n \n+    # Not used in Python 3.8+.\n     def visit_num(self, node, parent):\n         \"\"\"visit a Num node by returning a fresh instance of Const\"\"\"\n         return nodes.Const(node.n, getattr(node, 'lineno', None),\n@@ -854,6 +864,7 @@ def visit_arg(self, node, parent):\n         \"\"\"visit an arg node by returning a fresh AssName instance\"\"\"\n         return self.visit_assignname(node, parent, node.arg)\n \n+    # Not used in Python 3.8+.\n     def visit_nameconstant(self, node, parent):\n         # in Python 3.4 we have NameConstant for True / False / None\n         return nodes.Const(node.value, getattr(node, 'lineno', None),\n",
  "problem_statement": "addition of ast.Constant type makes astroid crash on import when using current CPython master (which will become 3.8)\nIt looks like the merge of https://github.com/python/cpython/pull/9445 broke astroid on CPython 3.8 pre-releases:\r\n\r\n```\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/trio/tests/test_exports.py:9: in <module>\r\n    from pylint.lint import PyLinter\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/pylint/lint.py:75: in <module>\r\n    import astroid\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/__init__.py:156: in <module>\r\n    __import__(module[:-3])\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/brain/brain_builtin_inference.py:103: in <module>\r\n    extend_builtins({'bytes': partial(_extend_str, rvalue=\"b''\"),\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/brain/brain_builtin_inference.py:99: in extend_builtins\r\n    transform(builtin_ast[class_name])\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/brain/brain_builtin_inference.py:84: in _extend_str\r\n    fake = AstroidBuilder(MANAGER).string_build(code)['whatever']\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/builder.py:132: in string_build\r\n    module = self._data_build(data, modname, path)\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/builder.py:173: in _data_build\r\n    module = builder.visit_module(node, modname, node_file, package)\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:162: in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:162: in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:174: in visit\r\n    return visit_method(node, parent)\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:954: in visit_classdef\r\n    return super(TreeRebuilder3, self).visit_classdef(node, parent,\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:394: in visit_classdef\r\n    [self.visit(child, newnode)\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:394: in <listcomp>\r\n    [self.visit(child, newnode)\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:174: in visit\r\n    return visit_method(node, parent)\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:576: in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:566: in _visit_functiondef\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:566: in <listcomp>\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:174: in visit\r\n    return visit_method(node, parent)\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:741: in visit_return\r\n    newnode.postinit(self.visit(node.value, newnode))\r\n../../../../virtualenv/python3.8-dev/lib/python3.8/site-packages/astroid/rebuilder.py:172: in visit\r\n    visit_method = getattr(self, visit_name)\r\nE   AttributeError: 'TreeRebuilder3' object has no attribute 'visit_constant'\r\n```\r\n\r\n(See: https://travis-ci.org/python-trio/trio/jobs/435176057)\n",
  "pull_number": 616,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/astroid/tests/unittest_nodes.py b/astroid/tests/unittest_nodes.py\nindex 6412fb33e6..e9e2d3847a 100644\n--- a/astroid/tests/unittest_nodes.py\n+++ b/astroid/tests/unittest_nodes.py\n@@ -158,8 +158,8 @@ def test_ellipsis(self):\n         self.assertEqual(ast.as_string(), 'a[...]')\n \n     def test_slices(self):\n-        for code in ('a[0]', 'a[1:3]', 'a[:-1:step]', 'a[:,newaxis]',\n-                     'a[newaxis,:]', 'del L[::2]', 'del A[1]', 'del Br[:]'):\n+        for code in ('a[0]', 'a[1:3]', 'a[:-1:step]', 'a[:, newaxis]',\n+                     'a[newaxis, :]', 'del L[::2]', 'del A[1]', 'del Br[:]'):\n             ast = abuilder.string_build(code).body[0]\n             self.assertEqual(ast.as_string(), code)\n \n@@ -170,7 +170,7 @@ def test_slice_and_subscripts(self):\n bord[2:]\n del av[d::f], a[df:]\n a[:1] = bord[2:]\n-del SRC[::1,newaxis,1:]\n+del SRC[::1, newaxis, 1:]\n tous[vals] = 1010\n del thousand[key]\n del a[::2], a[:-1:step]\n@@ -546,7 +546,7 @@ def test_as_string(self):\n             print()\n             test: int = 5\n             test2: str\n-            test3: List[Dict[(str, str)]] = []\n+            test3: List[Dict[str, str]] = []\n         \"\"\")\n         ast = abuilder.string_build(code)\n         self.assertEqual(ast.as_string().strip(), code.strip())\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/5a85ae63fdfc9ab578c856728105a6822d1786fe"
}