{
  "all_hints_text": "\n\n",
  "base_commit": "a4273963ea10ffbcb9a4351801268c08e3e7e518",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/17d2597dc256d2521649329d8c6687c6b25af17b"
  ],
  "created_at": "2018-06-21T18:00:21Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-567",
  "issue_numbers": [
    565
  ],
  "language": "python",
  "patch": "diff --git a/astroid/bases.py b/astroid/bases.py\nindex e41b2ec3c6..f02d114561 100644\n--- a/astroid/bases.py\n+++ b/astroid/bases.py\n@@ -71,7 +71,13 @@ def _is_property(meth):\n \n \n class Proxy(object):\n-    \"\"\"a simple proxy object\"\"\"\n+    \"\"\"a simple proxy object\n+\n+    Note:\n+\n+    Subclasses of this object will need a custom __getattr__\n+    if new instance attributes are created. See the Const class\n+    \"\"\"\n \n     _proxied = None # proxied object may be set by class or by instance\n \ndiff --git a/astroid/node_classes.py b/astroid/node_classes.py\nindex 73c697030f..ba82c5959c 100644\n--- a/astroid/node_classes.py\n+++ b/astroid/node_classes.py\n@@ -2295,6 +2295,17 @@ def __init__(self, value, lineno=None, col_offset=None, parent=None):\n \n         super(Const, self).__init__(lineno, col_offset, parent)\n \n+    def __getattr__(self, name):\n+        # This is needed because of Proxy's __getattr__ method.\n+        # Calling object.__new__ on this class without calling\n+        # __init__ would result in an infinite loop otherwise\n+        # since __getattr__ is called when an attribute doesn't\n+        # exist and self._proxied indirectly calls self.value\n+        # and Proxy __getattr__ calls self.value\n+        if name == \"value\":\n+            raise AttributeError\n+        return super().__getattr__(name)\n+\n     def getitem(self, index, context=None):\n         \"\"\"Get an item from this node if subscriptable.\n \ndiff --git a/astroid/raw_building.py b/astroid/raw_building.py\nindex 2383ec2371..65153cea24 100644\n--- a/astroid/raw_building.py\n+++ b/astroid/raw_building.py\n@@ -392,8 +392,6 @@ def _astroid_bootstrapping(astroid_builtin=None):\n _astroid_bootstrapping()\n \n # TODO : find a nicer way to handle this situation;\n-# However __proxied introduced an\n-# infinite recursion (see https://bugs.launchpad.net/pylint/+bug/456870)\n def _set_proxied(const):\n     return _CONST_PROXY[const.value.__class__]\n nodes.Const._proxied = property(_set_proxied)\n",
  "problem_statement": "RecursionError when copying constants\n### Steps to reproduce\r\nRun\r\n```python\r\nimport copy\r\nimport astroid\r\ncopy.copy(astroid.nodes.Const(1))\r\n```\r\n\r\n### Output\r\n\r\n```\r\n----> 1 copy.copy(astroid.nodes.Const(1))\r\n\r\n~/astroid/ast/lib64/python3.6/copy.py in copy(x)\r\n    104     if isinstance(rv, str):\r\n    105         return x\r\n--> 106     return _reconstruct(x, None, *rv)\r\n    107 \r\n    108 \r\n\r\n~/astroid/ast/lib64/python3.6/copy.py in _reconstruct(x, memo, func, args, state, listiter, dictiter, deepcopy)\r\n    279         if deep:\r\n    280             state = deepcopy(state, memo)\r\n--> 281         if hasattr(y, '__setstate__'):\r\n    282             y.__setstate__(state)\r\n    283         else:\r\n\r\n~/astroid/astroid/bases.py in __getattr__(self, name)\r\n     69         if name in self.__dict__:\r\n     70             return self.__dict__[name]\r\n---> 71         return getattr(self._proxied, name)\r\n     72 \r\n     73     def infer(self, context=None):\r\n\r\n~/astroid/astroid/raw_building.py in _set_proxied(const)\r\n    396 # infinite recursion (see https://bugs.launchpad.net/pylint/+bug/456870)\r\n    397 def _set_proxied(const):\r\n--> 398     return _CONST_PROXY[const.value.__class__]\r\n    399 nodes.Const._proxied = property(_set_proxied)\r\n    400 \r\n\r\n... last 2 frames repeated, from the frame below ...\r\n\r\n~/astroid/astroid/bases.py in __getattr__(self, name)\r\n     69         if name in self.__dict__:\r\n     70             return self.__dict__[name]\r\n---> 71         return getattr(self._proxied, name)\r\n     72 \r\n     73     def infer(self, context=None):\r\n\r\nRecursionError: maximum recursion depth exceeded\r\n```\r\n### Current version\r\n\r\ncdd9756b0f9ac270a2ca365ecde972d47a891e94\r\n\n",
  "pull_number": 567,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/astroid/tests/unittest_nodes.py b/astroid/tests/unittest_nodes.py\nindex 77a4dcf58e..0e34483dc8 100644\n--- a/astroid/tests/unittest_nodes.py\n+++ b/astroid/tests/unittest_nodes.py\n@@ -14,6 +14,7 @@\n import sys\n import textwrap\n import unittest\n+import copy\n \n import pytest\n import six\n@@ -445,6 +446,13 @@ def test_str(self):\n     def test_unicode(self):\n         self._test('a')\n \n+    def test_copy(self):\n+        \"\"\"\n+        Make sure copying a Const object doesn't result in infinite recursion\n+        \"\"\"\n+        const = copy.copy(nodes.Const(1))\n+        assert const.value == 1\n+\n \n class NameNodeTest(unittest.TestCase):\n     def test_assign_to_True(self):\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/a4273963ea10ffbcb9a4351801268c08e3e7e518"
}