{
  "all_hints_text": "\n\n\n\n",
  "base_commit": "ba7df4acab0e985d1a6274def9f1798a9a7ce40d",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/de8285210a58f1ed129dff5168b0171c7dda0a3c"
  ],
  "created_at": "2024-10-02T11:34:06Z",
  "hints_text": "\n\n\n\n",
  "instance_id": "pylint-dev__astroid-2596",
  "issue_numbers": [
    2521,
    2523
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 56d97ad391..52d8309031 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -7,6 +7,10 @@ What's New in astroid 4.0.0?\n ============================\n Release date: TBA\n \n+* Fix crashes with large positive and negative list multipliers.\n+\n+  Closes #2521\n+  Closes #2523\n \n \n What's New in astroid 3.3.5?\ndiff --git a/astroid/protocols.py b/astroid/protocols.py\nindex 0bac32a29a..4688f74713 100644\n--- a/astroid/protocols.py\n+++ b/astroid/protocols.py\n@@ -142,7 +142,10 @@ def _multiply_seq_by_int(\n     context: InferenceContext,\n ) -> _TupleListNodeT:\n     node = self.__class__(parent=opnode)\n-    if value > 1e8:\n+    if value <= 0:\n+        node.elts = []\n+        return node\n+    if len(self.elts) * value > 1e8:\n         node.elts = [util.Uninferable]\n         return node\n     filtered_elts = (\n",
  "problem_statement": "OverflowError in _multiply_seq_by_int\n### Steps to reproduce\r\n\r\nThe following code triggers an `OverflowError` in astroid:\r\n\r\n```python\r\na=[]*-9223372036854775809\r\n```\r\n\r\nThis bug was discovered by OSS-Fuzz:\r\nhttps://bugs.chromium.org/p/oss-fuzz/issues/detail?id=60347 (report not public yet)\r\n\r\n### Current behavior\r\n```\r\nException on node <AssignName.a l.1 at 0x72afc65f1340> in file 'corpus/a.py'\r\nTraceback (most recent call last):\r\n  File \"pylint/pylint/checkers/utils.py\", line 1365, in safe_infer\r\n    value = next(infer_gen)\r\n            ^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/nodes/node_ng.py\", line 168, in infer\r\n    for i, result in enumerate(self._infer(context=context, **kwargs)):\r\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/decorators.py\", line 69, in inner\r\n    yield next(generator)\r\n          ^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/decorators.py\", line 49, in wrapped\r\n    for res in _func(node, context, **kwargs):\r\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/nodes/_base_nodes.py\", line 336, in _filter_operation_errors\r\n    for result in infer_callable(context):\r\n                  ^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/nodes/node_classes.py\", line 1555, in _infer_binop\r\n    yield from self._infer_binary_operation(\r\n  File \"astroid/astroid/nodes/_base_nodes.py\", line 648, in _infer_binary_operation\r\n    results = list(method())\r\n              ^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/decorators.py\", line 69, in inner\r\n    yield next(generator)\r\n          ^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/protocols.py\", line 204, in tl_infer_binary_op\r\n    yield _multiply_seq_by_int(self, opnode, other.value, context)\r\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/protocols.py\", line 153, in _multiply_seq_by_int\r\n    node.elts = list(filtered_elts) * value\r\n                ~~~~~~~~~~~~~~~~~~~~^~~~~~~\r\nOverflowError: cannot fit 'int' into an index-sized integer\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"pylint/pylint/utils/ast_walker.py\", line 91, in walk\r\n    callback(astroid)\r\n  File \"pylint/pylint/checkers/base/name_checker/checker.py\", line 423, in visit_assignname\r\n    inferred_assign_type = utils.safe_infer(assign_type.value)\r\n                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"pylint/pylint/checkers/utils.py\", line 1369, in safe_infer\r\n    raise AstroidError from e\r\nastroid.exceptions.AstroidError\r\n```\r\n\r\n### Expected behavior\r\nNo crash\r\n\r\n### Version\r\nd8dbc462243a65d72153ace2e7ac87daa9ffc1cf\nMemoryError in _multiply_seq_by_int when constructing large list\n### Steps to reproduce\r\n\r\nThe following code triggers a `MemoryError` in astroid:\r\n\r\n```python\r\na = [[]] * 825 * 16547118\r\n```\r\n\r\nThis bug was discovered by OSS-Fuzz:\r\nhttps://bugs.chromium.org/p/oss-fuzz/issues/detail?id=62196 (report not public yet)\r\n\r\nRelated fix from the past:\r\n- https://github.com/pylint-dev/astroid/pull/2228\r\n\r\n### Current behavior\r\n```\r\nException on node <AssignName.a l.1 at 0x73b77c659520> in file 'corpus/a.py'\r\nTraceback (most recent call last):\r\n  File \"pylint/pylint/checkers/utils.py\", line 1365, in safe_infer\r\n    value = next(infer_gen)\r\n            ^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/nodes/node_ng.py\", line 168, in infer\r\n    for i, result in enumerate(self._infer(context=context, **kwargs)):\r\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/decorators.py\", line 69, in inner\r\n    yield next(generator)\r\n          ^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/decorators.py\", line 49, in wrapped\r\n    for res in _func(node, context, **kwargs):\r\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/nodes/_base_nodes.py\", line 336, in _filter_operation_errors\r\n    for result in infer_callable(context):\r\n                  ^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/nodes/node_classes.py\", line 1555, in _infer_binop\r\n    yield from self._infer_binary_operation(\r\n  File \"astroid/astroid/nodes/_base_nodes.py\", line 648, in _infer_binary_operation\r\n    results = list(method())\r\n              ^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/decorators.py\", line 69, in inner\r\n    yield next(generator)\r\n          ^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/protocols.py\", line 204, in tl_infer_binary_op\r\n    yield _multiply_seq_by_int(self, opnode, other.value, context)\r\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"astroid/astroid/protocols.py\", line 153, in _multiply_seq_by_int\r\n    node.elts = list(filtered_elts) * value\r\n                ~~~~~~~~~~~~~~~~~~~~^~~~~~~\r\nMemoryError\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"pylint/pylint/utils/ast_walker.py\", line 91, in walk\r\n    callback(astroid)\r\n  File \"pylint/pylint/checkers/base/name_checker/checker.py\", line 423, in visit_assignname\r\n    inferred_assign_type = utils.safe_infer(assign_type.value)\r\n                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"pylint/pylint/checkers/utils.py\", line 1369, in safe_infer\r\n    raise AstroidError from e\r\nastroid.exceptions.AstroidError\r\n```\r\n\r\n### Expected behavior\r\nNo crash\r\n\r\n### Version\r\nd8dbc462243a65d72153ace2e7ac87daa9ffc1cf\n",
  "pull_number": 2596,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/test_protocols.py b/tests/test_protocols.py\nindex 72b91a1156..f718fd1e9c 100644\n--- a/tests/test_protocols.py\n+++ b/tests/test_protocols.py\n@@ -286,6 +286,23 @@ def test_uninferable_list_multiplication() -> None:\n         element = parsed.inferred()[0].elts[0]\n         assert element.value is Uninferable\n \n+    @staticmethod\n+    def test_uninferable_list_multiplication_with_multiple_operands() -> None:\n+        \"\"\"Attempting to calculate the result is prohibitively expensive.\"\"\"\n+        parsed = extract_node(\"[0] * 825 * 16547118\")\n+        element = parsed.inferred()[0].elts[0]\n+        assert element.value is Uninferable\n+\n+    @staticmethod\n+    def test_list_multiplication_with_zero_multiplier() -> None:\n+        parsed = extract_node(\"[0] * 0\")\n+        assert parsed.inferred()[0].elts == []\n+\n+    @staticmethod\n+    def test_list_multiplication_with_negative_multiplier() -> None:\n+        parsed = extract_node(\"[0] * -9223372036854775809\")\n+        assert parsed.inferred()[0].elts == []\n+\n \n def test_named_expr_inference() -> None:\n     code = \"\"\"\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/ba7df4acab0e985d1a6274def9f1798a9a7ce40d"
}