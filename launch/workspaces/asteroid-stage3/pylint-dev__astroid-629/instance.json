{
  "all_hints_text": "It seems that recognizing `attr` annotations in https://github.com/PyCQA/astroid/blob/master/astroid/brain/brain_attrs.py is incomplete (both for classes and attributes).\n@gavento That's true. Would you like to submit a patch?\n\n",
  "base_commit": "c88b7d5fa934e25ae426d8b918d6eb8de414682d",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/a2d8aa93d233a95a683fee4f448893fcb399deec"
  ],
  "created_at": "2018-12-11T13:55:11Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-629",
  "issue_numbers": [
    628
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 27dc332d28..37b2802431 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -14,6 +14,10 @@ Release Date: TBA\n \n   Close PyCQA/pylint#2534\n \n+* Extend detection of data classes defined with attr\n+\n+  Close #628\n+\n \n What's New in astroid 2.1.0?\n ============================\ndiff --git a/astroid/brain/brain_attrs.py b/astroid/brain/brain_attrs.py\nindex 74d1aa3493..3bcfb85284 100644\n--- a/astroid/brain/brain_attrs.py\n+++ b/astroid/brain/brain_attrs.py\n@@ -11,12 +11,11 @@\n from astroid import MANAGER\n \n \n-ATTR_IB = \"attr.ib\"\n+ATTRIB_NAMES = frozenset((\"attr.ib\", \"attrib\", \"attr.attrib\"))\n+ATTRS_NAMES = frozenset((\"attr.s\", \"attrs\", \"attr.attrs\", \"attr.attributes\"))\n \n \n-def is_decorated_with_attrs(\n-    node, decorator_names=(\"attr.s\", \"attr.attrs\", \"attr.attributes\")\n-):\n+def is_decorated_with_attrs(node, decorator_names=ATTRS_NAMES):\n     \"\"\"Return True if a decorated node has\n     an attr decorator applied.\"\"\"\n     if not node.decorators:\n@@ -41,7 +40,7 @@ def attr_attributes_transform(node):\n         if not isinstance(cdefbodynode, astroid.Assign):\n             continue\n         if isinstance(cdefbodynode.value, astroid.Call):\n-            if cdefbodynode.value.func.as_string() != ATTR_IB:\n+            if cdefbodynode.value.func.as_string() not in ATTRIB_NAMES:\n                 continue\n         else:\n             continue\n",
  "problem_statement": "Decorator `attrib` unsupperoted where `attr.ib` is\nWhile pylint supports `attr` classes with `attr.ib` attributes, it does not support the same with `attr.attrib`, which is an alias preferred by some.\r\n\r\n### Steps to reproduce\r\n1. `pylint attrib_test.py` with:\r\n```python\r\nimport attr\r\nfrom attr import attrib, attrs\r\n\r\n@attr.s\r\nclass D1:\r\n    d = attr.ib()\r\n\r\n@attrs\r\nclass D2:\r\n    d = attrib()\r\n\r\n@attr.s\r\nclass OK:\r\n    x1 = attr.ib(type=D1)\r\n    x2 = attr.ib(type=D2)\r\n\r\n    def test(self):\r\n        return (self.x1.d, self.x2.d)\r\n\r\n@attrs\r\nclass Err:\r\n    x1 = attrib(type=D1)\r\n    x2 = attrib(type=D2)\r\n\r\n    def test(self):\r\n        return (self.x1.d, self.x2.d)\r\n```\r\n### Current behavior\r\n\r\nClass `OK` reports no errors while `Err` reports:\r\n```\r\n[... snip docstring and too-few-methods lints]\r\ntst.py:26:16: E1101: Instance of '_CountingAttr' has no 'd' member (no-member)\r\ntst.py:26:27: E1101: Instance of '_CountingAttr' has no 'd' member (no-member)\r\n[... snip docstring and too-few-methods lints]\r\n```\r\nNote the problem is not in how classes `D1`, `D2` were declared (`attr.ib` or `attrib`).\r\n\r\n### Expected behavior\r\n\r\nclass `Err` should also return no errors.\r\n\r\n### ``python -c \"from astroid import __pkginfo__; print(__pkginfo__.version)\"`` output\r\n\r\n2.1.0\r\n\n",
  "pull_number": 629,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/astroid/tests/unittest_brain.py b/astroid/tests/unittest_brain.py\nindex 0d80d1474a..6249b62467 100644\n--- a/astroid/tests/unittest_brain.py\n+++ b/astroid/tests/unittest_brain.py\n@@ -1030,6 +1030,7 @@ def test_attr_transform(self):\n         module = astroid.parse(\n             \"\"\"\n         import attr\n+        from attr import attrs, attrib\n \n         @attr.s\n         class Foo:\n@@ -1045,10 +1046,24 @@ class Bar:\n \n         g = Bar()\n         g.d['answer'] = 42\n+\n+        @attrs\n+        class Bah:\n+            d = attrib(attr.Factory(dict))\n+\n+        h = Bah()\n+        h.d['answer'] = 42\n+\n+        @attr.attrs\n+        class Bai:\n+            d = attr.attrib(attr.Factory(dict))\n+\n+        i = Bai()\n+        i.d['answer'] = 42\n         \"\"\"\n         )\n \n-        for name in (\"f\", \"g\"):\n+        for name in (\"f\", \"g\", \"h\", \"i\"):\n             should_be_unknown = next(module.getattr(name)[0].infer()).getattr(\"d\")[0]\n             self.assertIsInstance(should_be_unknown, astroid.Unknown)\n \n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/c88b7d5fa934e25ae426d8b918d6eb8de414682d"
}