{
  "all_hints_text": "\n\n",
  "base_commit": "4cfd9b6d1003b9912ab94538e1dfa5d734f55251",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/c18286e1d7eef287297441ec020347f3f15780fb",
    "https://github.com/pylint-dev/astroid/commit/fa3731ba6992abaf6cf256fcf85381053799e484"
  ],
  "created_at": "2021-04-07T23:44:25Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-934",
  "issue_numbers": [
    904
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 6097526bbd..c606b76106 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -41,6 +41,10 @@ Release Date: TBA\n \n   Closes #922\n \n+* Fix inference of attributes defined in a base class that is an inner class\n+\n+  Closes #904\n+\n \n What's New in astroid 2.5.6?\n ============================\ndiff --git a/astroid/inference.py b/astroid/inference.py\nindex 20c986478e..dd9a565aec 100644\n--- a/astroid/inference.py\n+++ b/astroid/inference.py\n@@ -309,6 +309,7 @@ def infer_attribute(self, context=None):\n         elif not context:\n             context = contextmod.InferenceContext()\n \n+        old_boundnode = context.boundnode\n         try:\n             context.boundnode = owner\n             yield from owner.igetattr(self.attrname, context)\n@@ -319,7 +320,7 @@ def infer_attribute(self, context=None):\n         ):\n             pass\n         finally:\n-            context.boundnode = None\n+            context.boundnode = old_boundnode\n     return dict(node=self, context=context)\n \n \n",
  "problem_statement": "error during inference of class inheriting from another with `mod.Type` format\nConsider package a `level` with a class `Model` defined in `level`'s `__init__.py` file.\r\n\r\n```\r\nclass Model:\r\n    data: int = 1\r\n```\r\n\r\nIf a class `Test` inherits from `Model` as `class Test(Model)`, and `Model` comes from `from level import Model`,  then inferring `Test.data` works fine (below, A is an alias for astroid).\r\n\r\n<img width=\"248\" alt=\"Screen Shot 2021-02-19 at 09 41 09\" src=\"https://user-images.githubusercontent.com/2905588/108505730-9b3c1900-7296-11eb-8bb8-5b66b7253cf4.png\">\r\n\r\nHowever, if a `Test` inherits from `Model` as `class Test(level.Model)` and `level` comes from `import level`, then inference triggers an exception.\r\n\r\n<img width=\"784\" alt=\"Screen Shot 2021-02-19 at 09 42 09\" src=\"https://user-images.githubusercontent.com/2905588/108505815-beff5f00-7296-11eb-92a2-641be827e1f0.png\">\r\n\r\n\r\n\r\n\r\n\n",
  "pull_number": 934,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_inference.py b/tests/unittest_inference.py\nindex 7fb1ed55c9..6b9f4c0609 100644\n--- a/tests/unittest_inference.py\n+++ b/tests/unittest_inference.py\n@@ -3894,6 +3894,65 @@ class Clazz(metaclass=_Meta):\n         ).inferred()[0]\n         assert isinstance(cls, nodes.ClassDef) and cls.name == \"Clazz\"\n \n+    def test_infer_subclass_attr_outer_class(self):\n+        node = extract_node(\n+            \"\"\"\n+        class Outer:\n+            data = 123\n+\n+        class Test(Outer):\n+            pass\n+        Test.data\n+        \"\"\"\n+        )\n+        inferred = next(node.infer())\n+        assert isinstance(inferred, nodes.Const)\n+        assert inferred.value == 123\n+\n+    def test_infer_subclass_attr_inner_class_works_indirectly(self):\n+        node = extract_node(\n+            \"\"\"\n+        class Outer:\n+            class Inner:\n+                data = 123\n+        Inner = Outer.Inner\n+\n+        class Test(Inner):\n+            pass\n+        Test.data\n+        \"\"\"\n+        )\n+        inferred = next(node.infer())\n+        assert isinstance(inferred, nodes.Const)\n+        assert inferred.value == 123\n+\n+    def test_infer_subclass_attr_inner_class(self):\n+        clsdef_node, attr_node = extract_node(\n+            \"\"\"\n+        class Outer:\n+            class Inner:\n+                data = 123\n+\n+        class Test(Outer.Inner):\n+            pass\n+        Test  #@\n+        Test.data  #@\n+            \"\"\"\n+        )\n+        clsdef = next(clsdef_node.infer())\n+        assert isinstance(clsdef, nodes.ClassDef)\n+        inferred = next(clsdef.igetattr(\"data\"))\n+        assert isinstance(inferred, nodes.Const)\n+        assert inferred.value == 123\n+        # Inferring the value of .data via igetattr() worked before the\n+        # old_boundnode fixes in infer_subscript, so it should have been\n+        # possible to infer the subscript directly. It is the difference\n+        # between these two cases that led to the discovery of the cause of the\n+        # bug in https://github.com/PyCQA/astroid/issues/904\n+        inferred = next(attr_node.infer())\n+        assert isinstance(inferred, nodes.Const)\n+        assert inferred.value == 123\n+\n     def test_delayed_attributes_without_slots(self):\n         ast_node = extract_node(\n             \"\"\"\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/4cfd9b6d1003b9912ab94538e1dfa5d734f55251"
}