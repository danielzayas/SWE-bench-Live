{
  "all_hints_text": "\n\n",
  "base_commit": "ec96745c0fdb9432549d182e381164d1836e8a4b",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/e712edced04a26e12e2aed94e555d6e2a25c9d4d"
  ],
  "created_at": "2020-06-20T00:58:26Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-805",
  "issue_numbers": [
    777
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 737b682ec4..c8c6bcfb1d 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -13,6 +13,10 @@ Release Date: TBA\n \n   Fixes PyCQA/pylint#3599\n \n+* Prevent recursion error for self referential length calls\n+\n+  Close #777\n+\n * Added missing methods to the brain for ``mechanize``, to fix pylint false positives\n \n   Close #793\ndiff --git a/astroid/brain/brain_builtin_inference.py b/astroid/brain/brain_builtin_inference.py\nindex 074ec476d7..3a4f364d86 100644\n--- a/astroid/brain/brain_builtin_inference.py\n+++ b/astroid/brain/brain_builtin_inference.py\n@@ -759,6 +759,7 @@ def infer_len(node, context=None):\n             \"({len}) given\".format(len=len(call.positional_arguments))\n         )\n     [argument_node] = call.positional_arguments\n+\n     try:\n         return nodes.Const(helpers.object_len(argument_node, context=context))\n     except (AstroidTypeError, InferenceError) as exc:\ndiff --git a/astroid/helpers.py b/astroid/helpers.py\nindex 8ab687999e..a7764d7acc 100644\n--- a/astroid/helpers.py\n+++ b/astroid/helpers.py\n@@ -237,13 +237,31 @@ def object_len(node, context=None):\n     :raises AstroidTypeError: If an invalid node is returned\n         from __len__ method or no __len__ method exists\n     :raises InferenceError: If the given node cannot be inferred\n-        or if multiple nodes are inferred\n+        or if multiple nodes are inferred or if the code executed in python\n+        would result in a infinite recursive check for length\n     :rtype int: Integer length of node\n     \"\"\"\n     # pylint: disable=import-outside-toplevel; circular import\n     from astroid.objects import FrozenSet\n \n     inferred_node = safe_infer(node, context=context)\n+\n+    # prevent self referential length calls from causing a recursion error\n+    # see https://github.com/PyCQA/astroid/issues/777\n+    node_frame = node.frame()\n+    if (\n+        isinstance(node_frame, scoped_nodes.FunctionDef)\n+        and node_frame.name == \"__len__\"\n+        and inferred_node._proxied == node_frame.parent\n+    ):\n+        message = (\n+            \"Self referential __len__ function will \"\n+            \"cause a RecursionError on line {} of {}\".format(\n+                node.lineno, node.root().file\n+            )\n+        )\n+        raise exceptions.InferenceError(message)\n+\n     if inferred_node is None or inferred_node is util.Uninferable:\n         raise exceptions.InferenceError(node=node)\n     if isinstance(inferred_node, nodes.Const) and isinstance(\n",
  "problem_statement": "Astroid Infinite loop when `__len__(self)` is mistakenly defined as `return len(self)`\n### Steps to reproduce\r\nLint the following program with pylint\r\n```python\r\nclass Crash:\r\n    def __len__(self) -> int:\r\n        return len(self)\r\n```\r\n\r\n### Current behavior\r\n\r\nThe following error is thrown and pylint crashes\r\n```\r\nRecursionError: maximum recursion depth exceeded\r\n```\r\n\r\n### Expected behavior\r\n\r\nIt should not crash.\r\n\r\n### Asteroid version\r\n2.4.0\r\n\n",
  "pull_number": 805,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_brain.py b/tests/unittest_brain.py\nindex 25e2bb5b73..c308ddd535 100644\n--- a/tests/unittest_brain.py\n+++ b/tests/unittest_brain.py\n@@ -2035,5 +2035,21 @@ def test_str_and_bytes(code, expected_class, expected_value):\n     assert inferred.value == expected_value\n \n \n+def test_no_recursionerror_on_self_referential_length_check():\n+    \"\"\"\n+    Regression test for https://github.com/PyCQA/astroid/issues/777\n+    \"\"\"\n+    with pytest.raises(astroid.InferenceError):\n+        node = astroid.extract_node(\n+            \"\"\"\n+        class Crash:\n+            def __len__(self) -> int:\n+                return len(self)\n+        len(Crash()) #@\n+        \"\"\"\n+        )\n+        node.inferred()\n+\n+\n if __name__ == \"__main__\":\n     unittest.main()\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/ec96745c0fdb9432549d182e381164d1836e8a4b"
}