{
  "all_hints_text": "Small point about my patch. I did nothing to try and insure it works in the absence of the ``regex`` module. Also, I didn't add any test cases.\nWe would need some tests for this to make sure this doesn't regress in the future. If I find time this week I can look into this. I'm putting it on my todo list!\nUnderstood. I'll try to take a look. Not being at all familiar with ``astroid``, does my code need to be resilient in the face of a missing ``regex`` module, or does the scaffolding take care of that?\nAdding it to the `brain` test requirements \"should\" handle this. But this is a bit of an if. If you make a first draft PR I can definitely help your move this in the right direction. It's often much easier to comment on code than try to find the time and write it yourself \ud83d\ude04 \nPull request created. The tests fail as explained in the PR. I assume smarter people than me will easily be able to figure out what's wrong.\n>  I assume smarter people than me will easily be able to figure out what's wrong.\r\n\r\nThank you for the PR @smontanaro. Though In the words of Steve Jobs the world is made up by people that were no smarter than you \ud83d\ude04 \n\n",
  "base_commit": "15d2067bcc102e8bdf58d1428d17dcf5b8d6ad28",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/d2bb374384af5a6aca4d38885e8540cd47bb7e73",
    "https://github.com/pylint-dev/astroid/commit/ca6e956dd6bdc11f1886963fa0d0893aef54c2f3",
    "https://github.com/pylint-dev/astroid/commit/b1bc769f57567512333f368b6a1113a7e6a513e2",
    "https://github.com/pylint-dev/astroid/commit/7f3dc46644e1097f58bed04b2ec618e5e660841d",
    "https://github.com/pylint-dev/astroid/commit/bf1a00fc1c0d2ff18737d37c8dd4e4909c9841c2",
    "https://github.com/pylint-dev/astroid/commit/cd123add6bff995afe62957c02fe4df548f442ec",
    "https://github.com/pylint-dev/astroid/commit/e2857149ec1f8e65e025dbf6d89519985129d700"
  ],
  "created_at": "2023-01-02T19:24:58Z",
  "hints_text": "Small point about my patch. I did nothing to try and insure it works in the absence of the ``regex`` module. Also, I didn't add any test cases.\nWe would need some tests for this to make sure this doesn't regress in the future. If I find time this week I can look into this. I'm putting it on my todo list!\nUnderstood. I'll try to take a look. Not being at all familiar with ``astroid``, does my code need to be resilient in the face of a missing ``regex`` module, or does the scaffolding take care of that?\nAdding it to the `brain` test requirements \"should\" handle this. But this is a bit of an if. If you make a first draft PR I can definitely help your move this in the right direction. It's often much easier to comment on code than try to find the time and write it yourself \ud83d\ude04 \n\n",
  "instance_id": "pylint-dev__astroid-1934",
  "issue_numbers": [
    1911
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 83872b06c9..70a57917fb 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -16,6 +16,10 @@ Release date: TBA\n \n   Refs PyCQA/pylint#2567\n \n+* Added a ``regex`` brain.\n+\n+  Refs PyCQA/pylint#1911\n+\n What's New in astroid 2.12.14?\n ==============================\n Release date: TBA\ndiff --git a/astroid/brain/brain_regex.py b/astroid/brain/brain_regex.py\nnew file mode 100644\nindex 0000000000..498e2a3ed8\n--- /dev/null\n+++ b/astroid/brain/brain_regex.py\n@@ -0,0 +1,92 @@\n+# Licensed under the LGPL: https://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html\n+# For details: https://github.com/PyCQA/astroid/blob/main/LICENSE\n+# Copyright (c) https://github.com/PyCQA/astroid/blob/main/CONTRIBUTORS.txt\n+\n+from __future__ import annotations\n+\n+from astroid import context, inference_tip, nodes\n+from astroid.brain.helpers import register_module_extender\n+from astroid.builder import _extract_single_node, parse\n+from astroid.const import PY39_PLUS\n+from astroid.manager import AstroidManager\n+\n+\n+def _regex_transform() -> nodes.Module:\n+    \"\"\"The RegexFlag enum exposes all its entries by updating globals().\n+\n+    We hard-code the flags for now.\n+    # pylint: disable-next=line-too-long\n+    See https://github.com/mrabarnett/mrab-regex/blob/2022.10.31/regex_3/regex.py#L200\n+    \"\"\"\n+    return parse(\n+        \"\"\"\n+    A = ASCII = 0x80          # Assume ASCII locale.\n+    B = BESTMATCH = 0x1000    # Best fuzzy match.\n+    D = DEBUG = 0x200         # Print parsed pattern.\n+    E = ENHANCEMATCH = 0x8000 # Attempt to improve the fit after finding the first\n+                              # fuzzy match.\n+    F = FULLCASE = 0x4000     # Unicode full case-folding.\n+    I = IGNORECASE = 0x2      # Ignore case.\n+    L = LOCALE = 0x4          # Assume current 8-bit locale.\n+    M = MULTILINE = 0x8       # Make anchors look for newline.\n+    P = POSIX = 0x10000       # POSIX-style matching (leftmost longest).\n+    R = REVERSE = 0x400       # Search backwards.\n+    S = DOTALL = 0x10         # Make dot match newline.\n+    U = UNICODE = 0x20        # Assume Unicode locale.\n+    V0 = VERSION0 = 0x2000    # Old legacy behaviour.\n+    DEFAULT_VERSION = V0\n+    V1 = VERSION1 = 0x100     # New enhanced behaviour.\n+    W = WORD = 0x800          # Default Unicode word breaks.\n+    X = VERBOSE = 0x40        # Ignore whitespace and comments.\n+    T = TEMPLATE = 0x1        # Template (present because re module has it).\n+    \"\"\"\n+    )\n+\n+\n+register_module_extender(AstroidManager(), \"regex\", _regex_transform)\n+\n+\n+CLASS_GETITEM_TEMPLATE = \"\"\"\n+@classmethod\n+def __class_getitem__(cls, item):\n+    return cls\n+\"\"\"\n+\n+\n+def _looks_like_pattern_or_match(node: nodes.Call) -> bool:\n+    \"\"\"Check for regex.Pattern or regex.Match call in stdlib.\n+\n+    Match these patterns from stdlib/re.py\n+    ```py\n+    Pattern = type(...)\n+    Match = type(...)\n+    ```\n+    \"\"\"\n+    return (\n+        node.root().name == \"regex.regex\"\n+        and isinstance(node.func, nodes.Name)\n+        and node.func.name == \"type\"\n+        and isinstance(node.parent, nodes.Assign)\n+        and len(node.parent.targets) == 1\n+        and isinstance(node.parent.targets[0], nodes.AssignName)\n+        and node.parent.targets[0].name in {\"Pattern\", \"Match\"}\n+    )\n+\n+\n+def infer_pattern_match(node: nodes.Call, ctx: context.InferenceContext | None = None):\n+    \"\"\"Infer regex.Pattern and regex.Match as classes. For PY39+ add `__class_getitem__`.\"\"\"\n+    class_def = nodes.ClassDef(\n+        name=node.parent.targets[0].name,\n+        lineno=node.lineno,\n+        col_offset=node.col_offset,\n+        parent=node.parent,\n+    )\n+    if PY39_PLUS:\n+        func_to_add = _extract_single_node(CLASS_GETITEM_TEMPLATE)\n+        class_def.locals[\"__class_getitem__\"] = [func_to_add]\n+    return iter([class_def])\n+\n+\n+AstroidManager().register_transform(\n+    nodes.Call, inference_tip(infer_pattern_match), _looks_like_pattern_or_match\n+)\n",
  "problem_statement": "Update to brain_re.py for third-party regex module\nThere's an [open ``pylint`` issue](https://github.com/PyCQA/pylint/issues/5873) regarding module-level constants in the [third-party ``regex`` module](https://pypi.org/project/regex/). It seems the mechanism used by both modules (populate the module namespace by calling ``globals.update()``) is the same, so the fix is pretty similar. Attached is a diff against the current ``astroid`` code.\r\n\r\nMy apologies for almost certainly not doing this correctly. I didn't bother to read the necessary contribution guidelines. Feel free to beat me with a virtual wet noodle the next time we run into each other. I just wanted to get back to what I was working on (which had nothing to do with ``pylint`` or ``astroid``).\r\n\r\n[brain_re.txt](https://github.com/PyCQA/astroid/files/10296110/brain_re.txt)\r\n\r\n\r\n\n",
  "pull_number": 1934,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/requirements_test_brain.txt b/requirements_test_brain.txt\nindex 3cde923088..b1b31a646e 100644\n--- a/requirements_test_brain.txt\n+++ b/requirements_test_brain.txt\n@@ -4,6 +4,7 @@ nose\n numpy>=1.17.0; python_version<\"3.11\"\n python-dateutil\n PyQt6\n+regex\n types-python-dateutil\n six\n types-six\ndiff --git a/tests/test_brain_regex.py b/tests/test_brain_regex.py\nnew file mode 100644\nindex 0000000000..55cc64c445\n--- /dev/null\n+++ b/tests/test_brain_regex.py\n@@ -0,0 +1,48 @@\n+# Licensed under the LGPL: https://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html\n+# For details: https://github.com/PyCQA/astroid/blob/main/LICENSE\n+# Copyright (c) https://github.com/PyCQA/astroid/blob/main/CONTRIBUTORS.txt\n+\n+try:\n+    import regex\n+\n+    HAS_REGEX = True\n+except ImportError:\n+    HAS_REGEX = False\n+\n+import pytest\n+\n+from astroid import MANAGER, builder, nodes, test_utils\n+\n+\n+@pytest.mark.skipif(not HAS_REGEX, reason=\"This test requires the regex library.\")\n+class TestRegexBrain:\n+    def test_regex_flags(self) -> None:\n+        \"\"\"Test that we have all regex enum flags in the brain.\"\"\"\n+        names = [name for name in dir(regex) if name.isupper()]\n+        re_ast = MANAGER.ast_from_module_name(\"regex\")\n+        for name in names:\n+            assert name in re_ast\n+            assert next(re_ast[name].infer()).value == getattr(regex, name)\n+\n+    @test_utils.require_version(minver=\"3.9\")\n+    def test_regex_pattern_and_match_subscriptable(self):\n+        \"\"\"Test regex.Pattern and regex.Match are subscriptable in PY39+\"\"\"\n+        node1 = builder.extract_node(\n+            \"\"\"\n+        import regex\n+        regex.Pattern[str]\n+        \"\"\"\n+        )\n+        inferred1 = next(node1.infer())\n+        assert isinstance(inferred1, nodes.ClassDef)\n+        assert isinstance(inferred1.getattr(\"__class_getitem__\")[0], nodes.FunctionDef)\n+\n+        node2 = builder.extract_node(\n+            \"\"\"\n+        import regex\n+        regex.Match[str]\n+        \"\"\"\n+        )\n+        inferred2 = next(node2.infer())\n+        assert isinstance(inferred2, nodes.ClassDef)\n+        assert isinstance(inferred2.getattr(\"__class_getitem__\")[0], nodes.FunctionDef)\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/15d2067bcc102e8bdf58d1428d17dcf5b8d6ad28"
}