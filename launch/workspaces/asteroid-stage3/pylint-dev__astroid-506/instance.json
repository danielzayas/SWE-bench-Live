{
  "all_hints_text": "\n\n",
  "base_commit": "f005552f45b6f731266f29ce909dbbc4a2ed4f9a",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/06273cd07d4b3701998df7b2c656d1b029bdee8e",
    "https://github.com/pylint-dev/astroid/commit/2101395b5887005a60154e991737012735ca91f2"
  ],
  "created_at": "2018-03-10T06:36:06Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-506",
  "issue_numbers": [
    112
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 278d6ed244..1d5002a325 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -65,6 +65,10 @@ Change log for the astroid package (used to be astng)\n \n         Close #1699\n \n+    * Implement inference for len builtin\n+\n+        Close #112\n+\n \n 2017-12-15 -- 1.6.0\n \ndiff --git a/astroid/brain/brain_builtin_inference.py b/astroid/brain/brain_builtin_inference.py\nindex dcb9f7a49e..b4174765b7 100644\n--- a/astroid/brain/brain_builtin_inference.py\n+++ b/astroid/brain/brain_builtin_inference.py\n@@ -186,7 +186,7 @@ def _infer_builtin(node, context,\n infer_tuple = partial(\n     _infer_builtin,\n     klass=nodes.Tuple,\n-    iterables=(nodes.List, nodes.Set, objects.FrozenSet,\n+    iterables=(nodes.List, nodes.Set, nodes.FrozenSet,\n                objects.DictItems, objects.DictKeys,\n                objects.DictValues),\n     build_elts=tuple)\n@@ -194,7 +194,7 @@ def _infer_builtin(node, context,\n infer_list = partial(\n     _infer_builtin,\n     klass=nodes.List,\n-    iterables=(nodes.Tuple, nodes.Set, objects.FrozenSet,\n+    iterables=(nodes.Tuple, nodes.Set, nodes.FrozenSet,\n                objects.DictItems, objects.DictKeys,\n                objects.DictValues),\n     build_elts=list)\n@@ -202,14 +202,14 @@ def _infer_builtin(node, context,\n infer_set = partial(\n     _infer_builtin,\n     klass=nodes.Set,\n-    iterables=(nodes.List, nodes.Tuple, objects.FrozenSet,\n+    iterables=(nodes.List, nodes.Tuple, nodes.FrozenSet,\n                objects.DictKeys),\n     build_elts=set)\n \n infer_frozenset = partial(\n     _infer_builtin,\n-    klass=objects.FrozenSet,\n-    iterables=(nodes.List, nodes.Tuple, nodes.Set, objects.FrozenSet,\n+    klass=nodes.FrozenSet,\n+    iterables=(nodes.List, nodes.Tuple, nodes.Set, nodes.FrozenSet,\n                objects.DictKeys),\n     build_elts=frozenset)\n \n@@ -618,6 +618,29 @@ def _class_or_tuple_to_container(node, context=None):\n     return class_container\n \n \n+def infer_len(node, context=None):\n+    \"\"\"Infer length calls\n+\n+    :param nodes.Call node: len call to infer\n+    :param context.InferenceContext: node context\n+    :rtype nodes.Const:\n+    \"\"\"\n+    call = arguments.CallSite.from_call(node)\n+    if call.keyword_arguments:\n+        raise UseInferenceDefault(\n+            \"TypeError: len() must take no keyword arguments\")\n+    if len(call.positional_arguments) != 1:\n+        raise UseInferenceDefault(\n+            \"TypeError: len() must take exactly one argument \"\n+            \"({len}) given\".format(len=len(call.positional_arguments)))\n+    [argument_node] = call.positional_arguments\n+    try:\n+        return nodes.Const(helpers.object_len(argument_node))\n+    except (AstroidTypeError, InferenceError) as exc:\n+        raise UseInferenceDefault(str(exc)) from exc\n+\n+\n+\n # Builtins inference\n register_builtin_transform(infer_bool, 'bool')\n register_builtin_transform(infer_super, 'super')\n@@ -633,6 +656,7 @@ def _class_or_tuple_to_container(node, context=None):\n register_builtin_transform(infer_slice, 'slice')\n register_builtin_transform(infer_isinstance, 'isinstance')\n register_builtin_transform(infer_issubclass, 'issubclass')\n+register_builtin_transform(infer_len, 'len')\n \n # Infer object.__new__ calls\n MANAGER.register_transform(\ndiff --git a/astroid/helpers.py b/astroid/helpers.py\nindex 7a6175cfd5..cd472af2ef 100644\n--- a/astroid/helpers.py\n+++ b/astroid/helpers.py\n@@ -222,3 +222,45 @@ def class_instance_as_index(node):\n     except exceptions.InferenceError:\n         pass\n     return None\n+\n+\n+def object_len(node, context=None):\n+    \"\"\"Infer length of given node object\n+\n+    :param Union[nodes.ClassDef, nodes.Instance] node:\n+    :param node: Node to infer length of\n+\n+    :raises AstroidTypeError: If an invalid node is returned\n+        from __len__ method or no __len__ method exists\n+    :raises InferenceError: If the given node cannot be inferred\n+        or if multiple nodes are inferred\n+    :rtype int: Integer length of node\n+    \"\"\"\n+    inferred_node = safe_infer(node, context=context)\n+    if inferred_node is None or inferred_node is util.Uninferable:\n+        raise exceptions.InferenceError(node=node)\n+    if inferred_node.qname() in ('builtins.str', 'builtins.bytes'):\n+        return len(inferred_node.value)\n+    if isinstance(inferred_node, (nodes.List, nodes.Set, nodes.Tuple, nodes.FrozenSet)):\n+        return len(inferred_node.elts)\n+    if isinstance(inferred_node, nodes.Dict):\n+        return len(inferred_node.items)\n+    try:\n+        node_type = object_type(inferred_node, context=context)\n+        len_call = next(node_type.igetattr(\"__len__\", context=context))\n+    except exceptions.AttributeInferenceError:\n+        raise exceptions.AstroidTypeError(\n+            \"object of type '{}' has no len()\"\n+            .format(len_call.pytype()))\n+\n+    try:\n+        result_of_len = next(len_call.infer_call_result(node, context))\n+        # Remove StopIteration catch when #507 is fixed\n+    except StopIteration:\n+        raise exceptions.InferenceError(node=node)\n+    if (isinstance(result_of_len, nodes.Const) and result_of_len.pytype() == \"builtins.int\"):\n+        return result_of_len.value\n+    else:\n+        raise exceptions.AstroidTypeError(\n+            \"'{}' object cannot be interpreted as an integer\"\n+            .format(result_of_len))\ndiff --git a/astroid/node_classes.py b/astroid/node_classes.py\nindex fba9e495e9..2f5fca9cbf 100644\n--- a/astroid/node_classes.py\n+++ b/astroid/node_classes.py\n@@ -2837,6 +2837,21 @@ def catch(self, exceptions): # pylint: disable=redefined-outer-name\n         return False\n \n \n+class FrozenSet(_BaseContainer):\n+    \"\"\"class representing a FrozenSet composite node\"\"\"\n+\n+    def pytype(self):\n+        return '%s.frozenset' % BUILTINS\n+\n+    def _infer(self, context=None):\n+        yield self\n+\n+    @decorators.cachedproperty\n+    def _proxied(self): # pylint: disable=method-hidden\n+        builtins = MANAGER.astroid_cache[BUILTINS]\n+        return builtins.getattr('frozenset')[0]\n+\n+\n class Exec(Statement):\n     \"\"\"Class representing the ``exec`` statement.\n \ndiff --git a/astroid/nodes.py b/astroid/nodes.py\nindex f9399a564a..00e1a34562 100644\n--- a/astroid/nodes.py\n+++ b/astroid/nodes.py\n@@ -20,7 +20,7 @@\n     AssignName, AugAssign, Repr, BinOp, BoolOp, Break, Call, Compare,\n     Comprehension, Const, Continue, Decorators, DelAttr, DelName, Delete,\n     Dict, Expr, Ellipsis, EmptyNode, ExceptHandler, Exec, ExtSlice, For,\n-    ImportFrom, Attribute, Global, If, IfExp, Import, Index, Keyword,\n+    FrozenSet, ImportFrom, Attribute, Global, If, IfExp, Import, Index, Keyword,\n     List, Name, Nonlocal, Pass, Print, Raise, Return, Set, Slice, Starred, Subscript,\n     TryExcept, TryFinally, Tuple, UnaryOp, While, With, Yield, YieldFrom,\n     const_factory,\ndiff --git a/astroid/objects.py b/astroid/objects.py\nindex 7a8734491f..f669b9a84c 100644\n--- a/astroid/objects.py\n+++ b/astroid/objects.py\n@@ -29,21 +29,6 @@\n objectmodel = util.lazy_import('interpreter.objectmodel')\n \n \n-class FrozenSet(node_classes._BaseContainer):\n-    \"\"\"class representing a FrozenSet composite node\"\"\"\n-\n-    def pytype(self):\n-        return '%s.frozenset' % BUILTINS\n-\n-    def _infer(self, context=None):\n-        yield self\n-\n-    @decorators.cachedproperty\n-    def _proxied(self): # pylint: disable=method-hidden\n-        builtins = MANAGER.astroid_cache[BUILTINS]\n-        return builtins.getattr('frozenset')[0]\n-\n-\n class Super(node_classes.NodeNG):\n     \"\"\"Proxy class over a super call.\n \n",
  "problem_statement": "Understand len builtin\nOriginally reported by: **Claudiu Popa (BitBucket: [PCManticore](http://bitbucket.org/PCManticore), GitHub: @PCManticore)**\n\n---\n\n---\n- Bitbucket: https://bitbucket.org/logilab/astroid/issue/112\n\n",
  "pull_number": 506,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/astroid/tests/unittest_brain.py b/astroid/tests/unittest_brain.py\nindex d261e6ca31..1408abd266 100644\n--- a/astroid/tests/unittest_brain.py\n+++ b/astroid/tests/unittest_brain.py\n@@ -1092,5 +1092,144 @@ def _get_result(code):\n     return _get_result_node(code).as_string()\n \n \n+class TestLenBuiltinInference:\n+    def test_len_list(self):\n+        # Uses .elts\n+        node = astroid.extract_node(\"\"\"\n+        len(['a','b','c'])\n+        \"\"\")\n+        node = next(node.infer())\n+        assert node.as_string() == '3'\n+        assert isinstance(node, nodes.Const)\n+\n+    def test_len_tuple(self):\n+        node = astroid.extract_node(\"\"\"\n+        len(('a','b','c'))\n+        \"\"\")\n+        node = next(node.infer())\n+        assert node.as_string() == '3'\n+\n+    def test_len_var(self):\n+        # Make sure argument is inferred\n+        node = astroid.extract_node(\"\"\"\n+        a = [1,2,'a','b','c']\n+        len(a)\n+        \"\"\")\n+        node = next(node.infer())\n+        assert node.as_string() == '5'\n+\n+    def test_len_dict(self):\n+        # Uses .items\n+        node = astroid.extract_node(\"\"\"\n+        a = {'a': 1, 'b': 2}\n+        len(a)\n+        \"\"\")\n+        node = next(node.infer())\n+        assert node.as_string() == '2'\n+\n+    def test_len_set(self):\n+        node = astroid.extract_node(\"\"\"\n+        len({'a'})\n+        \"\"\")\n+        inferred_node = next(node.infer())\n+        assert inferred_node.as_string() == '1'\n+\n+    def test_len_object(self):\n+        \"\"\"Test len with objects that implement the len protocol\"\"\"\n+        node = astroid.extract_node(\"\"\"\n+        class A:\n+            def __len__(self):\n+                return 57\n+        len(A())\n+        \"\"\")\n+        inferred_node = next(node.infer())\n+        assert inferred_node.as_string() == '57'\n+\n+    def test_len_class_with_metaclass(self):\n+        \"\"\"Make sure proper len method is located\"\"\"\n+        cls_node, inst_node = astroid.extract_node(\"\"\"\n+        class F2(type):\n+            def __new__(cls, name, bases, attrs):\n+                return super().__new__(cls, name, bases, {})\n+            def __len__(self):\n+                return 57\n+        class F(metaclass=F2):\n+            def __len__(self):\n+                return 4\n+        len(F) #@\n+        len(F()) #@\n+        \"\"\")\n+        assert next(cls_node.infer()).as_string() == '57'\n+        assert next(inst_node.infer()).as_string() == '4'\n+\n+    def test_len_object_failure(self):\n+        \"\"\"If taking the length of a class, do not use an instance method\"\"\"\n+        node = astroid.extract_node(\"\"\"\n+        class F:\n+            def __len__(self):\n+                return 57\n+        len(F)\n+        \"\"\")\n+        with pytest.raises(astroid.InferenceError):\n+            next(node.infer())\n+\n+    def test_len_string(self):\n+        node = astroid.extract_node(\"\"\"\n+        len(\"uwu\")\n+        \"\"\")\n+        assert next(node.infer()).as_string() == \"3\"\n+\n+    def test_len_generator_failure(self):\n+        node = astroid.extract_node(\"\"\"\n+        def gen():\n+            yield 'a'\n+            yield 'b'\n+        len(gen())\n+        \"\"\")\n+        with pytest.raises(astroid.InferenceError):\n+            next(node.infer())\n+\n+    def test_len_failure_missing_variable(self):\n+        node = astroid.extract_node(\"\"\"\n+        len(a)\n+        \"\"\")\n+        with pytest.raises(astroid.InferenceError):\n+            next(node.infer())\n+\n+    def test_len_bytes(self):\n+        node = astroid.extract_node(\"\"\"\n+        len(b'uwu')\n+        \"\"\")\n+        assert next(node.infer()).as_string() == '3'\n+\n+\n+    @pytest.mark.xfail(reason=\"Can't retrieve subclassed type value \")\n+    def test_int_subclass_result(self):\n+        \"\"\"I am unable to figure out the value of an\n+        object which subclasses int\"\"\"\n+        node = astroid.extract_node(\"\"\"\n+        class IntSubclass(int):\n+            pass\n+\n+        class F:\n+            def __len__(self):\n+                return IntSubclass(5)\n+        len(F())\n+        \"\"\")\n+        assert next(node.infer()).as_string() == '5'\n+\n+\n+    @pytest.mark.xfail(reason=\"Can't use list special astroid fields\")\n+    def test_int_subclass_argument(self):\n+        \"\"\"I am unable to access the length of a object which\n+        subclasses list\"\"\"\n+        node = astroid.extract_node(\"\"\"\n+        class ListSubclass(list):\n+            pass\n+        len(ListSubclass([1,2,3,4,4]))\n+        \"\"\")\n+        assert next(node.infer()).as_string() == '5'\n+\n+\n if __name__ == '__main__':\n     unittest.main()\ndiff --git a/astroid/tests/unittest_inference.py b/astroid/tests/unittest_inference.py\nindex 6508b3fea8..e8b074bd32 100644\n--- a/astroid/tests/unittest_inference.py\n+++ b/astroid/tests/unittest_inference.py\n@@ -26,7 +26,6 @@\n from astroid import decorators as decoratorsmod\n from astroid import exceptions\n from astroid import helpers\n-from astroid import objects\n from astroid import test_utils\n from astroid import util\n from astroid.tests import resources\n@@ -89,7 +88,7 @@ def assertInferDict(self, node, expected):\n     assertInferTuple = partialmethod(_assertInferElts, nodes.Tuple)\n     assertInferList = partialmethod(_assertInferElts, nodes.List)\n     assertInferSet = partialmethod(_assertInferElts, nodes.Set)\n-    assertInferFrozenSet = partialmethod(_assertInferElts, objects.FrozenSet)\n+    assertInferFrozenSet = partialmethod(_assertInferElts, nodes.FrozenSet)\n \n     CODE = '''\n         class C(object):\ndiff --git a/astroid/tests/unittest_objects.py b/astroid/tests/unittest_objects.py\nindex 0dba8deaa3..92e2c4c217 100644\n--- a/astroid/tests/unittest_objects.py\n+++ b/astroid/tests/unittest_objects.py\n@@ -21,7 +21,7 @@ def test_frozenset(self):\n         frozenset({1: 2, 2: 3}) #@\n         \"\"\")\n         inferred = next(node.infer())\n-        self.assertIsInstance(inferred, objects.FrozenSet)\n+        self.assertIsInstance(inferred, nodes.FrozenSet)\n \n         self.assertEqual(inferred.pytype(), \"%s.frozenset\" % bases.BUILTINS)\n \n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/f005552f45b6f731266f29ce909dbbc4a2ed4f9a"
}