{
  "all_hints_text": "_Original comment by_ **Claudiu Popa (BitBucket: [PCManticore](http://bitbucket.org/PCManticore), GitHub: @PCManticore)**:\n\n---\n\nActually this can happen if the tree was spliced from another and it is in the course of being transformed.\n\nWhy is this completed? \".root\" sometimes returns not a module. In particular, for some nodes made with `const_factory`\n#2672 gave an example of root not being a module but Unknown instead.\n```python\na=eval.__get__(1).__gt__\n\n@a\nclass c: ...\n```\n\n",
  "base_commit": "97aac5237d4dac1a6ebef606df75f92c630a3d33",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/26f72e6a9a21352779096af15425ccc0647af7a0",
    "https://github.com/pylint-dev/astroid/commit/14d565af7545231d67aefbdf2c61cbe27d969e6b",
    "https://github.com/pylint-dev/astroid/commit/0553256f9582f2e6029a375191c77bd59119e948",
    "https://github.com/pylint-dev/astroid/commit/db6a898b1c379534a94a4e5dda1c95c331ee5e79"
  ],
  "created_at": "2025-05-13T18:45:16Z",
  "hints_text": "_Original comment by_ **Claudiu Popa (BitBucket: [PCManticore](http://bitbucket.org/PCManticore), GitHub: @PCManticore)**:\n\n---\n\nActually this can happen if the tree was spliced from another and it is in the course of being transformed.\n\nWhy is this completed? \".root\" sometimes returns not a module. In particular, for some nodes made with `const_factory`\n\n",
  "instance_id": "pylint-dev__astroid-2744",
  "issue_numbers": [
    120
  ],
  "language": "python",
  "patch": "diff --git a/astroid/interpreter/objectmodel.py b/astroid/interpreter/objectmodel.py\nindex fd8c0c051..085bd2cc8 100644\n--- a/astroid/interpreter/objectmodel.py\n+++ b/astroid/interpreter/objectmodel.py\n@@ -228,17 +228,17 @@ def attr___package__(self):\n     @property\n     def attr___spec__(self):\n         # No handling for now.\n-        return node_classes.Unknown()\n+        return node_classes.Unknown(parent=self._instance)\n \n     @property\n     def attr___loader__(self):\n         # No handling for now.\n-        return node_classes.Unknown()\n+        return node_classes.Unknown(parent=self._instance)\n \n     @property\n     def attr___cached__(self):\n         # No handling for now.\n-        return node_classes.Unknown()\n+        return node_classes.Unknown(parent=self._instance)\n \n \n class FunctionModel(ObjectModel):\n@@ -462,7 +462,7 @@ def test(self):\n     # These are here just for completion.\n     @property\n     def attr___ne__(self):\n-        return node_classes.Unknown()\n+        return node_classes.Unknown(parent=self._instance)\n \n     attr___subclasshook__ = attr___ne__\n     attr___str__ = attr___ne__\n@@ -493,8 +493,8 @@ def __init__(self):\n         super().__init__()\n \n     @property\n-    def attr___annotations__(self) -> node_classes.Unkown:\n-        return node_classes.Unknown()\n+    def attr___annotations__(self) -> node_classes.Unknown:\n+        return node_classes.Unknown(parent=self._instance)\n \n     @property\n     def attr___module__(self):\ndiff --git a/astroid/nodes/node_classes.py b/astroid/nodes/node_classes.py\nindex ebfd5ffe8..d3aef1718 100644\n--- a/astroid/nodes/node_classes.py\n+++ b/astroid/nodes/node_classes.py\n@@ -4963,9 +4963,9 @@ class Unknown(_base_nodes.AssignTypeNode):\n \n     def __init__(\n         self,\n+        parent: NodeNG,\n         lineno: None = None,\n         col_offset: None = None,\n-        parent: None = None,\n         *,\n         end_lineno: None = None,\n         end_col_offset: None = None,\n@@ -4986,6 +4986,9 @@ def _infer(self, context: InferenceContext | None = None, **kwargs):\n         yield util.Uninferable\n \n \n+UNATTACHED_UNKNOWN = Unknown(parent=SYNTHETIC_ROOT)\n+\n+\n class EvaluatedObject(NodeNG):\n     \"\"\"Contains an object that has already been inferred\n \ndiff --git a/astroid/nodes/node_ng.py b/astroid/nodes/node_ng.py\nindex d3be04720..dc8942b70 100644\n--- a/astroid/nodes/node_ng.py\n+++ b/astroid/nodes/node_ng.py\n@@ -309,13 +309,13 @@ def scope(self) -> nodes.LocalsDictNodeNG:\n             raise ParentMissingError(target=self)\n         return self.parent.scope()\n \n-    def root(self) -> nodes.Module | nodes.Unknown:\n+    def root(self) -> nodes.Module:\n         \"\"\"Return the root node of the syntax tree.\n \n         :returns: The root node.\n         \"\"\"\n         if not (parent := self.parent):\n-            assert isinstance(self, (nodes.Module, nodes.Unknown))\n+            assert isinstance(self, nodes.Module)\n             return self\n \n         while parent.parent:\ndiff --git a/astroid/protocols.py b/astroid/protocols.py\nindex 8a837b86b..7cc50810f 100644\n--- a/astroid/protocols.py\n+++ b/astroid/protocols.py\n@@ -162,13 +162,13 @@ def _filter_uninferable_nodes(\n ) -> Iterator[SuccessfulInferenceResult]:\n     for elt in elts:\n         if isinstance(elt, util.UninferableBase):\n-            yield nodes.Unknown()\n+            yield node_classes.UNATTACHED_UNKNOWN\n         else:\n             for inferred in elt.infer(context):\n                 if not isinstance(inferred, util.UninferableBase):\n                     yield inferred\n                 else:\n-                    yield nodes.Unknown()\n+                    yield node_classes.UNATTACHED_UNKNOWN\n \n \n @decorators.yes_if_nothing_inferred\n",
  "problem_statement": "Raise an error if .root() is not a module\nOriginally reported by: **Claudiu Popa (BitBucket: [PCManticore](http://bitbucket.org/PCManticore), GitHub: @PCManticore)**\n\n---\n\n.root() should guarantee that what it returns is a module. Unfortunately, I found a couple of cases, which involved transforms, where .root() return classes instead of modules. We should raise an error in that case (and probably we should fix whatever was returning a class to return a module instead).\n\n---\n- Bitbucket: https://bitbucket.org/logilab/astroid/issue/120\n\n",
  "pull_number": 2744,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/test_helpers.py b/tests/test_helpers.py\nindex 170176f93..12168cf64 100644\n--- a/tests/test_helpers.py\n+++ b/tests/test_helpers.py\n@@ -11,6 +11,7 @@\n from astroid.builder import AstroidBuilder\n from astroid.const import IS_PYPY\n from astroid.exceptions import _NonDeducibleTypeHierarchy\n+from astroid.nodes.node_classes import UNATTACHED_UNKNOWN\n from astroid.nodes.scoped_nodes import ClassDef\n \n \n@@ -269,7 +270,7 @@ def test_uninferable_for_safe_infer() -> None:\n \n def test_safe_infer_shim() -> None:\n     with pytest.warns(DeprecationWarning) as records:\n-        helpers.safe_infer(nodes.Unknown())\n+        helpers.safe_infer(UNATTACHED_UNKNOWN)\n \n     assert (\n         \"Import safe_infer from astroid.util; this shim in astroid.helpers will be removed.\"\ndiff --git a/tests/test_nodes.py b/tests/test_nodes.py\nindex ffa511581..d6e3152dd 100644\n--- a/tests/test_nodes.py\n+++ b/tests/test_nodes.py\n@@ -37,6 +37,7 @@\n     StatementMissing,\n )\n from astroid.nodes.node_classes import (\n+    UNATTACHED_UNKNOWN,\n     AssignAttr,\n     AssignName,\n     Attribute,\n@@ -281,8 +282,10 @@ def test_f_strings(self):\n \n     @staticmethod\n     def test_as_string_unknown() -> None:\n-        assert nodes.Unknown().as_string() == \"Unknown.Unknown()\"\n-        assert nodes.Unknown(lineno=1, col_offset=0).as_string() == \"Unknown.Unknown()\"\n+        unknown1 = nodes.Unknown(parent=SYNTHETIC_ROOT)\n+        unknown2 = nodes.Unknown(lineno=1, col_offset=0, parent=SYNTHETIC_ROOT)\n+        assert unknown1.as_string() == \"Unknown.Unknown()\"\n+        assert unknown2.as_string() == \"Unknown.Unknown()\"\n \n     @staticmethod\n     @pytest.mark.skipif(\n@@ -1231,9 +1234,9 @@ def test_starred_store(self) -> None:\n \n def test_unknown() -> None:\n     \"\"\"Test Unknown node.\"\"\"\n-    assert isinstance(next(nodes.Unknown().infer()), type(util.Uninferable))\n-    assert isinstance(nodes.Unknown().name, str)\n-    assert isinstance(nodes.Unknown().qname(), str)\n+    assert isinstance(next(UNATTACHED_UNKNOWN.infer()), type(util.Uninferable))\n+    assert isinstance(UNATTACHED_UNKNOWN.name, str)\n+    assert isinstance(UNATTACHED_UNKNOWN.qname(), str)\n \n \n def test_type_comments_with() -> None:\n@@ -1963,7 +1966,7 @@ def test_str_repr_no_warnings(node):\n             \"NodeNG\" in param_type.annotation\n             or \"SuccessfulInferenceResult\" in param_type.annotation\n         ):\n-            args[name] = nodes.Unknown()\n+            args[name] = UNATTACHED_UNKNOWN\n         elif \"str\" in param_type.annotation:\n             args[name] = \"\"\n         else:\ndiff --git a/tests/test_regrtest.py b/tests/test_regrtest.py\nindex 9b3471772..861f4e262 100644\n--- a/tests/test_regrtest.py\n+++ b/tests/test_regrtest.py\n@@ -502,7 +502,7 @@ def _get_option(self, option):\n \n def test_regression_root_is_not_a_module() -> None:\n     \"\"\"Regression test for #2672.\"\"\"\n-    node: nodes.Attribute = _extract_single_node(\n+    node: nodes.ClassDef = _extract_single_node(\n         textwrap.dedent(\n             \"\"\"\n         a=eval.__get__(1).__gt__\n@@ -515,6 +515,14 @@ class c: ...\n     assert node.name == \"c\"\n \n \n+@pytest.mark.xfail(reason=\"Not fixed yet\")\n+def test_regression_eval_get_of_arg() -> None:\n+    \"\"\"Regression test for #2743\"\"\"\n+    node = _extract_single_node(\"eval.__get__(1)\")\n+    with pytest.raises(InferenceError):\n+        next(node.infer())\n+\n+\n def test_regression_no_crash_during_build() -> None:\n     node: nodes.Attribute = extract_node(\"__()\")\n     assert node.args == []\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/97aac5237d4dac1a6ebef606df75f92c630a3d33"
}