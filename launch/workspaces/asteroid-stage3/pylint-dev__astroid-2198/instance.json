{
  "all_hints_text": "The first issue is caused by the fact that the `str` relies on `postinit` being called I think.\r\n\r\nI ran into this while debugging `astroid` many times..\nI made a quick unit test on #2198. Am I going in the right direction? Also, I guess fixing the errors themselves will be part of this issue right?\nI'd prefer using `pytest` semantics instead of `unittests` but that's more a review comment.\r\n\r\nI think the bigger issue is that the reliance on `__postinit__` makes this very hard to solve. We would need to revisit either 1) what we put in the `__str__` or 2) how we instantiate nodes. Both are not optimal I think.\nI labeled this as a good first issue because I was hoping it wasn't requiring knowledge of any of that, just placing a good blank placeholder in the str/repr when the info is not available.\nThat would require a fix here:\r\nhttps://github.com/pylint-dev/astroid/blob/a6eb2b87c5bfa39929b8047010788afce48461bf/astroid/nodes/node_ng.py#L213\r\n\r\nI guess that would work? We don't really need a regression test for it though (I think).\nLGTM. There are bunch of overridden `__str__` methods that might have similar problems, so I was thinking the unit tests would be nice. But if we find no other problems in the other methods, then such a test could be overly paranoid. EDIT: but writing the test would be the fastest way to find out!\n\n",
  "base_commit": "61ca2e832dd1f99ed7de5c7c403031292993d6fd",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/f5028e230d4d0320e31af5f7014f08ba0b0666aa"
  ],
  "created_at": "2023-06-06T20:17:57Z",
  "hints_text": "The first issue is caused by the fact that the `str` relies on `postinit` being called I think.\r\n\r\nI ran into this while debugging `astroid` many times..\n\n",
  "instance_id": "pylint-dev__astroid-2198",
  "issue_numbers": [
    1881
  ],
  "language": "python",
  "patch": "diff --git a/astroid/nodes/node_ng.py b/astroid/nodes/node_ng.py\nindex 977469df90..af2d270e1b 100644\n--- a/astroid/nodes/node_ng.py\n+++ b/astroid/nodes/node_ng.py\n@@ -210,7 +210,7 @@ def __str__(self) -> str:\n             alignment = len(cname) + 1\n         result = []\n         for field in self._other_fields + self._astroid_fields:\n-            value = getattr(self, field)\n+            value = getattr(self, field, \"Unknown\")\n             width = 80 - len(field) - alignment\n             lines = pprint.pformat(value, indent=2, width=width).splitlines(True)\n \n@@ -227,6 +227,11 @@ def __str__(self) -> str:\n \n     def __repr__(self) -> str:\n         rname = self.repr_name()\n+        # The dependencies used to calculate fromlineno (if not cached) may not exist at the time\n+        try:\n+            lineno = self.fromlineno\n+        except AttributeError:\n+            lineno = 0\n         if rname:\n             string = \"<%(cname)s.%(rname)s l.%(lineno)s at 0x%(id)x>\"\n         else:\n@@ -234,7 +239,7 @@ def __repr__(self) -> str:\n         return string % {\n             \"cname\": type(self).__name__,\n             \"rname\": rname,\n-            \"lineno\": self.fromlineno,\n+            \"lineno\": lineno,\n             \"id\": id(self),\n         }\n \n",
  "problem_statement": "Some `__str__` methods of nodes raise errors and warnings\n### Steps to reproduce\r\n```python\r\n>>> fd = astroid.nodes.FunctionDef()\r\n>>> str(fd)\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/Users/jacobwalls/astroid/astroid/nodes/node_ng.py\", line 219, in __str__\r\n    value = getattr(self, field)\r\n            ^^^^^^^^^^^^^^^^^^^^\r\nAttributeError: 'FunctionDef' object has no attribute 'args'\r\n```\r\n\r\nLess severely, but still not great, launching python with warnings e.g. `python -Wall`:\r\n```python\r\n>>> cd = astroid.nodes.ClassDef()\r\n>>> str(cd)\r\n/Users/.../astroid/astroid/nodes/scoped_nodes/scoped_nodes.py:2041: DeprecationWarning: The 'ClassDef.doc' attribute is deprecated, use 'ClassDef.doc_node' instead.\r\n```\r\n\r\n***\r\nWe should add a unittest that generates the `str()` and `repr()` of all node types.\r\n\r\n### `python -c \"from astroid import __pkginfo__; print(__pkginfo__.version)\"` output\r\n2.12.13\n",
  "pull_number": 2198,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/test_nodes.py b/tests/test_nodes.py\nindex 6303bbef28..d5c017dfc4 100644\n--- a/tests/test_nodes.py\n+++ b/tests/test_nodes.py\n@@ -7,7 +7,9 @@\n from __future__ import annotations\n \n import copy\n+import inspect\n import os\n+import random\n import sys\n import textwrap\n import unittest\n@@ -1880,3 +1882,35 @@ def return_from_match(x):\n         inferred = node.inferred()\n         assert len(inferred) == 2\n         assert [inf.value for inf in inferred] == [10, -1]\n+\n+\n+@pytest.mark.parametrize(\n+    \"node\",\n+    [\n+        node\n+        for node in astroid.nodes.ALL_NODE_CLASSES\n+        if node.__name__\n+        not in [\"_BaseContainer\", \"BaseContainer\", \"NodeNG\", \"const_factory\"]\n+    ],\n+)\n+@pytest.mark.filterwarnings(\"error\")\n+def test_str_repr_no_warnings(node):\n+    parameters = inspect.signature(node.__init__).parameters\n+\n+    args = {}\n+    for name, param_type in parameters.items():\n+        if name == \"self\":\n+            continue\n+\n+        if \"int\" in param_type.annotation:\n+            args[name] = random.randint(0, 50)\n+        elif \"NodeNG\" in param_type.annotation:\n+            args[name] = nodes.Unknown()\n+        elif \"str\" in param_type.annotation:\n+            args[name] = \"\"\n+        else:\n+            args[name] = None\n+\n+    test_node = node(**args)\n+    str(test_node)\n+    repr(test_node)\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/61ca2e832dd1f99ed7de5c7c403031292993d6fd"
}