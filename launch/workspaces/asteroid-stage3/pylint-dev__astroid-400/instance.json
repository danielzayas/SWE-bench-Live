{
  "all_hints_text": "\n\n",
  "base_commit": "ace4088b9837fc07a529edbb57b74583168da009",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/d50417eea03d2e0098f4309166acc4aff652f51b",
    "https://github.com/pylint-dev/astroid/commit/edee41c6ffbc7fddbfada91b7d0b069a46b6d648",
    "https://github.com/pylint-dev/astroid/commit/df99e25f292aa987f6c533f461666095781e6eed",
    "https://github.com/pylint-dev/astroid/commit/30dad28076353d8890b6542e60117d6205fc97ba",
    "https://github.com/pylint-dev/astroid/commit/1a12c78b5444c27ff4cea448f9a5d95bfb142842",
    "https://github.com/pylint-dev/astroid/commit/f8eec36010a522b978567709beee8d99fa1c7316",
    "https://github.com/pylint-dev/astroid/commit/17874b88d3836c15c25f88a974e1350412b9cc10",
    "https://github.com/pylint-dev/astroid/commit/00e28c5cabb88f06844c396a37d0969b51feda8e",
    "https://github.com/pylint-dev/astroid/commit/714abcc4758ff2120a0824533a2d075a8a57da69"
  ],
  "created_at": "2017-02-07T21:49:58Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-400",
  "issue_numbers": [
    399
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 568d2beb1d..f895040d37 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -177,6 +177,9 @@ Change log for the astroid package (used to be astng)\n     * Starred expressions are now inferred correctly for tuple,\n       list, set, and dictionary literals.\n \n+    * Support for asynchronous comprehensions introduced in Python 3.6.\n+\n+      Fixes #399. See PEP530 for details.\n \n 2015-11-29 -- 1.4.1\n \ndiff --git a/astroid/as_string.py b/astroid/as_string.py\nindex fc4c8e4cc1..85afdc3077 100644\n--- a/astroid/as_string.py\n+++ b/astroid/as_string.py\n@@ -503,6 +503,11 @@ def visit_joinedstr(self, node):\n     def visit_formattedvalue(self, node):\n         return '{%s}' % node.value.accept(self)\n \n+    def visit_comprehension(self, node):\n+        \"\"\"return an astroid.Comprehension node as string\"\"\"\n+        return '%s%s' % ('async ' if node.is_async else '',\n+                         super(AsStringVisitor3, self).visit_comprehension(node))\n+\n \n def _import_string(names):\n     \"\"\"return a list of (name, asname) formatted as a string\"\"\"\ndiff --git a/astroid/node_classes.py b/astroid/node_classes.py\nindex b3a42ad21c..cfd6004250 100644\n--- a/astroid/node_classes.py\n+++ b/astroid/node_classes.py\n@@ -1210,19 +1210,22 @@ def last_child(self):\n class Comprehension(NodeNG):\n     \"\"\"class representing a Comprehension node\"\"\"\n     _astroid_fields = ('target', 'iter', 'ifs')\n+    _other_fields = ('is_async',)\n     target = None\n     iter = None\n     ifs = None\n+    is_async = None\n \n     def __init__(self, parent=None):\n         super(Comprehension, self).__init__()\n         self.parent = parent\n \n     # pylint: disable=redefined-builtin; same name as builtin ast module.\n-    def postinit(self, target=None, iter=None, ifs=None):\n+    def postinit(self, target=None, iter=None, ifs=None, is_async=None):\n         self.target = target\n         self.iter = iter\n         self.ifs = ifs\n+        self.is_async = is_async\n \n     optional_assign = True\n     def assign_type(self):\ndiff --git a/astroid/protocols.py b/astroid/protocols.py\nindex a6e6a97c4e..d1abdea068 100644\n--- a/astroid/protocols.py\n+++ b/astroid/protocols.py\n@@ -242,6 +242,10 @@ def _resolve_looppart(parts, asspath, context):\n \n @decorators.raise_if_nothing_inferred\n def for_assigned_stmts(self, node=None, context=None, asspath=None):\n+    if isinstance(self, nodes.AsyncFor) or getattr(self, 'is_async', False):\n+        # Skip inferring of async code for now\n+        raise StopIteration(dict(node=self, unknown=node,\n+                                 assign_path=asspath, context=context))\n     if asspath is None:\n         for lst in self.iter.infer(context):\n             if isinstance(lst, (nodes.Tuple, nodes.List)):\ndiff --git a/astroid/rebuilder.py b/astroid/rebuilder.py\nindex f66809bc4e..115a8d45ce 100644\n--- a/astroid/rebuilder.py\n+++ b/astroid/rebuilder.py\n@@ -358,7 +358,8 @@ def visit_comprehension(self, node, parent):\n         newnode.postinit(self.visit(node.target, newnode),\n                          self.visit(node.iter, newnode),\n                          [self.visit(child, newnode)\n-                          for child in node.ifs])\n+                          for child in node.ifs],\n+                         getattr(node, 'is_async', None))\n         return newnode\n \n     def visit_decorators(self, node, parent):\n",
  "problem_statement": "Support for asynchronous comprehensions\nSee https://www.python.org/dev/peps/pep-0530/ for details\r\n\n",
  "pull_number": 400,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/astroid/tests/unittest_python3.py b/astroid/tests/unittest_python3.py\nindex 671ea011f9..ea8172728c 100644\n--- a/astroid/tests/unittest_python3.py\n+++ b/astroid/tests/unittest_python3.py\n@@ -267,7 +267,70 @@ def test_underscores_in_numeral_literal(self):\n             self.assertIsInstance(inferred, nodes.Const)\n             self.assertEqual(inferred.value, expected)\n \n+    @require_version('3.6')\n+    def test_async_comprehensions(self):\n+        async_comprehensions = [\n+            extract_node(\"async def f(): return __([i async for i in aiter() if i % 2])\"),\n+            extract_node(\"async def f(): return __({i async for i in aiter() if i % 2})\"),\n+            extract_node(\"async def f(): return __((i async for i in aiter() if i % 2))\"),\n+            extract_node(\"async def f(): return __({i: i async for i in aiter() if i % 2})\")\n+        ]\n+        non_async_comprehensions = [\n+            extract_node(\"async def f(): return __({i: i for i in iter() if i % 2})\")\n+        ]\n+\n+        for comp in async_comprehensions:\n+            self.assertTrue(comp.generators[0].is_async)\n+        for comp in non_async_comprehensions:\n+            self.assertFalse(comp.generators[0].is_async)\n+\n+    @require_version('3.7')\n+    def test_async_comprehensions_outside_coroutine(self):\n+        # When async and await will become keywords, async comprehensions\n+        # will be allowed outside of coroutines body\n+        comprehensions = [\n+            \"[i async for i in aiter() if condition(i)]\",\n+            \"[await fun() for fun in funcs]\",\n+            \"{await fun() for fun in funcs}\",\n+            \"{fun: await fun() for fun in funcs}\",\n+            \"[await fun() for fun in funcs if await smth]\",\n+            \"{await fun() for fun in funcs if await smth}\",\n+            \"{fun: await fun() for fun in funcs if await smth}\",\n+            \"[await fun() async for fun in funcs]\",\n+            \"{await fun() async for fun in funcs}\",\n+            \"{fun: await fun() async for fun in funcs}\",\n+            \"[await fun() async for fun in funcs if await smth]\",\n+            \"{await fun() async for fun in funcs if await smth}\",\n+            \"{fun: await fun() async for fun in funcs if await smth}\",\n+        ]\n \n+        for comp in comprehensions:\n+            node = extract_node(comp)\n+            self.assertTrue(node.generators[0].is_async)\n+\n+    @require_version('3.6')\n+    def test_async_comprehensions_as_string(self):\n+        func_bodies = [\n+            \"return [i async for i in aiter() if condition(i)]\",\n+            \"return [await fun() for fun in funcs]\",\n+            \"return {await fun() for fun in funcs}\",\n+            \"return {fun: await fun() for fun in funcs}\",\n+            \"return [await fun() for fun in funcs if await smth]\",\n+            \"return {await fun() for fun in funcs if await smth}\",\n+            \"return {fun: await fun() for fun in funcs if await smth}\",\n+            \"return [await fun() async for fun in funcs]\",\n+            \"return {await fun() async for fun in funcs}\",\n+            \"return {fun: await fun() async for fun in funcs}\",\n+            \"return [await fun() async for fun in funcs if await smth]\",\n+            \"return {await fun() async for fun in funcs if await smth}\",\n+            \"return {fun: await fun() async for fun in funcs if await smth}\",\n+        ]\n+        for func_body in func_bodies:\n+            code = dedent('''\n+            async def f():\n+                {}'''.format(func_body))\n+            func = extract_node(code)\n+            self.assertEqual(func.as_string().strip(), code.strip())\n \n \n if __name__ == '__main__':\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/ace4088b9837fc07a529edbb57b74583168da009"
}