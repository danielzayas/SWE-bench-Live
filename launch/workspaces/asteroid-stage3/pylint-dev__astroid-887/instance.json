{
  "all_hints_text": "Hi, thanks for the report. I tried to reproduce this but I was not able, can you paste the exact code you used to demonstrate the issue?\n@PCManticore, reproducibility of this one is straightforward to me, here's a (partial) example \u2014 but note that I had a typo in the original snippet: I missed the colon after `type`, which I just fixed; perhaps this is the reason you couldn't reproduce?\r\n\r\nAssume an AST visitor with:\r\n\r\n```\r\ndef visit_functiondef(self, node: nodes.FunctionDef)\r\n   print(f'the parent of type comment return is {node.type_comment_returns.parent}')\r\n```\r\n\r\nTo me, this prints:\r\n<img width=\"565\" alt=\"Screen Shot 2021-01-04 at 12 06 04\" src=\"https://user-images.githubusercontent.com/2905588/103548904-3a42b800-4e85-11eb-8bca-aa2f9a17313f.png\">\r\n\r\n\r\n\r\n\nI've just hit this myself. Here's what I did to reproduce:\r\n\r\n```python\r\n>>> import astroid\r\n>>> f = astroid.extract_node(\"\"\"\r\ndef f(a):\r\n    # type: (A) -> None\r\n    pass\r\n\"\"\")\r\n>>> f.type_comment_args[0].parent\r\n<ast.FunctionDef object at 0x7f0b0fb077f0>\r\n```\nThanks @AWhetter and @ltcmelo \n\n",
  "base_commit": "5f67396894c79c4661e357ec8bb03aa134a51109",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/217aa531a438c3b25cea8ecfd1bb0b834f5bc4f8"
  ],
  "created_at": "2021-01-31T06:43:56Z",
  "hints_text": "Hi, thanks for the report. I tried to reproduce this but I was not able, can you paste the exact code you used to demonstrate the issue?\n@PCManticore, reproducibility of this one is straightforward to me, here's a (partial) example \u2014 but note that I had a typo in the original snippet: I missed the colon after `type`, which I just fixed; perhaps this is the reason you couldn't reproduce?\r\n\r\nAssume an AST visitor with:\r\n\r\n```\r\ndef visit_functiondef(self, node: nodes.FunctionDef)\r\n   print(f'the parent of type comment return is {node.type_comment_returns.parent}')\r\n```\r\n\r\nTo me, this prints:\r\n<img width=\"565\" alt=\"Screen Shot 2021-01-04 at 12 06 04\" src=\"https://user-images.githubusercontent.com/2905588/103548904-3a42b800-4e85-11eb-8bca-aa2f9a17313f.png\">\r\n\r\n\r\n\r\n\n\n",
  "instance_id": "pylint-dev__astroid-887",
  "issue_numbers": [
    851
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 9ff42a6e77..be30ed4525 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -119,6 +119,13 @@ Release Date: TBA\n \n   Close PyCQA/pylint#3904\n \n+* Corrected the parent of function type comment nodes.\n+\n+  These nodes used to be parented to their original ast.FunctionDef parent\n+  but are now correctly parented to their astroid.FunctionDef parent.\n+\n+  Close PyCQA/astroid#851\n+\n \n What's New in astroid 2.4.2?\n ============================\ndiff --git a/astroid/rebuilder.py b/astroid/rebuilder.py\nindex 3fc1a83f2b..e56abbf878 100644\n--- a/astroid/rebuilder.py\n+++ b/astroid/rebuilder.py\n@@ -238,7 +238,7 @@ def check_type_comment(self, node, parent):\n \n         return type_object.value\n \n-    def check_function_type_comment(self, node):\n+    def check_function_type_comment(self, node, parent):\n         type_comment = getattr(node, \"type_comment\", None)\n         if not type_comment:\n             return None\n@@ -251,10 +251,10 @@ def check_function_type_comment(self, node):\n \n         returns = None\n         argtypes = [\n-            self.visit(elem, node) for elem in (type_comment_ast.argtypes or [])\n+            self.visit(elem, parent) for elem in (type_comment_ast.argtypes or [])\n         ]\n         if type_comment_ast.returns:\n-            returns = self.visit(type_comment_ast.returns, node)\n+            returns = self.visit(type_comment_ast.returns, parent)\n \n         return returns, argtypes\n \n@@ -615,7 +615,7 @@ def _visit_functiondef(self, cls, node, parent):\n             returns = None\n \n         type_comment_args = type_comment_returns = None\n-        type_comment_annotation = self.check_function_type_comment(node)\n+        type_comment_annotation = self.check_function_type_comment(node, newnode)\n         if type_comment_annotation:\n             type_comment_returns, type_comment_args = type_comment_annotation\n         newnode.postinit(\n",
  "problem_statement": "calling `parent` on a node that is part of a type comment returns the (original) `_ast` module's FunctionDef\nConsider this snippet:\r\n\r\n```python\r\ndef f(s):\r\n    # type: (str) -> int\r\n    return 42\r\n```\r\n\r\nGiven the `node` from the type comment, `Name.int(name='int')`, if I call its parent (i.e., `node.parent`), I get the original _ast module's FunctionDef, instead of astroid's FunctionDef.\r\n\n",
  "pull_number": 887,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_nodes.py b/tests/unittest_nodes.py\nindex d138ee1704..0ba6b3e541 100644\n--- a/tests/unittest_nodes.py\n+++ b/tests/unittest_nodes.py\n@@ -1181,6 +1181,19 @@ def f_arg_comment(\n                 assert actual_arg.as_string() == expected_arg\n \n \n+@pytest.mark.skipif(not HAS_TYPED_AST, reason=\"requires typed_ast\")\n+def test_correct_function_type_comment_parent():\n+    data = \"\"\"\n+        def f(a):\n+            # type: (A) -> A\n+            pass\n+    \"\"\"\n+    astroid = builder.parse(data)\n+    f = astroid.body[0]\n+    assert f.type_comment_args[0].parent is f\n+    assert f.type_comment_returns.parent is f\n+\n+\n def test_is_generator_for_yield_assignments():\n     node = astroid.extract_node(\n         \"\"\"\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/5f67396894c79c4661e357ec8bb03aa134a51109"
}