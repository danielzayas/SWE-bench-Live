{
  "all_hints_text": "How can I learn as begineer\nHi @Keuricloud8866, what do you want to learn ? In order to fix this ticket you should track the place where setuptools and distutils are used in pylint and find an alternative. For finding alternative we'll probably have to discuss how to do what we were doing before without setuptools.\nI am new and begineer in software IT world i just jumped in and want to be in so \nYou should probably check a tutorial about learning programming first. Another useful thing would be to know how to ask question:\r\n- First read the error or documentation\r\n- Second search Google or Stackoverflow\r\n- Third ask for help in the right place\r\n\r\nDid you search how to learn programming by yourself first and read a blog about it ? I think you jumped to three and this is not the right place to ask either. This is an issue about a particular issue in a particular software, you were very unlikely to get answers here. (in fact please do not ask other off-topic questions or I'll have to ban you).\nDo we still need to dependency on `setuptools` now? It was added in https://github.com/PyCQA/astroid/commit/40629baba2de2c9eb5e11b65798b3fae79f7284a.\r\nNow that we have removed `distutils` I don't think it is necessary, right?\nProbably ? I'm trying to think of a way to test that. Maybe launching pylint test suite in a venv after we deinstalled ``setuptools`` ?\n\nDoing #1103 would remove the import time from ``pkg_resources`` and ``distutils`` which are non negligible.\nAnother possible culprit is the use of `NamedTuple`, see https://lwn.net/Articles/730915/\n> Another possible culprit is the use of NamedTuple, see https://lwn.net/Articles/730915/\r\n\r\nThanks for the link, interesting read. Looks like it was optimized in Python 3.7.\nBy removing `pkg_resources`, https://github.com/PyCQA/astroid/pull/1536 reduces the time to import `astroid` to c.33% of what it was (i.e. 67% reduction) on a slow cloud console and about 50% of what it was on an M1 Mac. I think I will link that PR to close this issue.\n\n",
  "base_commit": "fb31eede489b45498e65b1921b537f7bd2dd8c9b",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/22bca184df3d2fbbfa2f32eab89fbb9ef076d97d",
    "https://github.com/pylint-dev/astroid/commit/f53159ea09fc7c7106f4ca321d2ddeaf66938693",
    "https://github.com/pylint-dev/astroid/commit/0c536f1a513f4e6666aef17fc1f69192c37e2bf7",
    "https://github.com/pylint-dev/astroid/commit/52eb0955e4941b2d0f77540712810402a0827a52",
    "https://github.com/pylint-dev/astroid/commit/3175f0d0e80e805fc2b495beca9842ff033ee040",
    "https://github.com/pylint-dev/astroid/commit/c8e2764359c1a718e1ce0d0dd9763a46c6a356be",
    "https://github.com/pylint-dev/astroid/commit/46a5d2970b36ef0e64500e14447c758e1ce87b87",
    "https://github.com/pylint-dev/astroid/commit/cbb47d93e292f83ad0c414a65f59e86fd359447b",
    "https://github.com/pylint-dev/astroid/commit/4394f6d2b61322e0d1ec8bb6b81b340ae2d579bc",
    "https://github.com/pylint-dev/astroid/commit/ee77bfda4693a75bbafa5ede36a4da6696efdbe2",
    "https://github.com/pylint-dev/astroid/commit/d116d52d9b8a144afd0830b511a24268795e0d8d",
    "https://github.com/pylint-dev/astroid/commit/2054a5683c685af7cb53a3142f8cd1c29b21e202",
    "https://github.com/pylint-dev/astroid/commit/2697e10c07dc8c98fb3871ed4b7fce23e11d0460",
    "https://github.com/pylint-dev/astroid/commit/c46e4438d13d4d018651543ba7d4bbdbc2327f09",
    "https://github.com/pylint-dev/astroid/commit/6d088abe805d6f60103124b2c207f6687d4f7a53",
    "https://github.com/pylint-dev/astroid/commit/7aa7da459e1181167fef1b6f5f0516ce37b83235",
    "https://github.com/pylint-dev/astroid/commit/fa6094062099de924f95242f1f1971add0e39f10",
    "https://github.com/pylint-dev/astroid/commit/d0b90f48d8bf2e5223649209b3837686f8b1b19a",
    "https://github.com/pylint-dev/astroid/commit/f30e100645e4d42e901c31d0a188befb66220cc7",
    "https://github.com/pylint-dev/astroid/commit/3dbe761e92bd58fa1466770a815b27a8f011b670",
    "https://github.com/pylint-dev/astroid/commit/d92c48eccf48ea7e50cb8696e2746a2070bdbc1d",
    "https://github.com/pylint-dev/astroid/commit/01b00a26380adadb9c37a0ca606d807883bd3455"
  ],
  "created_at": "2022-05-01T14:27:44Z",
  "hints_text": "How can I learn as begineer\nHi @Keuricloud8866, what do you want to learn ? In order to fix this ticket you should track the place where setuptools and distutils are used in pylint and find an alternative. For finding alternative we'll probably have to discuss how to do what we were doing before without setuptools.\nI am new and begineer in software IT world i just jumped in and want to be in so \nYou should probably check a tutorial about learning programming first. Another useful thing would be to know how to ask question:\r\n- First read the error or documentation\r\n- Second search Google or Stackoverflow\r\n- Third ask for help in the right place\r\n\r\nDid you search how to learn programming by yourself first and read a blog about it ? I think you jumped to three and this is not the right place to ask either. This is an issue about a particular issue in a particular software, you were very unlikely to get answers here. (in fact please do not ask other off-topic questions or I'll have to ban you).\nDo we still need to dependency on `setuptools` now? It was added in https://github.com/PyCQA/astroid/commit/40629baba2de2c9eb5e11b65798b3fae79f7284a.\r\nNow that we have removed `distutils` I don't think it is necessary, right?\nProbably ? I'm trying to think of a way to test that. Maybe launching pylint test suite in a venv after we deinstalled ``setuptools`` ?\n\nDoing #1103 would remove the import time from ``pkg_resources`` and ``distutils`` which are non negligible.\nAnother possible culprit is the use of `NamedTuple`, see https://lwn.net/Articles/730915/\n\n",
  "instance_id": "pylint-dev__astroid-1536",
  "issue_numbers": [
    1103,
    1320
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex bd6ed51cda..06a7163ff6 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -15,6 +15,10 @@ Release date: TBA\n \n   Closes #1512\n \n+* Remove dependency on ``pkg_resources`` from ``setuptools``.\n+\n+  Closes #1103\n+\n * Allowed ``AstroidManager.clear_cache`` to reload necessary brain plugins.\n \n * Rename ``ModuleSpec`` -> ``module_type`` constructor parameter to match attribute\ndiff --git a/astroid/interpreter/_import/spec.py b/astroid/interpreter/_import/spec.py\nindex c0601613d9..74a0e8081f 100644\n--- a/astroid/interpreter/_import/spec.py\n+++ b/astroid/interpreter/_import/spec.py\n@@ -10,6 +10,7 @@\n import importlib.machinery\n import importlib.util\n import os\n+import pathlib\n import sys\n import zipimport\n from collections.abc import Sequence\n@@ -147,7 +148,7 @@ def contribute_to_path(self, spec, processed):\n             # Builtin.\n             return None\n \n-        if _is_setuptools_namespace(spec.location):\n+        if _is_setuptools_namespace(Path(spec.location)):\n             # extend_path is called, search sys.path for module/packages\n             # of this name see pkgutil.extend_path documentation\n             path = [\n@@ -179,7 +180,7 @@ def contribute_to_path(self, spec, processed):\n \n \n class ExplicitNamespacePackageFinder(ImportlibFinder):\n-    \"\"\"A finder for the explicit namespace packages, generated through pkg_resources.\"\"\"\n+    \"\"\"A finder for the explicit namespace packages.\"\"\"\n \n     def find_module(self, modname, module_parts, processed, submodule_path):\n         if processed:\n@@ -256,12 +257,12 @@ def contribute_to_path(self, spec, processed):\n )\n \n \n-def _is_setuptools_namespace(location):\n+def _is_setuptools_namespace(location: pathlib.Path) -> bool:\n     try:\n-        with open(os.path.join(location, \"__init__.py\"), \"rb\") as stream:\n+        with open(location / \"__init__.py\", \"rb\") as stream:\n             data = stream.read(4096)\n     except OSError:\n-        return None\n+        return False\n     else:\n         extend_path = b\"pkgutil\" in data and b\"extend_path\" in data\n         declare_namespace = (\ndiff --git a/astroid/interpreter/_import/util.py b/astroid/interpreter/_import/util.py\nindex ce3da7eac2..53c6922c33 100644\n--- a/astroid/interpreter/_import/util.py\n+++ b/astroid/interpreter/_import/util.py\n@@ -2,15 +2,35 @@\n # For details: https://github.com/PyCQA/astroid/blob/main/LICENSE\n # Copyright (c) https://github.com/PyCQA/astroid/blob/main/CONTRIBUTORS.txt\n \n-try:\n-    import pkg_resources\n-except ImportError:\n-    pkg_resources = None  # type: ignore[assignment]\n+import sys\n+from functools import lru_cache\n+from importlib.util import _find_spec_from_path\n \n \n-def is_namespace(modname):\n-    return (\n-        pkg_resources is not None\n-        and hasattr(pkg_resources, \"_namespace_packages\")\n-        and modname in pkg_resources._namespace_packages\n-    )\n+@lru_cache(maxsize=4096)\n+def is_namespace(modname: str) -> bool:\n+    if modname in sys.builtin_module_names:\n+        return False\n+\n+    found_spec = None\n+\n+    # find_spec() attempts to import parent packages when given dotted paths.\n+    # That's unacceptable here, so we fallback to _find_spec_from_path(), which does\n+    # not, but requires instead that each single parent ('astroid', 'nodes', etc.)\n+    # be specced from left to right.\n+    processed_components = []\n+    last_parent = None\n+    for component in modname.split(\".\"):\n+        processed_components.append(component)\n+        working_modname = \".\".join(processed_components)\n+        try:\n+            found_spec = _find_spec_from_path(working_modname, last_parent)\n+        except ValueError:\n+            # executed .pth files may not have __spec__\n+            return True\n+        last_parent = working_modname\n+\n+    if found_spec is None:\n+        return False\n+\n+    return found_spec.origin is None\ndiff --git a/astroid/manager.py b/astroid/manager.py\nindex 23330d5b95..6e7dcf4cdf 100644\n--- a/astroid/manager.py\n+++ b/astroid/manager.py\n@@ -17,7 +17,7 @@\n \n from astroid.const import BRAIN_MODULES_DIRECTORY\n from astroid.exceptions import AstroidBuildingError, AstroidImportError\n-from astroid.interpreter._import import spec\n+from astroid.interpreter._import import spec, util\n from astroid.modutils import (\n     NoSourceFile,\n     _cache_normalize_path_,\n@@ -382,6 +382,7 @@ def clear_cache(self) -> None:\n         for lru_cache in (\n             LookupMixIn.lookup,\n             _cache_normalize_path_,\n+            util.is_namespace,\n             ObjectModel.attributes,\n         ):\n             lru_cache.cache_clear()\ndiff --git a/setup.cfg b/setup.cfg\nindex fa7c436e00..1e2341a882 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -39,7 +39,6 @@ packages = find:\n install_requires =\n     lazy_object_proxy>=1.4.0\n     wrapt>=1.11,<2\n-    setuptools>=20.0\n     typed-ast>=1.4.0,<2.0;implementation_name==\"cpython\" and python_version<\"3.8\"\n     typing-extensions>=3.10;python_version<\"3.10\"\n python_requires = >=3.7.2\n",
  "problem_statement": "Remove dependency to ``setuptools`` and ``distutil``\nAs see in #1030  and #1100 there is a hidden dependency to setuptools (and probably distutils too), we made it explicit in #1100 but the better thing to do would be to remove it entirely if possible.\r\n\nDecrease the time required to import astroid\n### Steps to reproduce\r\n\r\n``python3 -X importtime -c 'import astroid'``\r\n\r\n### Current behavior\r\n\r\nIt takes a half second to import astroid. This account for 92% of pylint's startup time in 2.13.0-dev0. See https://github.com/PyCQA/pylint/issues/4814 for details.\r\n\r\n```\r\nimport time: self [us] | cumulative | imported package\r\nimport time:       182 |        182 |   _io\r\nimport time:        59 |         59 |   marshal\r\nimport time:       213 |        213 |   posix\r\nimport time:       463 |        916 | _frozen_importlib_external\r\nimport time:       143 |        143 |   time\r\nimport time:       210 |        353 | zipimport\r\nimport time:        68 |         68 |     _codecs\r\nimport time:      8157 |       8225 |   codecs\r\nimport time:      4532 |       4532 |   encodings.aliases\r\nimport time:      2092 |      14848 | encodings\r\nimport time:       526 |        526 | encodings.utf_8\r\nimport time:       183 |        183 | _signal\r\nimport time:       910 |        910 | encodings.latin_1\r\nimport time:        34 |         34 |     _abc\r\nimport time:       527 |        560 |   abc\r\nimport time:       539 |       1099 | io\r\nimport time:        43 |         43 |       _stat\r\nimport time:       522 |        564 |     stat\r\nimport time:      1066 |       1066 |     _collections_abc\r\nimport time:       459 |        459 |       genericpath\r\nimport time:       481 |        939 |     posixpath\r\nimport time:       781 |       3349 |   os\r\nimport time:       451 |        451 |   _sitebuiltins\r\nimport time:        57 |         57 |     _locale\r\nimport time:       411 |        467 |   _bootlocale\r\nimport time:      1220 |       1220 |     apport_python_hook\r\nimport time:       396 |       1615 |   sitecustomize\r\nimport time:      4927 |      10808 | site\r\nimport time:       989 |        989 |     types\r\nimport time:       833 |        833 |     warnings\r\nimport time:      1833 |       3654 |   importlib\r\nimport time:       954 |        954 |         enum\r\nimport time:        58 |         58 |           _sre\r\nimport time:       560 |        560 |             sre_constants\r\nimport time:      1033 |       1593 |           sre_parse\r\nimport time:       788 |       2437 |         sre_compile\r\nimport time:        58 |         58 |               _operator\r\nimport time:      1129 |       1187 |             operator\r\nimport time:       424 |        424 |             keyword\r\nimport time:        34 |         34 |               _heapq\r\nimport time:       499 |        533 |             heapq\r\nimport time:        85 |         85 |             itertools\r\nimport time:       496 |        496 |             reprlib\r\nimport time:        47 |         47 |             _collections\r\nimport time:      1360 |       4129 |           collections\r\nimport time:        37 |         37 |           _functools\r\nimport time:      3949 |       8114 |         functools\r\nimport time:       451 |        451 |         copyreg\r\nimport time:       751 |      12704 |       re\r\nimport time:       547 |      13251 |     fnmatch\r\nimport time:        70 |         70 |       nt\r\nimport time:        49 |         49 |       nt\r\nimport time:        46 |         46 |       nt\r\nimport time:        46 |         46 |       nt\r\nimport time:       608 |        817 |     ntpath\r\nimport time:        47 |         47 |     errno\r\nimport time:       734 |        734 |       urllib\r\nimport time:      1519 |       2253 |     urllib.parse\r\nimport time:      3700 |      20066 |   pathlib\r\nimport time:      1277 |       1277 |   astroid.__pkginfo__\r\nimport time:       423 |        423 |         collections.abc\r\nimport time:       704 |        704 |         contextlib\r\nimport time:      1683 |       2809 |       typing\r\nimport time:       127 |        127 |               _opcode\r\nimport time:       619 |        745 |             opcode\r\nimport time:       744 |       1488 |           dis\r\nimport time:       442 |        442 |           importlib.machinery\r\nimport time:       480 |        480 |               token\r\nimport time:      1048 |       1527 |             tokenize\r\nimport time:       389 |       1915 |           linecache\r\nimport time:      1941 |       5784 |         inspect\r\nimport time:       518 |        518 |               _weakrefset\r\nimport time:       873 |       1390 |             weakref\r\nimport time:      1384 |       1384 |             wrapt._wrappers\r\nimport time:      6921 |       9695 |           wrapt.wrappers\r\nimport time:      1350 |       1350 |             threading\r\nimport time:      1461 |       2811 |           wrapt.decorators\r\nimport time:      1089 |       1089 |           wrapt.importer\r\nimport time:      2134 |      15727 |         wrapt\r\nimport time:        77 |         77 |             copy_reg\r\nimport time:       449 |        449 |               lazy_object_proxy.utils_py3\r\nimport time:       550 |        999 |             lazy_object_proxy.utils\r\nimport time:      1466 |       1466 |             lazy_object_proxy.cext\r\nimport time:       572 |        572 |             lazy_object_proxy._version\r\nimport time:      4391 |       7503 |           lazy_object_proxy\r\nimport time:       687 |       8190 |         astroid.util\r\nimport time:       635 |        635 |           pprint\r\nimport time:      2008 |       2643 |         astroid.context\r\nimport time:      1714 |       1714 |         astroid.exceptions\r\nimport time:      7641 |       7641 |         typing_extensions\r\nimport time:       616 |      42312 |       astroid.decorators\r\nimport time:       594 |        594 |       astroid.mixins\r\nimport time:      1371 |       1371 |         astroid.const\r\nimport time:      1881 |       1881 |           astroid.interpreter._import\r\nimport time:      1275 |       1275 |             distutils\r\nimport time:       385 |        385 |                 __future__\r\nimport time:        68 |         68 |                   binascii\r\nimport time:       631 |        631 |                     importlib.abc\r\nimport time:       503 |       1133 |                   importlib.util\r\nimport time:        66 |         66 |                     zlib\r\nimport time:       367 |        367 |                       _compression\r\nimport time:       251 |        251 |                       _bz2\r\nimport time:       485 |       1103 |                     bz2\r\nimport time:       217 |        217 |                       _lzma\r\nimport time:       431 |        647 |                     lzma\r\nimport time:        36 |         36 |                     pwd\r\nimport time:        26 |         26 |                     grp\r\nimport time:      1033 |       2908 |                   shutil\r\nimport time:        66 |         66 |                     _struct\r\nimport time:       337 |        402 |                   struct\r\nimport time:      1019 |       5528 |                 zipfile\r\nimport time:       599 |        599 |                 pkgutil\r\nimport time:      1913 |       1913 |                 platform\r\nimport time:        53 |         53 |                     math\r\nimport time:       120 |        120 |                     _datetime\r\nimport time:      1114 |       1286 |                   datetime\r\nimport time:      1129 |       1129 |                       xml\r\nimport time:      1078 |       2206 |                     xml.parsers\r\nimport time:       107 |        107 |                     pyexpat\r\nimport time:       431 |       2744 |                   xml.parsers.expat\r\nimport time:      1234 |       5263 |                 plistlib\r\nimport time:       578 |        578 |                   email\r\nimport time:       674 |        674 |                     email.errors\r\nimport time:        36 |         36 |                             _string\r\nimport time:       843 |        878 |                           string\r\nimport time:       465 |       1343 |                         email.quoprimime\r\nimport time:       524 |        524 |                           base64\r\nimport time:       402 |        925 |                         email.base64mime\r\nimport time:       451 |        451 |                             quopri\r\nimport time:       418 |        869 |                           email.encoders\r\nimport time:       874 |       1743 |                         email.charset\r\nimport time:       950 |       4960 |                       email.header\r\nimport time:        34 |         34 |                             _bisect\r\nimport time:       424 |        457 |                           bisect\r\nimport time:        27 |         27 |                           _sha512\r\nimport time:        22 |         22 |                           _random\r\nimport time:       616 |       1122 |                         random\r\nimport time:       136 |        136 |                           _socket\r\nimport time:       617 |        617 |                             select\r\nimport time:       885 |       1501 |                           selectors\r\nimport time:      1593 |       3229 |                         socket\r\nimport time:      1011 |       1011 |                             locale\r\nimport time:       919 |       1929 |                           calendar\r\nimport time:       557 |       2485 |                         email._parseaddr\r\nimport time:       813 |       7647 |                       email.utils\r\nimport time:       561 |      13167 |                     email._policybase\r\nimport time:       945 |      14785 |                   email.feedparser\r\nimport time:      8210 |      23572 |                 email.parser\r\nimport time:       721 |        721 |                 tempfile\r\nimport time:      1194 |       1194 |                 textwrap\r\nimport time:      6297 |       6297 |                 pkg_resources.extern\r\nimport time:      1130 |       1130 |                     pkg_resources._vendor\r\nimport time:      1168 |       2297 |                   pkg_resources._vendor.six\r\nimport time:       149 |       2446 |                 pkg_resources.extern.six\r\nimport time:       560 |        560 |                     pkg_resources._vendor.six\r\nimport time:        70 |        629 |                   pkg_resources._vendor.six.moves\r\nimport time:        56 |        685 |                 pkg_resources.extern.six.moves\r\nimport time:        20 |         20 |                   pkg_resources._vendor.six.moves\r\nimport time:        50 |         69 |                 pkg_resources._vendor.six.moves.urllib\r\nimport time:       461 |        461 |                 pkg_resources.py31compat\r\nimport time:       910 |        910 |                   pkg_resources._vendor.appdirs\r\nimport time:        81 |        990 |                 pkg_resources.extern.appdirs\r\nimport time:       436 |        436 |                     pkg_resources._vendor.packaging.__about__\r\nimport time:      3589 |       4025 |                   pkg_resources._vendor.packaging\r\nimport time:        72 |       4097 |                 pkg_resources.extern.packaging\r\nimport time:       378 |        378 |                   pkg_resources.extern.packaging._structures\r\nimport time:      2111 |       2489 |                 pkg_resources.extern.packaging.version\r\nimport time:       379 |        379 |                   pkg_resources.extern.packaging._compat\r\nimport time:      6610 |       6989 |                 pkg_resources.extern.packaging.specifiers\r\nimport time:        74 |         74 |                             org\r\nimport time:        17 |         90 |                           org.python\r\nimport time:        13 |        103 |                         org.python.core\r\nimport time:       539 |        641 |                       copy\r\nimport time:      1431 |       1431 |                       traceback\r\nimport time:     27210 |      29281 |                     pkg_resources._vendor.pyparsing\r\nimport time:       107 |      29388 |                   pkg_resources.extern.pyparsing\r\nimport time:        42 |         42 |                   pkg_resources.extern.six.moves.urllib\r\nimport time:      1463 |       1463 |                   pkg_resources.extern.packaging.markers\r\nimport time:      8461 |      39353 |                 pkg_resources.extern.packaging.requirements\r\nimport time:      4606 |       4606 |                 sysconfig\r\nimport time:     52302 |     159948 |               pkg_resources\r\nimport time:       338 |     160286 |             astroid.interpreter._import.util\r\nimport time:      1009 |     162569 |           astroid.interpreter._import.spec\r\nimport time:       614 |        614 |             distutils.errors\r\nimport time:       426 |        426 |                 distutils.dep_util\r\nimport time:       355 |        355 |                   distutils.debug\r\nimport time:       504 |        504 |                   distutils.log\r\nimport time:       548 |       1406 |                 distutils.spawn\r\nimport time:       559 |       2391 |               distutils.util\r\nimport time:       889 |       3280 |             distutils.sysconfig\r\nimport time:       854 |       4746 |           astroid.modutils\r\nimport time:       463 |        463 |           astroid.transforms\r\nimport time:      3030 |     172688 |         astroid.manager\r\nimport time:      4830 |     178888 |       astroid.bases\r\nimport time:      8974 |       8974 |       astroid.nodes.const\r\nimport time:       737 |        737 |         astroid.nodes.as_string\r\nimport time:      1306 |       2042 |       astroid.nodes.node_ng\r\nimport time:      5136 |     240752 |     astroid.nodes.node_classes\r\nimport time:       467 |        467 |       astroid.interpreter.dunder_lookup\r\nimport time:      1416 |       1883 |     astroid.nodes.scoped_nodes\r\nimport time:      4791 |     247424 |   astroid.nodes\r\nimport time:        57 |         57 |       _ast\r\nimport time:       764 |        820 |     ast\r\nimport time:    177912 |     177912 |       astroid.raw_building\r\nimport time:       656 |     178567 |     astroid.helpers\r\nimport time:       569 |        569 |       astroid.arguments\r\nimport time:       972 |       1541 |     astroid.protocols\r\nimport time:      1415 |     182342 |   astroid.inference\r\nimport time:      1575 |       1575 |   astroid.astroid_manager\r\nimport time:      1293 |       1293 |     astroid.brain\r\nimport time:       712 |       2005 |   astroid.brain.helpers\r\nimport time:        76 |         76 |           typed_ast\r\nimport time:        53 |        128 |         typed_ast.ast3\r\nimport time:       655 |        783 |       astroid._ast\r\nimport time:      1616 |       2399 |     astroid.rebuilder\r\nimport time:       561 |       2959 |   astroid.builder\r\nimport time:       355 |        355 |   astroid.inference_tip\r\nimport time:       701 |        701 |   astroid.objects\r\nimport time:       305 |        305 |   astroid.brain.brain_numpy_utils\r\nimport time:     46840 |     509498 | astroid\r\n```\r\n\r\n### Expected behavior\r\n\r\nFaster import, so pylint's can analyses empty file in less than half a second.\r\n\n",
  "pull_number": 1536,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_manager.py b/tests/unittest_manager.py\nindex cd63950ea2..6c105a12bb 100644\n--- a/tests/unittest_manager.py\n+++ b/tests/unittest_manager.py\n@@ -10,12 +10,11 @@\n from collections.abc import Iterator\n from contextlib import contextmanager\n \n-import pkg_resources\n-\n import astroid\n from astroid import manager, test_utils\n from astroid.const import IS_JYTHON\n from astroid.exceptions import AstroidBuildingError, AstroidImportError\n+from astroid.interpreter._import import util\n from astroid.modutils import is_standard_module\n from astroid.nodes import Const\n from astroid.nodes.scoped_nodes import ClassDef\n@@ -111,6 +110,16 @@ def test_ast_from_namespace_pkgutil(self) -> None:\n     def test_ast_from_namespace_pkg_resources(self) -> None:\n         self._test_ast_from_old_namespace_package_protocol(\"pkg_resources\")\n \n+    def test_identify_old_namespace_package_protocol(self) -> None:\n+        # Like the above cases, this package follows the old namespace package protocol\n+        # astroid currently assumes such packages are in sys.modules, so import it\n+        # pylint: disable-next=import-outside-toplevel\n+        import tests.testdata.python3.data.path_pkg_resources_1.package.foo as _  # noqa\n+\n+        self.assertTrue(\n+            util.is_namespace(\"tests.testdata.python3.data.path_pkg_resources_1\")\n+        )\n+\n     def test_implicit_namespace_package(self) -> None:\n         data_dir = os.path.dirname(resources.find(\"data/namespace_pep_420\"))\n         contribute = os.path.join(data_dir, \"contribute_to_namespace\")\n@@ -131,7 +140,6 @@ def test_implicit_namespace_package(self) -> None:\n     def test_namespace_package_pth_support(self) -> None:\n         pth = \"foogle_fax-0.12.5-py2.7-nspkg.pth\"\n         site.addpackage(resources.RESOURCE_PATH, pth, [])\n-        pkg_resources._namespace_packages[\"foogle\"] = []\n \n         try:\n             module = self.manager.ast_from_module_name(\"foogle.fax\")\n@@ -141,18 +149,14 @@ def test_namespace_package_pth_support(self) -> None:\n             with self.assertRaises(AstroidImportError):\n                 self.manager.ast_from_module_name(\"foogle.moogle\")\n         finally:\n-            del pkg_resources._namespace_packages[\"foogle\"]\n             sys.modules.pop(\"foogle\")\n \n     def test_nested_namespace_import(self) -> None:\n         pth = \"foogle_fax-0.12.5-py2.7-nspkg.pth\"\n         site.addpackage(resources.RESOURCE_PATH, pth, [])\n-        pkg_resources._namespace_packages[\"foogle\"] = [\"foogle.crank\"]\n-        pkg_resources._namespace_packages[\"foogle.crank\"] = []\n         try:\n             self.manager.ast_from_module_name(\"foogle.crank\")\n         finally:\n-            del pkg_resources._namespace_packages[\"foogle\"]\n             sys.modules.pop(\"foogle\")\n \n     def test_namespace_and_file_mismatch(self) -> None:\n@@ -161,12 +165,10 @@ def test_namespace_and_file_mismatch(self) -> None:\n         self.assertEqual(ast.name, \"unittest\")\n         pth = \"foogle_fax-0.12.5-py2.7-nspkg.pth\"\n         site.addpackage(resources.RESOURCE_PATH, pth, [])\n-        pkg_resources._namespace_packages[\"foogle\"] = []\n         try:\n             with self.assertRaises(AstroidImportError):\n                 self.manager.ast_from_module_name(\"unittest.foogle.fax\")\n         finally:\n-            del pkg_resources._namespace_packages[\"foogle\"]\n             sys.modules.pop(\"foogle\")\n \n     def _test_ast_from_zip(self, archive: str) -> None:\n@@ -323,6 +325,7 @@ def test_clear_cache_clears_other_lru_caches(self) -> None:\n         lrus = (\n             astroid.nodes.node_classes.LookupMixIn.lookup,\n             astroid.modutils._cache_normalize_path_,\n+            util.is_namespace,\n             astroid.interpreter.objectmodel.ObjectModel.attributes,\n         )\n \n@@ -332,6 +335,7 @@ def test_clear_cache_clears_other_lru_caches(self) -> None:\n         # Generate some hits and misses\n         ClassDef().lookup(\"garbage\")\n         is_standard_module(\"unittest\", std_path=[\"garbage_path\"])\n+        util.is_namespace(\"unittest\")\n         astroid.interpreter.objectmodel.ObjectModel().attributes()\n \n         # Did the hits or misses actually happen?\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/fb31eede489b45498e65b1921b537f7bd2dd8c9b"
}