{
  "all_hints_text": "Thanks! Going to add `KeyError` to the caught exceptions.\nBtw, this does sound like we could base a `pylint` checker on this? If `str.format()` returns `Uninferable` it's likely that something is wrong?\nI don't think so, because this example from the pylint primer is fine, right? It's unpacking something dynamic, but I assume there's a justification for depending on team_slug being in there.\n\n",
  "base_commit": "aa5a0d92e640ee5f3fa9a8ba3ba058a7b594ca44",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/3876869109a10198d39317d931b48deddd7dc497"
  ],
  "created_at": "2022-06-11T10:33:20Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-1614",
  "issue_numbers": [
    1613
  ],
  "language": "python",
  "patch": "diff --git a/astroid/brain/brain_builtin_inference.py b/astroid/brain/brain_builtin_inference.py\nindex 68445e731c..00253f243b 100644\n--- a/astroid/brain/brain_builtin_inference.py\n+++ b/astroid/brain/brain_builtin_inference.py\n@@ -946,7 +946,7 @@ def _infer_str_format_call(\n \n     try:\n         formatted_string = format_template.format(*pos_values, **keyword_values)\n-    except IndexError:\n+    except (IndexError, KeyError):\n         # If there is an IndexError there are too few arguments to interpolate\n         return iter([util.Uninferable])\n \n",
  "problem_statement": "Crash when inferring `str.format` call involving unpacking kwargs\nWhen parsing the following file:\r\n\r\n<!--\r\n If sharing the code is not an option, please state so,\r\n but providing only the stacktrace would still be helpful.\r\n -->\r\n\r\n```python\r\nclass A:\r\n    def render(self, audit_log_entry: AuditLogEntry):\r\n        return \"joined team {team_slug}\".format(**audit_log_entry.data)\r\n\r\n\r\n\r\n```\r\n\r\npylint crashed with a ``AstroidError`` and with the following stacktrace:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/.../astroid/astroid/inference_tip.py\", line 38, in _inference_tip_cached\r\n    result = _cache[func, node]\r\nKeyError: (<function _infer_str_format_call at 0x1064a96c0>, <Call l.3 at 0x106c452d0>)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/.../pylint/pylint/lint/pylinter.py\", line 731, in _check_file\r\n    check_astroid_module(ast_node)\r\n  File \"/Users/.../pylint/pylint/lint/pylinter.py\", line 950, in check_astroid_module\r\n    retval = self._check_astroid_module(\r\n  File \"/Users/.../pylint/pylint/lint/pylinter.py\", line 1000, in _check_astroid_module\r\n    walker.walk(node)\r\n  File \"/Users/.../pylint/pylint/utils/ast_walker.py\", line 93, in walk\r\n    self.walk(child)\r\n  File \"/Users/.../pylint/pylint/utils/ast_walker.py\", line 93, in walk\r\n    self.walk(child)\r\n  File \"/Users/.../pylint/pylint/utils/ast_walker.py\", line 90, in walk\r\n    callback(astroid)\r\n  File \"/Users/.../pylint/pylint/checkers/classes/special_methods_checker.py\", line 170, in visit_functiondef\r\n    inferred = _safe_infer_call_result(node, node)\r\n  File \"/Users/.../pylint/pylint/checkers/classes/special_methods_checker.py\", line 31, in _safe_infer_call_result\r\n    value = next(inferit)\r\n  File \"/Users/.../astroid/astroid/nodes/scoped_nodes/scoped_nodes.py\", line 1752, in infer_call_result\r\n    yield from returnnode.value.infer(context)\r\n  File \"/Users/.../astroid/astroid/nodes/node_ng.py\", line 159, in infer\r\n    results = list(self._explicit_inference(self, context, **kwargs))\r\n  File \"/Users/.../astroid/astroid/inference_tip.py\", line 45, in _inference_tip_cached\r\n    result = _cache[func, node] = list(func(*args, **kwargs))\r\n  File \"/Users/.../astroid/astroid/brain/brain_builtin_inference.py\", line 948, in _infer_str_format_call\r\n    formatted_string = format_template.format(*pos_values, **keyword_values)\r\nKeyError: 'team_slug'\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/.../pylint/pylint/lint/pylinter.py\", line 688, in _check_files\r\n    self._check_file(get_ast, check_astroid_module, file)\r\n  File \"/Users/.../pylint/pylint/lint/pylinter.py\", line 733, in _check_file\r\n    raise astroid.AstroidError from e\r\nastroid.exceptions.AstroidError\r\n```\r\n***\r\ncc @DanielNoord in #1602 \r\nfound by pylint primer \ud83d\ude80 \n",
  "pull_number": 1614,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_brain_builtin.py b/tests/unittest_brain_builtin.py\nindex a659c4fdf2..54e7d2190d 100644\n--- a/tests/unittest_brain_builtin.py\n+++ b/tests/unittest_brain_builtin.py\n@@ -93,6 +93,9 @@ def test_string_format(self, format_string: str) -> None:\n             \"My name is {}, I'm {}\".format(Unknown, 12)\n             \"\"\",\n             \"\"\"\"I am {}\".format()\"\"\",\n+            \"\"\"\n+            \"My name is {fname}, I'm {age}\".format(fsname = \"Daniel\", age = 12)\n+            \"\"\",\n         ],\n     )\n     def test_string_format_uninferable(self, format_string: str) -> None:\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/aa5a0d92e640ee5f3fa9a8ba3ba058a7b594ca44"
}