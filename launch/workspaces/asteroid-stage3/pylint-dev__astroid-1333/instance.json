{
  "all_hints_text": "I can't seem to reproduce this in my `virtualenv`. This might be specific to `venv`? Needs some further investigation.\n@interifter Which version of `pylint` are you using?\nRight, ``pip install pylint astroid==2.9.0``, will keep the local version if you already have one, so I thought it was ``2.12.2`` but that could be false. In fact it probably isn't 2.12.2. For the record, you're not supposed to set the version of ``astroid`` yourself, pylint does, and bad thing will happen if you try to set the version of an incompatible astroid. We might want to update the issue's template to have this information next.\nMy apologies... I updated the repro steps with a critical missed detail: `pylint src/project`, instead of `pylint src`\r\n\r\nBut I verified that either with, or without, `venv`, the issue is reproduced.\r\n\r\nAlso, I never have specified the `astroid` version, before. \r\n\r\nHowever, this isn't the first time the issue has been observed.\r\nBack in early 2019, a [similar issue](https://stackoverflow.com/questions/48024049/pylint-raises-error-if-directory-doesnt-contain-init-py-file) was observed with either `astroid 2.2.0` or `isort 4.3.5`, which led me to try pinning `astroid==2.9.0`, which worked.\n> @interifter Which version of `pylint` are you using?\r\n\r\n`2.12.2`\r\n\r\nFull env info:\r\n\r\n```\r\nPackage           Version\r\n----------------- -------\r\nastroid           2.9.2\r\ncolorama          0.4.4\r\nisort             5.10.1\r\nlazy-object-proxy 1.7.1\r\nmccabe            0.6.1\r\npip               20.2.3\r\nplatformdirs      2.4.1\r\npylint            2.12.2\r\nsetuptools        49.2.1\r\ntoml              0.10.2\r\ntyping-extensions 4.0.1\r\nwrapt             1.13.3\r\n```\r\n\nI confirm the bug and i'm able to reproduce it with `python 3.9.1`. \r\n```\r\n$> pip freeze\r\nastroid==2.9.2\r\nisort==5.10.1\r\nlazy-object-proxy==1.7.1\r\nmccabe==0.6.1\r\nplatformdirs==2.4.1\r\npylint==2.12.2\r\ntoml==0.10.2\r\ntyping-extensions==4.0.1\r\nwrapt==1.13.3\r\n```\nBisected and this is the faulty commit:\r\nhttps://github.com/PyCQA/astroid/commit/2ee20ccdf62450db611acc4a1a7e42f407ce8a14\nFix in #1333, no time to write tests yet so if somebody has any good ideas: please let me know!\n@interifter Fixed and released with `2.9.3`. Thanks for the report and reproducible example. Not sure why I couldn't reproduce this to begin with.\n@DanielNoord I had the incorrect steps to reproduce when I initially filed the bug, so that likely would prevent you, or anyone else, from being able to :)\n\n",
  "base_commit": "d2a5b3c7b1e203fec3c7ca73c30eb1785d3d4d0a",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/3661e1264643a27293e31cd6760ade8dc7b6d920",
    "https://github.com/pylint-dev/astroid/commit/b19b115d4549569700c395500653ff83cc894f88"
  ],
  "created_at": "2022-01-08T19:36:45Z",
  "hints_text": "I can't seem to reproduce this in my `virtualenv`. This might be specific to `venv`? Needs some further investigation.\n@interifter Which version of `pylint` are you using?\nRight, ``pip install pylint astroid==2.9.0``, will keep the local version if you already have one, so I thought it was ``2.12.2`` but that could be false. In fact it probably isn't 2.12.2. For the record, you're not supposed to set the version of ``astroid`` yourself, pylint does, and bad thing will happen if you try to set the version of an incompatible astroid. We might want to update the issue's template to have this information next.\nMy apologies... I updated the repro steps with a critical missed detail: `pylint src/project`, instead of `pylint src`\r\n\r\nBut I verified that either with, or without, `venv`, the issue is reproduced.\r\n\r\nAlso, I never have specified the `astroid` version, before. \r\n\r\nHowever, this isn't the first time the issue has been observed.\r\nBack in early 2019, a [similar issue](https://stackoverflow.com/questions/48024049/pylint-raises-error-if-directory-doesnt-contain-init-py-file) was observed with either `astroid 2.2.0` or `isort 4.3.5`, which led me to try pinning `astroid==2.9.0`, which worked.\n> @interifter Which version of `pylint` are you using?\r\n\r\n`2.12.2`\r\n\r\nFull env info:\r\n\r\n```\r\nPackage           Version\r\n----------------- -------\r\nastroid           2.9.2\r\ncolorama          0.4.4\r\nisort             5.10.1\r\nlazy-object-proxy 1.7.1\r\nmccabe            0.6.1\r\npip               20.2.3\r\nplatformdirs      2.4.1\r\npylint            2.12.2\r\nsetuptools        49.2.1\r\ntoml              0.10.2\r\ntyping-extensions 4.0.1\r\nwrapt             1.13.3\r\n```\r\n\n\n",
  "instance_id": "pylint-dev__astroid-1333",
  "issue_numbers": [
    1327
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 6c56d234f9..783391c360 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -7,6 +7,14 @@ What's New in astroid 2.10.0?\n Release date: TBA\n \n \n+What's New in astroid 2.9.3?\n+============================\n+Release date: TBA\n+\n+* Fixed regression where packages without a ``__init__.py`` file were\n+  not recognized or imported correctly.\n+\n+  Closes #1327\n \n What's New in astroid 2.9.2?\n ============================\ndiff --git a/astroid/modutils.py b/astroid/modutils.py\nindex 6d69846925..b20a184021 100644\n--- a/astroid/modutils.py\n+++ b/astroid/modutils.py\n@@ -297,6 +297,9 @@ def _get_relative_base_path(filename, path_to_check):\n     if os.path.normcase(real_filename).startswith(path_to_check):\n         importable_path = real_filename\n \n+    # if \"var\" in path_to_check:\n+    #     breakpoint()\n+\n     if importable_path:\n         base_path = os.path.splitext(importable_path)[0]\n         relative_base_path = base_path[len(path_to_check) :]\n@@ -307,8 +310,11 @@ def _get_relative_base_path(filename, path_to_check):\n \n def modpath_from_file_with_callback(filename, path=None, is_package_cb=None):\n     filename = os.path.expanduser(_path_from_filename(filename))\n+    paths_to_check = sys.path.copy()\n+    if path:\n+        paths_to_check += path\n     for pathname in itertools.chain(\n-        path or [], map(_cache_normalize_path, sys.path), sys.path\n+        paths_to_check, map(_cache_normalize_path, paths_to_check)\n     ):\n         if not pathname:\n             continue\n",
  "problem_statement": "astroid 2.9.1 breaks pylint with missing __init__.py: F0010: error while code parsing: Unable to load file __init__.py\n### Steps to reproduce\r\n> Steps provided are for Windows 11, but initial problem found in Ubuntu 20.04\r\n\r\n> Update 2022-01-04: Corrected repro steps and added more environment details\r\n\r\n1. Set up simple repo with following structure (all files can be empty):\r\n```\r\nroot_dir/\r\n|--src/\r\n|----project/ # Notice the missing __init__.py\r\n|------file.py # It can be empty, but I added `import os` at the top\r\n|----__init__.py\r\n```\r\n2. Open a command prompt\r\n3. `cd root_dir`\r\n4. `python -m venv venv`\r\n5. `venv/Scripts/activate`\r\n6. `pip install pylint astroid==2.9.1` # I also repro'd on the latest, 2.9.2\r\n7. `pylint src/project` # Updated from `pylint src`\r\n8. Observe failure:\r\n```\r\nsrc\\project\\__init__.py:1:0: F0010: error while code parsing: Unable to load file src\\project\\__init__.py:\r\n```\r\n\r\n### Current behavior\r\nFails with `src\\project\\__init__.py:1:0: F0010: error while code parsing: Unable to load file src\\project\\__init__.py:`\r\n\r\n### Expected behavior\r\nDoes not fail with error.\r\n> If you replace step 6 with `pip install pylint astroid==2.9.0`, you get no failure with an empty output - since no files have content\r\n\r\n### `python -c \"from astroid import __pkginfo__; print(__pkginfo__.version)\"` output\r\n2.9.1\r\n\r\n`python 3.9.1`\r\n`pylint 2.12.2 `\r\n\r\n\r\n\r\nThis issue has been observed with astroid `2.9.1` and `2.9.2`\n",
  "pull_number": 1333,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_modutils.py b/tests/unittest_modutils.py\nindex d6fcb68e25..01d5e5b91e 100644\n--- a/tests/unittest_modutils.py\n+++ b/tests/unittest_modutils.py\n@@ -30,6 +30,7 @@\n import tempfile\n import unittest\n import xml\n+from pathlib import Path\n from xml import etree\n from xml.etree import ElementTree\n \n@@ -189,6 +190,30 @@ def test_load_from_module_symlink_on_symlinked_paths_in_syspath(self) -> None:\n         # this should be equivalent to: import secret\n         self.assertEqual(modutils.modpath_from_file(symlink_secret_path), [\"secret\"])\n \n+    def test_load_packages_without_init(self) -> None:\n+        \"\"\"Test that we correctly find packages with an __init__.py file.\n+\n+        Regression test for issue reported in:\n+        https://github.com/PyCQA/astroid/issues/1327\n+        \"\"\"\n+        tmp_dir = Path(tempfile.gettempdir())\n+        self.addCleanup(os.chdir, os.curdir)\n+        os.chdir(tmp_dir)\n+\n+        self.addCleanup(shutil.rmtree, tmp_dir / \"src\")\n+        os.mkdir(tmp_dir / \"src\")\n+        os.mkdir(tmp_dir / \"src\" / \"package\")\n+        with open(tmp_dir / \"src\" / \"__init__.py\", \"w\", encoding=\"utf-8\"):\n+            pass\n+        with open(tmp_dir / \"src\" / \"package\" / \"file.py\", \"w\", encoding=\"utf-8\"):\n+            pass\n+\n+        # this should be equivalent to: import secret\n+        self.assertEqual(\n+            modutils.modpath_from_file(str(Path(\"src\") / \"package\"), [\".\"]),\n+            [\"src\", \"package\"],\n+        )\n+\n \n class LoadModuleFromPathTest(resources.SysPathSetup, unittest.TestCase):\n     def test_do_not_load_twice(self) -> None:\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/d2a5b3c7b1e203fec3c7ca73c30eb1785d3d4d0a"
}