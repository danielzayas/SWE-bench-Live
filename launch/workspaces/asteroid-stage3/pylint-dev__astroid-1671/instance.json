{
  "all_hints_text": "I think we need to find a compromise here, inferring pathlib correctly is important, but not \"25% slower does not matter\" kind of important. I don't have a clear understanding of where we can \"cut corner\" or make the inference faster though.\nSomething like this:\r\n\r\n```diff\r\ndiff --git a/astroid/brain/brain_pathlib.py b/astroid/brain/brain_pathlib.py\r\nindex 8ff3310b..c79f5b84 100644\r\n--- a/astroid/brain/brain_pathlib.py\r\n+++ b/astroid/brain/brain_pathlib.py\r\n@@ -8,6 +8,7 @@ from collections.abc import Iterator\r\n \r\n from astroid import bases, context, inference_tip, nodes\r\n from astroid.builder import _extract_single_node\r\n+from astroid.const import PY310_PLUS\r\n from astroid.exceptions import InferenceError, UseInferenceDefault\r\n from astroid.manager import AstroidManager\r\n \r\n@@ -18,6 +19,8 @@ Path\r\n \r\n \r\n def _looks_like_parents_subscript(node: nodes.Subscript) -> bool:\r\n+    if not PY310_PLUS:\r\n+        return False\r\n     if not (\r\n         isinstance(node.value, nodes.Name)\r\n         or isinstance(node.value, nodes.Attribute)\r\ndiff --git a/tests/unittest_brain_pathlib.py b/tests/unittest_brain_pathlib.py\r\nindex 4c9eb1b3..55c0c6a8 100644\r\n--- a/tests/unittest_brain_pathlib.py\r\n+++ b/tests/unittest_brain_pathlib.py\r\n@@ -2,6 +2,7 @@\r\n # For details: https://github.com/PyCQA/astroid/blob/main/LICENSE\r\n # Copyright (c) https://github.com/PyCQA/astroid/blob/main/CONTRIBUTORS.txt\r\n \r\n+import pytest\r\n \r\n import astroid\r\n from astroid import bases\r\n@@ -26,6 +27,7 @@ def test_inference_parents() -> None:\r\n     assert inferred[0].qname() == \"pathlib._PathParents\"\r\n \r\n \r\n+@pytest.mark.skipif(not PY310_PLUS, reason=\"Brain only acts on Py310+\")\r\n def test_inference_parents_subscript_index() -> None:\r\n     \"\"\"Test inference of ``pathlib.Path.parents``, accessed by index.\"\"\"\r\n     parents, path = astroid.extract_node(\r\n```\nReading your earlier comment I had the impression that this would speed up old interpreters but that python 3.10 would still be 25% slower ?\nThe issue is probably that we don't have any brains that use `Subscripts` with inference.\n\n",
  "base_commit": "91533b7b8a5f7951c2b590add0a73ad3bc113a07",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/3b3234efa25891e09247048b57a433af1ad764c9",
    "https://github.com/pylint-dev/astroid/commit/39224dda48292f2de9bd3ff51daa67442a10db80",
    "https://github.com/pylint-dev/astroid/commit/2be0f116c75379dc14c28b8504d0b7840665b237",
    "https://github.com/pylint-dev/astroid/commit/94b0d7b68d6fd7a6fa1e541c63df0defd345bafb",
    "https://github.com/pylint-dev/astroid/commit/4c82105e681e146e2c4cf37eb8d4fa0ae663aa15",
    "https://github.com/pylint-dev/astroid/commit/53528dd8e0dcd7d86c49de33aa69e6a660b8d761",
    "https://github.com/pylint-dev/astroid/commit/f0fea08f22015491efff2ded2c039a5bf552dfe8",
    "https://github.com/pylint-dev/astroid/commit/73f55bb93fd982d81f73237b6f7ed7a39fbeadc8",
    "https://github.com/pylint-dev/astroid/commit/d3a904792dd7314199cb78182f7338e43bd5604b"
  ],
  "created_at": "2022-06-28T13:14:27Z",
  "hints_text": "I think we need to find a compromise here, inferring pathlib correctly is important, but not \"25% slower does not matter\" kind of important. I don't have a clear understanding of where we can \"cut corner\" or make the inference faster though.\nSomething like this:\r\n\r\n```diff\r\ndiff --git a/astroid/brain/brain_pathlib.py b/astroid/brain/brain_pathlib.py\r\nindex 8ff3310b..c79f5b84 100644\r\n--- a/astroid/brain/brain_pathlib.py\r\n+++ b/astroid/brain/brain_pathlib.py\r\n@@ -8,6 +8,7 @@ from collections.abc import Iterator\r\n \r\n from astroid import bases, context, inference_tip, nodes\r\n from astroid.builder import _extract_single_node\r\n+from astroid.const import PY310_PLUS\r\n from astroid.exceptions import InferenceError, UseInferenceDefault\r\n from astroid.manager import AstroidManager\r\n \r\n@@ -18,6 +19,8 @@ Path\r\n \r\n \r\n def _looks_like_parents_subscript(node: nodes.Subscript) -> bool:\r\n+    if not PY310_PLUS:\r\n+        return False\r\n     if not (\r\n         isinstance(node.value, nodes.Name)\r\n         or isinstance(node.value, nodes.Attribute)\r\ndiff --git a/tests/unittest_brain_pathlib.py b/tests/unittest_brain_pathlib.py\r\nindex 4c9eb1b3..55c0c6a8 100644\r\n--- a/tests/unittest_brain_pathlib.py\r\n+++ b/tests/unittest_brain_pathlib.py\r\n@@ -2,6 +2,7 @@\r\n # For details: https://github.com/PyCQA/astroid/blob/main/LICENSE\r\n # Copyright (c) https://github.com/PyCQA/astroid/blob/main/CONTRIBUTORS.txt\r\n \r\n+import pytest\r\n \r\n import astroid\r\n from astroid import bases\r\n@@ -26,6 +27,7 @@ def test_inference_parents() -> None:\r\n     assert inferred[0].qname() == \"pathlib._PathParents\"\r\n \r\n \r\n+@pytest.mark.skipif(not PY310_PLUS, reason=\"Brain only acts on Py310+\")\r\n def test_inference_parents_subscript_index() -> None:\r\n     \"\"\"Test inference of ``pathlib.Path.parents``, accessed by index.\"\"\"\r\n     parents, path = astroid.extract_node(\r\n```\nReading your earlier comment I had the impression that this would speed up old interpreters but that python 3.10 would still be 25% slower ?\n\n",
  "instance_id": "pylint-dev__astroid-1671",
  "issue_numbers": [
    1667
  ],
  "language": "python",
  "patch": "diff --git a/astroid/brain/brain_pathlib.py b/astroid/brain/brain_pathlib.py\nindex 8ff3310baa..41bbcf0c03 100644\n--- a/astroid/brain/brain_pathlib.py\n+++ b/astroid/brain/brain_pathlib.py\n@@ -19,9 +19,7 @@\n \n def _looks_like_parents_subscript(node: nodes.Subscript) -> bool:\n     if not (\n-        isinstance(node.value, nodes.Name)\n-        or isinstance(node.value, nodes.Attribute)\n-        and node.value.attrname == \"parents\"\n+        isinstance(node.value, nodes.Attribute) and node.value.attrname == \"parents\"\n     ):\n         return False\n \n",
  "problem_statement": "25% performance regression on `main`\n#1442 adds about 10-25% time to a pylint run, depending on how much inference would have taken place otherwise, because it infers every single name.\r\n\r\nOn my machine, with `cProfile`:\r\n`astroid` lints in 46.2s on main\r\n`astroid` lints in 36.6s with reverting #1442\r\n\r\nAre we okay with that? If so, should we short-circuit before inferring in the pathlib brain if the interpreter is below 3.10? (#1442 only has to do with 3.10 behavior.)\n",
  "pull_number": 1671,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_brain_pathlib.py b/tests/unittest_brain_pathlib.py\nindex 4c9eb1b3b2..cc4babea64 100644\n--- a/tests/unittest_brain_pathlib.py\n+++ b/tests/unittest_brain_pathlib.py\n@@ -28,20 +28,14 @@ def test_inference_parents() -> None:\n \n def test_inference_parents_subscript_index() -> None:\n     \"\"\"Test inference of ``pathlib.Path.parents``, accessed by index.\"\"\"\n-    parents, path = astroid.extract_node(\n+    path = astroid.extract_node(\n         \"\"\"\n     from pathlib import Path\n \n     current_path = Path().resolve()\n-    path_parents = current_path.parents\n-    path_parents  #@\n-    path_parents[2]  #@\n+    current_path.parents[2]  #@\n     \"\"\"\n     )\n-    inferred = parents.inferred()\n-    assert len(inferred) == 1\n-    assert isinstance(inferred[0], bases.Instance)\n-    assert inferred[0].qname() == \"pathlib._PathParents\"\n \n     inferred = path.inferred()\n     assert len(inferred) == 1\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/91533b7b8a5f7951c2b590add0a73ad3bc113a07"
}