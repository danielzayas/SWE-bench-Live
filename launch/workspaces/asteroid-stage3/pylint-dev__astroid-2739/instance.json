{
  "all_hints_text": "Thanks for catching this before we even released the error ! \nThe reason for this failure is due to:\n1. `eval.__get__(1)` inferring to `eval` (see #2743)\n2. `eval.__gt__` being an Unknown with no root\n\n",
  "base_commit": "59f36e755d04765b2b623c7c51e84509c6b248f6",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/e5e0731999a14581e7d8c9e841c50121b9329c19",
    "https://github.com/pylint-dev/astroid/commit/881402fe813426bfafa6b17eb852af2c47fe408f"
  ],
  "created_at": "2025-05-13T06:54:59Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-2739",
  "issue_numbers": [
    2672
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex c9744b921..6e73af55b 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -37,6 +37,10 @@ What's New in astroid 3.3.11?\n =============================\n Release date: TBA\n \n+* Fix a crash when the root of a node is not a module but is unknown.\n+\n+  Closes #2672\n+\n * Fix a crash when parsing an empty arbitrary expression with ``extract_node`` (``extract_node(\"__()\")``).\n \n   Closes #2734\ndiff --git a/astroid/nodes/node_ng.py b/astroid/nodes/node_ng.py\nindex dc8942b70..d3be04720 100644\n--- a/astroid/nodes/node_ng.py\n+++ b/astroid/nodes/node_ng.py\n@@ -309,13 +309,13 @@ def scope(self) -> nodes.LocalsDictNodeNG:\n             raise ParentMissingError(target=self)\n         return self.parent.scope()\n \n-    def root(self) -> nodes.Module:\n+    def root(self) -> nodes.Module | nodes.Unknown:\n         \"\"\"Return the root node of the syntax tree.\n \n         :returns: The root node.\n         \"\"\"\n         if not (parent := self.parent):\n-            assert isinstance(self, nodes.Module)\n+            assert isinstance(self, (nodes.Module, nodes.Unknown))\n             return self\n \n         while parent.parent:\n",
  "problem_statement": "AssertionError when root is not a module\n### Description\n\nThe following code triggers an `AssertionError` in astroid:\n\n```python\na=eval.__get__(1).__gt__\n\n@a\nclass c: ...\n```\n\nThis bug was discovered by OSS-Fuzz:\nhttps://issues.oss-fuzz.com/issues/389974978 (report not public yet)\n\n### Backtrace\n```\nTraceback (most recent call last):\n  File \"pylint/pylint/lint/pylinter.py\", line 979, in get_ast\n    return MANAGER.ast_from_file(filepath, modname, source=True)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/manager.py\", line 167, in ast_from_file\n    return AstroidBuilder(self).file_build(filepath, modname)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/builder.py\", line 145, in file_build\n    return self._post_build(module, builder, encoding)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/builder.py\", line 173, in _post_build\n    module = self._manager.visit_transforms(module)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/manager.py\", line 128, in visit_transforms\n    return self._transform.visit(node)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/transforms.py\", line 162, in visit\n    return self._visit(node)\n           ^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/transforms.py\", line 84, in _visit\n    visited = self._visit_generic(value)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/transforms.py\", line 112, in _visit_generic\n    return [self._visit_generic(child) for child in node]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/transforms.py\", line 112, in <listcomp>\n    return [self._visit_generic(child) for child in node]\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/transforms.py\", line 119, in _visit_generic\n    return self._visit(node)\n           ^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/transforms.py\", line 87, in _visit\n    return self._transform(node)\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"astroid/astroid/transforms.py\", line 66, in _transform\n    if predicate is None or predicate(node):\n                            ^^^^^^^^^^^^^^^\n  File \"astroid/astroid/brain/brain_attrs.py\", line 59, in is_decorated_with_attrs\n    if inferred and inferred.root().name == \"attr._next_gen\":\n                    ^^^^^^^^^^^^^^^\n  File \"astroid/astroid/nodes/node_ng.py\", line 334, in root\n    assert isinstance(self, nodes.Module)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAssertionError\n```\n\n### Similar issues\n- #2618\n\n### Version\n- 8527f5b6f7fb\n",
  "pull_number": 2739,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/test_regrtest.py b/tests/test_regrtest.py\nindex 5321c7e0c..b683f4db7 100644\n--- a/tests/test_regrtest.py\n+++ b/tests/test_regrtest.py\n@@ -500,6 +500,21 @@ def _get_option(self, option):\n     assert node.inferred()[0].value == \"mystr\"\n \n \n+def test_regression_root_is_not_a_module() -> None:\n+    \"\"\"Regression test for #2672.\"\"\"\n+    node: nodes.Attribute = _extract_single_node(\n+        textwrap.dedent(\n+            \"\"\"\n+        a=eval.__get__(1).__gt__\n+\n+        @a\n+        class c: ...\n+        \"\"\"\n+        )\n+    )\n+    assert node.name == \"c\"\n+\n+\n def test_regression_no_crash_during_build() -> None:\n     node: nodes.Attribute = extract_node(\"__()\")\n     assert node.args == []\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/59f36e755d04765b2b623c7c51e84509c6b248f6"
}