{
  "all_hints_text": "Thank you for the investigation @The-Compiler ! I'm going to revert the offending commit seeing it's only a cleanup. Let's do something more elegant later on if required.\nThe commit you linked is from a fork, so I tried to reproduce locally to bisect on pylint main repo but I cannot\r\n```\r\npip3 install PyQt5\r\nCollecting PyQt5\r\n Collecting PyQt5-sip<13,>=12.11\r\nCollecting PyQt5-Qt5>=5.15.0\r\nInstalling collected packages: PyQt5-Qt5, PyQt5-sip, PyQt5\r\nSuccessfully installed PyQt5-5.15.7 PyQt5-Qt5-5.15.2 PyQt5-sip-12.11.0\r\n(venv) fix-crash-regression-2.13.2: pylint --extension-pkg-whitelist=PyQt5 x.py \r\n************* Module x\r\nx.py:1:0: W0611: Unused QtWidgets imported from PyQt5 (unused-import)\r\n---------------------------------------------------------------------\r\n\r\nYour code has been rated at 0.00/10 (previous run: -50.00/10, +50.00)\r\n```\r\nCould you provide your other dependencies maybe ?\r\n\n> The commit you linked is from a fork, so I tried to reproduce locally to bisect on pylint main repo but I cannot\r\n\r\nThe main astroid repo bisects to the merge of #1885 (f26dbe419ac15a87ed65e9b55ed15d3d8100b608) - that was a squash merge, 974f26f75eb3eccb4bcd8ea143901baf60a685ff is my guess at what in the PR is the problem.\r\n\r\n> Could you provide your other dependencies maybe ?\r\n\r\nNothing else really:\r\n\r\n```\r\n\u2500[florian@aragog]\u2500\u2500[~/tmp/pylintbug]\u2500\u2500[23-01-10]\u2500\u2500[12:35]\u2500\u2500\u2500\u2500\u2504\r\n$ python3 --version\r\nPython 3.10.8\r\n\r\n\u2500[florian@aragog]\u2500\u2500[~/tmp/pylintbug]\u2500\u2500[23-01-10]\u2500\u2500[12:35]\u2500\u2500\u2500\u2500\u2504\r\n$ python3 -m venv .venv\r\npython3 -m venv .venv  2.87s user 0.26s system 98% cpu 3.170 total\r\n\r\n\u2500[florian@aragog]\u2500\u2500[~/tmp/pylintbug]\u2500\u2500[23-01-10]\u2500\u2500[12:35]\u2500\u2500\u2500\u2500\u2504\r\n$ .venv/bin/pip install pylint PyQt5\r\nCollecting pylint\r\n  Using cached pylint-2.15.10-py3-none-any.whl (509 kB)\r\nCollecting PyQt5\r\n  Using cached PyQt5-5.15.7-cp37-abi3-manylinux1_x86_64.whl (8.4 MB)\r\nCollecting tomli>=1.1.0\r\n  Using cached tomli-2.0.1-py3-none-any.whl (12 kB)\r\nCollecting tomlkit>=0.10.1\r\n  Using cached tomlkit-0.11.6-py3-none-any.whl (35 kB)\r\nCollecting platformdirs>=2.2.0\r\n  Using cached platformdirs-2.6.2-py3-none-any.whl (14 kB)\r\nCollecting mccabe<0.8,>=0.6\r\n  Using cached mccabe-0.7.0-py2.py3-none-any.whl (7.3 kB)\r\nCollecting dill>=0.2\r\n  Using cached dill-0.3.6-py3-none-any.whl (110 kB)\r\nCollecting astroid<=2.14.0-dev0,>=2.12.13\r\n  Using cached astroid-2.13.2-py3-none-any.whl (272 kB)\r\nCollecting isort<6,>=4.2.5\r\n  Using cached isort-5.11.4-py3-none-any.whl (104 kB)\r\nCollecting PyQt5-Qt5>=5.15.0\r\n  Using cached PyQt5_Qt5-5.15.2-py3-none-manylinux2014_x86_64.whl (59.9 MB)\r\nCollecting PyQt5-sip<13,>=12.11\r\n  Using cached PyQt5_sip-12.11.0-cp310-cp310-manylinux1_x86_64.whl (359 kB)\r\nCollecting lazy-object-proxy>=1.4.0\r\n  Using cached lazy_object_proxy-1.9.0-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (63 kB)\r\nCollecting wrapt<2,>=1.11\r\n  Using cached wrapt-1.14.1-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (77 kB)\r\nCollecting typing-extensions>=4.0.0\r\n  Using cached typing_extensions-4.4.0-py3-none-any.whl (26 kB)\r\nInstalling collected packages: PyQt5-Qt5, wrapt, typing-extensions, tomlkit, tomli, PyQt5-sip, platformdirs, mccabe, lazy-object-proxy, isort, dill, PyQt5, astroid, pylint\r\nSuccessfully installed PyQt5-5.15.7 PyQt5-Qt5-5.15.2 PyQt5-sip-12.11.0 astroid-2.13.2 dill-0.3.6 isort-5.11.4 lazy-object-proxy-1.9.0 mccabe-0.7.0 platformdirs-2.6.2 pylint-2.15.10 tomli-2.0.1 tomlkit-0.11.6 typing-extensions-4.4.0 wrapt-1.14.1\r\n\r\n[notice] A new release of pip available: 22.2.2 -> 22.3.1\r\n[notice] To update, run: python3 -m pip install --upgrade pip\r\n.venv/bin/pip install pylint PyQt5  3.18s user 0.57s system 74% cpu 5.004 total\r\n\r\n\u2500[florian@aragog]\u2500\u2500[~/tmp/pylintbug]\u2500\u2500[23-01-10]\u2500\u2500[12:35]\u2500\u2500\u2500\u2500\u2504\r\n$ cat x.py\r\nfrom PyQt5 import QtWidgets\r\n\r\n\u2500[florian@aragog]\u2500\u2500[~/tmp/pylintbug]\u2500\u2500[23-01-10]\u2500\u2500[12:35]\u2500\u2500\u2500\u2500\u2504\r\n$ .venv/bin/pylint --extension-pkg-whitelist=PyQt5 x.py \r\n************* Module x\r\nx.py:1:0: C0114: Missing module docstring (missing-module-docstring)\r\nException on node <ImportFrom l.1 at 0x7fa1f6e37d90> in file '/home/florian/tmp/pylintbug/x.py'\r\nTraceback (most recent call last):\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/pylint/utils/ast_walker.py\", line 90, in walk\r\n    callback(astroid)\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/pylint/checkers/variables.py\", line 1726, in visit_importfrom\r\n    self._check_module_attrs(node, module, name.split(\".\"))\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/pylint/checkers/variables.py\", line 2701, in _check_module_attrs\r\n    module = next(module.getattr(name)[0].infer())\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/nodes/scoped_nodes/scoped_nodes.py\", line 412, in getattr\r\n    result = [self.import_module(name, relative_only=True)]\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/nodes/scoped_nodes/scoped_nodes.py\", line 527, in import_module\r\n    return AstroidManager().ast_from_module_name(\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/manager.py\", line 205, in ast_from_module_name\r\n    return self.ast_from_module(named_module, modname)\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/manager.py\", line 312, in ast_from_module\r\n    return AstroidBuilder(self).module_build(module, modname)\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/builder.py\", line 101, in module_build\r\n    node = self.inspect_build(module, modname=modname, path=path)\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/raw_building.py\", line 366, in inspect_build\r\n    self.object_build(node, module)\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/raw_building.py\", line 422, in object_build\r\n    elif hasattr(member, \"__all__\"):\r\nRuntimeError: wrapped C/C++ object of type QApplication has been deleted\r\nx.py:1:0: F0002: x.py: Fatal error while checking 'x.py'. Please open an issue in our bug tracker so we address this. There is a pre-filled template that you can use in '/home/florian/.cache/pylint/pylint-crash-2023-01-10-12-36-04.txt'. (astroid-error)\r\n\r\n------------------------------------------------------------------\r\nYour code has been rated at 0.00/10 (previous run: 0.00/10, +0.00)\r\n```\r\n\n\n",
  "base_commit": "49691cc04f2d38b174787280f7ed38f818c828bd",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/552398de7f4742c8bd92da10ebe1e1692f955d7a",
    "https://github.com/pylint-dev/astroid/commit/9cba801a101120623bd43949932f5ac823104c10",
    "https://github.com/pylint-dev/astroid/commit/fd01fc84b369ad6caa4ad328e60c555a8d8f512f"
  ],
  "created_at": "2023-01-10T12:07:01Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-1959",
  "issue_numbers": [
    1958
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex c61ee15974..94208b67da 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -12,7 +12,9 @@ What's New in astroid 2.13.3?\n =============================\n Release date: TBA\n \n+* Fix a regression in 2.13.2 where a RunTimeError could be raised unexpectedly.\n \n+  Closes #1958\n \n What's New in astroid 2.13.2?\n =============================\ndiff --git a/astroid/raw_building.py b/astroid/raw_building.py\nindex fe19bb750b..cc3aa01525 100644\n--- a/astroid/raw_building.py\n+++ b/astroid/raw_building.py\n@@ -324,6 +324,17 @@ def _build_from_function(\n         object_build_function(node, member, name)\n \n \n+def _safe_has_attribute(obj, member: str) -> bool:\n+    \"\"\"Required because unexpected RunTimeError can be raised.\n+\n+    See https://github.com/PyCQA/astroid/issues/1958\n+    \"\"\"\n+    try:\n+        return hasattr(obj, member)\n+    except Exception:  # pylint: disable=broad-except\n+        return False\n+\n+\n class InspectBuilder:\n     \"\"\"class for building nodes from living object\n \n@@ -419,7 +430,7 @@ def object_build(\n                 # This should be called for Jython, where some builtin\n                 # methods aren't caught by isbuiltin branch.\n                 _build_from_function(node, name, member, self._module)\n-            elif hasattr(member, \"__all__\"):\n+            elif _safe_has_attribute(member, \"__all__\"):\n                 module = build_module(name)\n                 _attach_local_node(node, module, name)\n                 # recursion\n",
  "problem_statement": "v2.13.x regression: Crash when inspecting `PyQt5.QtWidgets` due to `RuntimeError` during `hasattr`\n### Steps to reproduce\r\n\r\nInstall PyQt5, run `pylint --extension-pkg-whitelist=PyQt5 x.py` over a file containing `from PyQt5 import QtWidgets`\r\n\r\n### Current behavior\r\n\r\nWith astroid 2.12.13 and pylint 2.15.10, this works fine. With astroid 2.13.2, this happens:\r\n\r\n```pytb\r\nException on node <ImportFrom l.1 at 0x7fc5a3c47d00> in file '/home/florian/tmp/pylintbug/x.py'\r\nTraceback (most recent call last):\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/pylint/utils/ast_walker.py\", line 90, in walk\r\n    callback(astroid)\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/pylint/checkers/variables.py\", line 1726, in visit_importfrom\r\n    self._check_module_attrs(node, module, name.split(\".\"))\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/pylint/checkers/variables.py\", line 2701, in _check_module_attrs\r\n    module = next(module.getattr(name)[0].infer())\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/nodes/scoped_nodes/scoped_nodes.py\", line 412, in getattr\r\n    result = [self.import_module(name, relative_only=True)]\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/nodes/scoped_nodes/scoped_nodes.py\", line 527, in import_module\r\n    return AstroidManager().ast_from_module_name(\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/manager.py\", line 205, in ast_from_module_name\r\n    return self.ast_from_module(named_module, modname)\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/manager.py\", line 312, in ast_from_module\r\n    return AstroidBuilder(self).module_build(module, modname)\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/builder.py\", line 101, in module_build\r\n    node = self.inspect_build(module, modname=modname, path=path)\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/raw_building.py\", line 366, in inspect_build\r\n    self.object_build(node, module)\r\n  File \"/home/florian/tmp/pylintbug/.venv/lib/python3.10/site-packages/astroid/raw_building.py\", line 422, in object_build\r\n    elif hasattr(member, \"__all__\"):\r\nRuntimeError: wrapped C/C++ object of type QApplication has been deleted\r\nx.py:1:0: F0002: x.py: Fatal error while checking 'x.py'. Please open an issue in our bug tracker so we address this. There is a pre-filled template that you can use in '/home/florian/.cache/pylint/pylint-crash-2023-01-10-11-06-17.txt'. (astroid-error)\r\n```\r\n\r\nIt looks like it happens when `member` is `QtWidgets.qApp`, which is a kind of \"magic\" object referring to the QApplication singleton. Since none exists, it looks like PyQt doesn't like trying to access an attribute on that.\r\n\r\nBisected to:\r\n\r\n- #1885 \r\n\r\nIt looks like 974f26f75eb3eccb4bcd8ea143901baf60a685ff is the exact culprit.\r\n\r\ncc @nickdrozd \r\n\r\n(took the freedom to add appropriate labels already, hope that's fine)\r\n\n",
  "pull_number": 1959,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/testdata/python3/data/fake_module_with_broken_getattr.py b/tests/testdata/python3/data/fake_module_with_broken_getattr.py\nnew file mode 100644\nindex 0000000000..e860928ecb\n--- /dev/null\n+++ b/tests/testdata/python3/data/fake_module_with_broken_getattr.py\n@@ -0,0 +1,7 @@\n+class Broken:\n+\n+    def __getattr__(self, name):\n+        raise Exception(\"boom\")\n+\n+\n+broken = Broken()\ndiff --git a/tests/unittest_raw_building.py b/tests/unittest_raw_building.py\nindex 59bd6ce158..64c2272711 100644\n--- a/tests/unittest_raw_building.py\n+++ b/tests/unittest_raw_building.py\n@@ -1,3 +1,9 @@\n+\"\"\"\n+'tests.testdata.python3.data.fake_module_with_warnings' and\n+'tests.testdata.python3.data.fake_module_with_warnings' are fake modules\n+to simulate issues in unittest below\n+\"\"\"\n+\n # Licensed under the LGPL: https://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html\n # For details: https://github.com/PyCQA/astroid/blob/main/LICENSE\n # Copyright (c) https://github.com/PyCQA/astroid/blob/main/CONTRIBUTORS.txt\n@@ -8,7 +14,7 @@\n import _io\n import pytest\n \n-# A fake module to simulate pandas in unittest below\n+import tests.testdata.python3.data.fake_module_with_broken_getattr as fm_getattr\n import tests.testdata.python3.data.fake_module_with_warnings as fm\n from astroid.builder import AstroidBuilder\n from astroid.const import IS_PYPY\n@@ -102,6 +108,14 @@ def test_build_function_deepinspect_deprecation(self) -> None:\n         # This should not raise an exception\n         AstroidBuilder().module_build(m, \"test\")\n \n+    def test_module_object_with_broken_getattr(self) -> None:\n+        # Tests https://github.com/PyCQA/astroid/issues/1958\n+        # When astroid deep inspection of modules raises\n+        # errors when using hasattr().\n+\n+        # This should not raise an exception\n+        AstroidBuilder().inspect_build(fm_getattr, \"test\")\n+\n \n if __name__ == \"__main__\":\n     unittest.main()\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/49691cc04f2d38b174787280f7ed38f818c828bd"
}