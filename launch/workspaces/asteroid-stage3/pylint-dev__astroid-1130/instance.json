{
  "all_hints_text": "@cdce8p thanks for pointing this out. I'm on it, hope to get up a PR soon.\n\n",
  "base_commit": "02a4c266534fb473da07ea5b905726281d06cbde",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/c6150a4f080bbf6c0cdc3891b9c46cda75340ced",
    "https://github.com/pylint-dev/astroid/commit/cf5e941983a62a9c87e1081658f38adc29c60a69"
  ],
  "created_at": "2021-08-16T14:36:35Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-1130",
  "issue_numbers": [
    1129
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex f0cc1df31e..615941fb66 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -12,8 +12,13 @@ What's New in astroid 2.7.1?\n ============================\n Release date: TBA\n \n+* When processing dataclass attributes, only do typing inference on collection types.\n+  Support for instantiating other typing types is left for the future, if desired.\n+\n+\n * Fixed LookupMixIn missing from ``astroid.node_classes``.\n \n+  Closes #1129\n \n \n What's New in astroid 2.7.0?\ndiff --git a/astroid/brain/brain_dataclasses.py b/astroid/brain/brain_dataclasses.py\nindex f42c981cad..b4be357fc9 100644\n--- a/astroid/brain/brain_dataclasses.py\n+++ b/astroid/brain/brain_dataclasses.py\n@@ -97,16 +97,7 @@ def infer_dataclass_attribute(\n     if value is not None:\n         yield from value.infer(context=ctx)\n     if annotation is not None:\n-        klass = None\n-        try:\n-            klass = next(annotation.infer())\n-        except (InferenceError, StopIteration):\n-            yield Uninferable\n-\n-        if not isinstance(klass, ClassDef):\n-            yield Uninferable\n-        else:\n-            yield klass.instantiate_class()\n+        yield from _infer_instance_from_annotation(annotation, ctx=ctx)\n     else:\n         yield Uninferable\n \n@@ -229,6 +220,44 @@ def _is_init_var(node: NodeNG) -> bool:\n     return getattr(inferred, \"name\", \"\") == \"InitVar\"\n \n \n+# Allowed typing classes for which we support inferring instances\n+_INFERABLE_TYPING_TYPES = frozenset(\n+    (\n+        \"Dict\",\n+        \"FrozenSet\",\n+        \"List\",\n+        \"Set\",\n+        \"Tuple\",\n+    )\n+)\n+\n+\n+def _infer_instance_from_annotation(\n+    node: NodeNG, ctx: context.InferenceContext = None\n+) -> Generator:\n+    \"\"\"Infer an instance corresponding to the type annotation represented by node.\n+\n+    Currently has limited support for the typing module.\n+    \"\"\"\n+    klass = None\n+    try:\n+        klass = next(node.infer(context=ctx))\n+    except (InferenceError, StopIteration):\n+        yield Uninferable\n+    if not isinstance(klass, ClassDef):\n+        yield Uninferable\n+    elif klass.root().name in (\n+        \"typing\",\n+        \"\",\n+    ):  # \"\" because of synthetic nodes in brain_typing.py\n+        if klass.name in _INFERABLE_TYPING_TYPES:\n+            yield klass.instantiate_class()\n+        else:\n+            yield Uninferable\n+    else:\n+        yield klass.instantiate_class()\n+\n+\n if PY37_PLUS:\n     AstroidManager().register_transform(\n         ClassDef, dataclass_transform, is_decorated_with_dataclass\n",
  "problem_statement": "Regression with dataclass inference\n### Steps to reproduce\r\n\r\n```py\r\nfrom dataclasses import dataclass\r\nfrom typing import Any, Callable\r\n\r\n@dataclass\r\nclass A:\r\n    enabled: Callable[[Any], bool]\r\n\r\ninstance = A(lambda x: x == 42)\r\ninstance.enabled(2)  # not-callable\r\n```\r\n\r\n### Current behavior\r\n\r\n```\r\n************* Module test\r\ntest.py:9:0: E1102: instance.enabled is not callable (not-callable)\r\n```\r\n\r\n### Expected behavior\r\n\r\nNo error\r\n\r\n### Additional information\r\n\r\nTested with astroid `v2.7.0`.\r\nThe issue seems to be a direct result of #1126\r\n\r\n/CC: @david-yz-liu @Pierre-Sassoulas\n",
  "pull_number": 1130,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_brain_dataclasses.py b/tests/unittest_brain_dataclasses.py\nindex f7b08747f0..f90893d5cd 100644\n--- a/tests/unittest_brain_dataclasses.py\n+++ b/tests/unittest_brain_dataclasses.py\n@@ -4,6 +4,7 @@\n from astroid import bases, nodes\n from astroid.const import PY37_PLUS\n from astroid.exceptions import InferenceError\n+from astroid.util import Uninferable\n \n if not PY37_PLUS:\n     pytest.skip(\"Dataclasses were added in 3.7\", allow_module_level=True)\n@@ -235,3 +236,62 @@ class A:\n         assert len(inferred) == 1\n         assert isinstance(inferred[0], nodes.Const)\n         assert inferred[0].value == \"hi\"\n+\n+\n+def test_inference_generic_collection_attribute():\n+    \"\"\"Test that an attribute with a generic collection type from the\n+    typing module is inferred correctly.\n+    \"\"\"\n+    attr_nodes = astroid.extract_node(\n+        \"\"\"\n+    from dataclasses import dataclass, field\n+    import typing\n+\n+    @dataclass\n+    class A:\n+        dict_prop: typing.Dict[str, str]\n+        frozenset_prop: typing.FrozenSet[str]\n+        list_prop: typing.List[str]\n+        set_prop: typing.Set[str]\n+        tuple_prop: typing.Tuple[int, str]\n+\n+    a = A({}, frozenset(), [], set(), (1, 'hi'))\n+    a.dict_prop       #@\n+    a.frozenset_prop  #@\n+    a.list_prop       #@\n+    a.set_prop        #@\n+    a.tuple_prop      #@\n+    \"\"\"\n+    )\n+    names = (\n+        \"Dict\",\n+        \"FrozenSet\",\n+        \"List\",\n+        \"Set\",\n+        \"Tuple\",\n+    )\n+    for node, name in zip(attr_nodes, names):\n+        inferred = next(node.infer())\n+        assert isinstance(inferred, bases.Instance)\n+        assert inferred.name == name\n+\n+\n+def test_inference_callable_attribute():\n+    \"\"\"Test that an attribute with a Callable annotation is inferred as Uninferable.\n+\n+    See issue#1129.\n+    \"\"\"\n+    instance = astroid.extract_node(\n+        \"\"\"\n+    from dataclasses import dataclass\n+    from typing import Any, Callable\n+\n+    @dataclass\n+    class A:\n+        enabled: Callable[[Any], bool]\n+\n+    A(lambda x: x == 42).enabled  #@\n+    \"\"\"\n+    )\n+    inferred = next(instance.infer())\n+    assert inferred is Uninferable\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/02a4c266534fb473da07ea5b905726281d06cbde"
}