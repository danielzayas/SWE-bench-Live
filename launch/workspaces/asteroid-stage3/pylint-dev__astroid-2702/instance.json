{
  "all_hints_text": "I think this is sort of expected behaviour, although obviously not ideal.\n\nI don't really know if there would be a better solution than the one we currently have for frozen modules, but we're obviously open to suggestions.\n@pmustonen any proposed fixes are welcome, I'm assigning myself not to discourage anyone else's contributions, but just to put it on a tinker list for when I might have time.\n\n",
  "base_commit": "291c3a581f7442384ec1c033d4c0f80e8f9e99ae",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/83210950efa9d986300ebdc257d305fa80d78b5f"
  ],
  "created_at": "2025-03-09T20:04:41Z",
  "hints_text": "I think this is sort of expected behaviour, although obviously not ideal.\n\nI don't really know if there would be a better solution than the one we currently have for frozen modules, but we're obviously open to suggestions.\n@pmustonen any proposed fixes are welcome, I'm assigning myself not to discourage anyone else's contributions, but just to put it on a tinker list for when I might have time.\n\n",
  "instance_id": "pylint-dev__astroid-2702",
  "issue_numbers": [
    2684
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 54975c4d7..d730e8e82 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -37,7 +37,9 @@ What's New in astroid 3.3.10?\n =============================\n Release date: TBA\n \n+* Avoid importing submodules sharing names with standard library modules.\n \n+  Closes #2684\n \n \n What's New in astroid 3.3.9?\ndiff --git a/astroid/interpreter/_import/spec.py b/astroid/interpreter/_import/spec.py\nindex 1e4073ecf..9628f7453 100644\n--- a/astroid/interpreter/_import/spec.py\n+++ b/astroid/interpreter/_import/spec.py\n@@ -174,7 +174,7 @@ def find_module(\n             # module. Note that `find_spec` actually imports parent modules, so we want to make\n             # sure we only run this code for stuff that can be expected to be frozen. For now\n             # this is only stdlib.\n-            if modname in sys.stdlib_module_names or (\n+            if (modname in sys.stdlib_module_names and not processed) or (\n                 processed and processed[0] in sys.stdlib_module_names\n             ):\n                 try:\n",
  "problem_statement": "Astroid >=3.3.7 imports and executes modules that contain any similarly named identifier as some stdlib module\nThe frozen module finding logic in astroid >= 3.3.7 (https://github.com/pylint-dev/astroid/blob/main/astroid/interpreter/_import/spec.py#L177) seems to interfere with non-module names that match with names in `sys.stdlib_module_names`. \n\nThe following example is done with pylint (using pylint 3.3.4, astroid 3.3.8 and Python 3.12.8), but I'm still posting it here because it seems to be astroid-related issue. The most simple reproduction I was able to figure out is with a module that is imported\n\n#### sayhi.py\n```\nprint(\"hello\")\n\ndef trace():\n    pass\n```\n\n#### main.py:\n```\nfrom sayhi import trace\n```\n\noutput from `pylint main.py` is\n\n```\nhello\n************* Module main\nmain.py 1: Unused trace imported from sayhi (unused-import)\n```\n\nThe `trace` here is also name of a module in stdlib, but that should be valid Python code anyway.\n\nExpected outcome is that \"hello\" is not printed, as `sayhi.py` shouldn't be imported or executed by astroid (or pylint). That is also the case with astroid 3.3.6. \n",
  "pull_number": 2702,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/test_modutils.py b/tests/test_modutils.py\nindex 6635ba186..e1b4be384 100644\n--- a/tests/test_modutils.py\n+++ b/tests/test_modutils.py\n@@ -628,3 +628,18 @@ def test_find_setuptools_pep660_editable_install():\n     with unittest.mock.patch.object(sys, \"meta_path\", new=[_EditableFinder]):\n         assert spec.find_spec([\"example\"])\n         assert spec.find_spec([\"example\", \"subpackage\"])\n+\n+\n+def test_no_import_done_for_submodule_sharing_std_lib_name() -> None:\n+    sys.path.insert(0, resources.find(\"data\"))\n+    try:\n+        with pytest.raises(ImportError):\n+            spec._find_spec_with_path(\n+                [resources.find(\"data\")],\n+                \"trace\",\n+                (\"divide_by_zero\", \"trace\"),\n+                (\"divide_by_zero\",),\n+                resources.find(\"data/divide_by_zero\"),\n+            )\n+    finally:\n+        sys.path.pop(0)\ndiff --git a/tests/testdata/python3/data/divide_by_zero.py b/tests/testdata/python3/data/divide_by_zero.py\nnew file mode 100644\nindex 000000000..72dca4d5e\n--- /dev/null\n+++ b/tests/testdata/python3/data/divide_by_zero.py\n@@ -0,0 +1,1 @@\n+1 / 0\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/291c3a581f7442384ec1c033d4c0f80e8f9e99ae"
}