{
  "all_hints_text": "Thanks for the great report.\n\n",
  "base_commit": "014a04ced92d44351cac682ea6005609b3c1027f",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/2e852766d25796549d228d493998cec2670c575c",
    "https://github.com/pylint-dev/astroid/commit/1078dec221d09aa4b80c7ba2084080882ff814e8"
  ],
  "created_at": "2022-03-15T16:48:05Z",
  "hints_text": "Thanks for the great report.\n\n",
  "instance_id": "pylint-dev__astroid-1477",
  "issue_numbers": [
    817
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 0ecb2593f4..1a7852f889 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -15,6 +15,9 @@ Release date: TBA\n * Promoted ``getattr()`` from ``astroid.scoped_nodes.FunctionDef`` to its parent\n   ``astroid.scoped_nodes.Lambda``.\n \n+* Fixed crash on direct inference via ``nodes.FunctionDef._infer``.\n+\n+  Closes #817\n \n \n What's New in astroid 2.11.0?\ndiff --git a/astroid/inference.py b/astroid/inference.py\nindex 972244509a..d22030044f 100644\n--- a/astroid/inference.py\n+++ b/astroid/inference.py\n@@ -1039,8 +1039,10 @@ def infer_ifexp(self, context=None):\n \n # pylint: disable=dangerous-default-value\n @wrapt.decorator\n-def _cached_generator(func, instance, args, kwargs, _cache={}):  # noqa: B006\n-    node = args[0]\n+def _cached_generator(\n+    func, instance: _FunctionDefT, args, kwargs, _cache={}  # noqa: B006\n+):\n+    node = instance\n     try:\n         return iter(_cache[func, id(node)])\n     except KeyError:\ndiff --git a/astroid/nodes/node_ng.py b/astroid/nodes/node_ng.py\nindex fcbe610023..db249af466 100644\n--- a/astroid/nodes/node_ng.py\n+++ b/astroid/nodes/node_ng.py\n@@ -165,7 +165,7 @@ def infer(self, context=None, **kwargs):\n \n         if not context:\n             # nodes_inferred?\n-            yield from self._infer(context, **kwargs)\n+            yield from self._infer(context=context, **kwargs)\n             return\n \n         key = (self, context.lookupname, context.callcontext, context.boundnode)\n@@ -173,7 +173,7 @@ def infer(self, context=None, **kwargs):\n             yield from context.inferred[key]\n             return\n \n-        generator = self._infer(context, **kwargs)\n+        generator = self._infer(context=context, **kwargs)\n         results = []\n \n         # Limit inference amount to help with performance issues with\n",
  "problem_statement": "IndexError in FunctionDef._infer()\n### Steps to reproduce\r\nRun following code:\r\n```\r\nimport astroid\r\ncode = \"def func(): pass\"\r\nfuncdef = astroid.extract_node(code)\r\nprint(next(funcdef._infer()))\r\n```\r\n\r\n### Current behavior\r\n```\r\n---------------------------------------------------------------------------\r\nIndexError                                Traceback (most recent call last)\r\n<ipython-input-4-0a19b019c67b> in <module>\r\n----> 1 print(next(funcdef._infer()))\r\n\r\n/dat/uber/prod/python/venv/py_3.7.4_prod_20200604_0/lib/python3.7/site-packages/astroid/inference.py in _cached_generator(func, instance, args, kwargs, _cache)\r\n    957 @wrapt.decorator\r\n    958 def _cached_generator(func, instance, args, kwargs, _cache={}):\r\n--> 959     node = args[0]\r\n    960     try:\r\n    961         return iter(_cache[func, id(node)])\r\n\r\nIndexError: tuple index out of range\r\n```\r\n\r\nThis is actually a combination of two bugs:\r\n1. `astroid.inference._cached_generator` is decorated by `wrapt.decorator`. And in the mean time you try to access node instance via `node = args[0]`. This is incorrect, you should use `node = instance` instead.\r\n2. `NodeNG.infer` calls `_infer` with `context` as positional argument instead of keyword one. See https://github.com/PyCQA/astroid/blob/master/astroid/node_classes.py#L363 and https://github.com/PyCQA/astroid/blob/master/astroid/node_classes.py#L371. That's why this error never happens in usual workflow.\r\n\r\nSince `_cached_generator` works not as expected, this may also have some impact on inference caching, but I did not encounter any other issues here.\r\n\r\n### Expected behavior\r\nNo error\r\n\r\n### ``python -c \"from astroid import __pkginfo__; print(__pkginfo__.version)\"`` output\r\n2.4.1\r\n\n",
  "pull_number": 1477,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_inference.py b/tests/unittest_inference.py\nindex fac44d23ca..b5fc7d99f4 100644\n--- a/tests/unittest_inference.py\n+++ b/tests/unittest_inference.py\n@@ -6640,5 +6640,11 @@ def patch(cls):\n     assert module\n \n \n+def test_function_def_cached_generator() -> None:\n+    \"\"\"Regression test for https://github.com/PyCQA/astroid/issues/817.\"\"\"\n+    funcdef: nodes.FunctionDef = extract_node(\"def func(): pass\")\n+    next(funcdef._infer())\n+\n+\n if __name__ == \"__main__\":\n     unittest.main()\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/014a04ced92d44351cac682ea6005609b3c1027f"
}