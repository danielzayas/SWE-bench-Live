{
  "all_hints_text": "#1276 is actually working on this, but we ran into issues with the different `ast` parsers on different versions and implementations of Python.\r\n\r\nNote that the line numbers are not correct on some versions which is why the PR stalled a bit.\nAre you on a version lower than python 3.8 @tristanlatr ?\nI'm trying to write code that is python 3.6+ compatible. \nOK, to summarize python 3.8 has better lineno/column and we're focusing on python 3.8+ because fixing the information coming from the ast takes a long time. Also python 3.6+ is EOL now. That said I've seen [this comment](https://github.com/PyCQA/astroid/pull/1276#discussion_r783337011) you made and if it works we could merge.\nUntil #1276 is merged, my workaround is the following:\r\n\r\n```python\r\nastroid.rebuilder.TreeRebuilder._get_doc = lambda _,o:(o, None)\r\n```\r\n\r\nThen parse docstrings statements manually.\n\n",
  "base_commit": "56f5f055e4847e9fc2b74162ccad8f2a11db3bfc",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/06c6cb3490b9b2a9bded08f901842b099d746975",
    "https://github.com/pylint-dev/astroid/commit/1183453b22f0c915ae9f6c2dffffa68a096bf5b9",
    "https://github.com/pylint-dev/astroid/commit/0b6c2556e57667783cc336a1b239fe2b243b6c18",
    "https://github.com/pylint-dev/astroid/commit/a437d854132e8568e52c4a772bd50eed31189052",
    "https://github.com/pylint-dev/astroid/commit/ae28749fe0fcba6cc0f90b3c7cd40eaeaf465fe0",
    "https://github.com/pylint-dev/astroid/commit/f308dc96a5968612463cef9ef41cba34120b7af0",
    "https://github.com/pylint-dev/astroid/commit/cc59a2c5557c77df0dfd858c546fa222159a35c2",
    "https://github.com/pylint-dev/astroid/commit/2b49307df00e810f43f74a33a8195f568bc4feb6",
    "https://github.com/pylint-dev/astroid/commit/e926ad38aed434aff243affda57634f4ab386341",
    "https://github.com/pylint-dev/astroid/commit/861bf47e5db48c49d705c34932e9cebf35182c60",
    "https://github.com/pylint-dev/astroid/commit/5bb2942c6643d4e36bbd18ac0e1ec9dbe1829fb4",
    "https://github.com/pylint-dev/astroid/commit/cefbe623c7be9d49903c0d3c8f0130fd6697b201",
    "https://github.com/pylint-dev/astroid/commit/922575a6208419cf91ee17f2b51cccd4917edfe0",
    "https://github.com/pylint-dev/astroid/commit/05772550f24a9718a85b0d8d37b59289c1d5cb31",
    "https://github.com/pylint-dev/astroid/commit/1138b00ac5e8eb4e8a1c946557ee7fe55516bdb7",
    "https://github.com/pylint-dev/astroid/commit/5150ef05e15cd2a1fe766cdbde1b866184bbaa39",
    "https://github.com/pylint-dev/astroid/commit/a0b314cd6ea88fae539a4e95fd72bcf42b0359b2",
    "https://github.com/pylint-dev/astroid/commit/7514c6abfb84217ada712d114464f2b59a430212",
    "https://github.com/pylint-dev/astroid/commit/94df31110fe0bcfe11786b26ec31940c3d629b57",
    "https://github.com/pylint-dev/astroid/commit/ec28a0def38caa6395c61bcee32a26aa01f47761",
    "https://github.com/pylint-dev/astroid/commit/d905e517bcb1a7edd72657914f90a334cf9a0204",
    "https://github.com/pylint-dev/astroid/commit/f699dae04f9f702f84094210cb5da7dc0f2ad047",
    "https://github.com/pylint-dev/astroid/commit/dfb39c76abafe61712caa266be71956a3bbd26f7",
    "https://github.com/pylint-dev/astroid/commit/e5195d0403d7bfd58e1fa71f1f9024c97089330c",
    "https://github.com/pylint-dev/astroid/commit/a058c717100772e57c05678b855bac23e03182b4",
    "https://github.com/pylint-dev/astroid/commit/f9cd4b3ad89fe47cc225ad0c5d60513773f1a829",
    "https://github.com/pylint-dev/astroid/commit/f31c38074ae18e20d343a71d338e5f046a2ed176",
    "https://github.com/pylint-dev/astroid/commit/e61409f68ec297434a49ad83c7688facba301d99",
    "https://github.com/pylint-dev/astroid/commit/e1a8e25d079776c3fbbbcc8ddc825be155ba6c0a",
    "https://github.com/pylint-dev/astroid/commit/c21d5549bfaf9004140f97712300f09817bc773b",
    "https://github.com/pylint-dev/astroid/commit/f8e59b091e2344faa21aa26ed7f1dbcdf8371c56",
    "https://github.com/pylint-dev/astroid/commit/0ed7e0880d1033a6e25ce7cb64307fa7d34b5b0f",
    "https://github.com/pylint-dev/astroid/commit/d64323e56e626b67596bb47b6ad76b53a0c9b774",
    "https://github.com/pylint-dev/astroid/commit/6d33464c89f132ffec49e93b6ed4101bc939f6bf",
    "https://github.com/pylint-dev/astroid/commit/8e429ef4668e80f10587ece383baf5ec757a3c52",
    "https://github.com/pylint-dev/astroid/commit/7079a96a66ca917605342cb3617671a7bcee9c3e",
    "https://github.com/pylint-dev/astroid/commit/5028f74e03b749548686ead6124ec7f17e29f8b1",
    "https://github.com/pylint-dev/astroid/commit/a1774e0050acd12ff92eb626f38e45294619cb95",
    "https://github.com/pylint-dev/astroid/commit/74af4f59f79e66cdea26072689712125a57e204c",
    "https://github.com/pylint-dev/astroid/commit/5709d81659694087425eb098658be79998400e84",
    "https://github.com/pylint-dev/astroid/commit/5f9e132115cf74b1c3351f36dedf177cf20e547b",
    "https://github.com/pylint-dev/astroid/commit/b4d3806b4ae20211fada2d91afd66e1c86b705d8",
    "https://github.com/pylint-dev/astroid/commit/529e79474376b5e0171d6bb5dd2afeb93a45d773",
    "https://github.com/pylint-dev/astroid/commit/331b36ae9df62720b9bf27dabf991719c55d93d5",
    "https://github.com/pylint-dev/astroid/commit/94846c3c9e90d9e6d6160e85c7fcdd2556d32338",
    "https://github.com/pylint-dev/astroid/commit/456ecc6715d1c9b28b10ea7f4f15530bb521bf54",
    "https://github.com/pylint-dev/astroid/commit/8cb685d000409f91d38268d595a009b591a1d94a",
    "https://github.com/pylint-dev/astroid/commit/761ce6f93aa4a197fe3ec54116b1f94f72566344",
    "https://github.com/pylint-dev/astroid/commit/89b0a411b224487045b52565f532334722422c6a",
    "https://github.com/pylint-dev/astroid/commit/e5cdda559be31700548e1b8e715d62c5e8e9d5f4",
    "https://github.com/pylint-dev/astroid/commit/0d847a12841276c590f3041f29419e7459fcae93",
    "https://github.com/pylint-dev/astroid/commit/263431894bf94239563af0233893bf780031e28e",
    "https://github.com/pylint-dev/astroid/commit/dc265ad03395ebd4f4250c59fef9243b967f0bbb",
    "https://github.com/pylint-dev/astroid/commit/da92f1c901efda111fba3ebf25730f04d254da07",
    "https://github.com/pylint-dev/astroid/commit/43d2d400d207a053a805c59f6e48c1f527fb4b02",
    "https://github.com/pylint-dev/astroid/commit/1a593ca0eef51581fc03b98eea19ab10a5e1d53f",
    "https://github.com/pylint-dev/astroid/commit/5e2324e5713e3c98eaf3b7800341a5d54d67610f",
    "https://github.com/pylint-dev/astroid/commit/bc6f0e82986b43df5a35d58369f0c708da9f75ac",
    "https://github.com/pylint-dev/astroid/commit/c43eb9cc38353a4095cd3f642576123286bd0d43",
    "https://github.com/pylint-dev/astroid/commit/847a2fa399ebf29269c2775722bb6f44071ddcba",
    "https://github.com/pylint-dev/astroid/commit/d3f7b8b3353657717a2ea5d99bc3f41d950fb7d6",
    "https://github.com/pylint-dev/astroid/commit/450720540e731184603d0649150a56b2dcfc0f6c",
    "https://github.com/pylint-dev/astroid/commit/c5f918156994e84667254a9608d3481ec386ec69",
    "https://github.com/pylint-dev/astroid/commit/fe86d0dde19f6bca39d8d86502f6975e7a8fc83a"
  ],
  "created_at": "2021-11-26T13:53:07Z",
  "hints_text": "\n\n",
  "instance_id": "pylint-dev__astroid-1276",
  "issue_numbers": [
    1340
  ],
  "language": "python",
  "patch": "diff --git a/ChangeLog b/ChangeLog\nindex 670628b8da..ea4c1e3319 100644\n--- a/ChangeLog\n+++ b/ChangeLog\n@@ -6,6 +6,8 @@ What's New in astroid 2.11.0?\n =============================\n Release date: TBA\n \n+* Add new (optional) ``doc_node`` attribute to ``nodes.Module``, ``nodes.ClassDef``,\n+  and ``nodes.FunctionDef``.\n \n \n What's New in astroid 2.10.1?\n@@ -13,7 +15,6 @@ What's New in astroid 2.10.1?\n Release date: TBA\n \n \n-\n What's New in astroid 2.10.0?\n =============================\n Release date: 2022-02-27\ndiff --git a/astroid/const.py b/astroid/const.py\nindex 93bf19e13a..74b97cfb7c 100644\n--- a/astroid/const.py\n+++ b/astroid/const.py\n@@ -1,4 +1,5 @@\n import enum\n+import platform\n import sys\n \n PY36 = sys.version_info[:2] == (3, 6)\n@@ -11,6 +12,8 @@\n \n WIN32 = sys.platform == \"win32\"\n \n+IMPLEMENTATION_PYPY = platform.python_implementation() == \"PyPy\"\n+\n \n class Context(enum.Enum):\n     Load = 1\ndiff --git a/astroid/nodes/scoped_nodes/scoped_nodes.py b/astroid/nodes/scoped_nodes/scoped_nodes.py\nindex 182ec8f4a1..a8dcf3549f 100644\n--- a/astroid/nodes/scoped_nodes/scoped_nodes.py\n+++ b/astroid/nodes/scoped_nodes/scoped_nodes.py\n@@ -386,7 +386,7 @@ class Module(LocalsDictNodeNG):\n     <Module l.0 at 0x7f23b2e4eda0>\n     \"\"\"\n \n-    _astroid_fields = (\"body\",)\n+    _astroid_fields = (\"doc_node\", \"body\")\n \n     fromlineno: Literal[0] = 0\n     \"\"\"The first line that this node appears on in the source code.\"\"\"\n@@ -479,10 +479,14 @@ def __init__(\n         \"\"\"A map of the name of a global variable to the node defining the global.\"\"\"\n \n         self.locals = self.globals = {}\n+        \"\"\"A map of the name of a local variable to the node defining the local.\"\"\"\n \n         self.body: Optional[List[node_classes.NodeNG]] = []\n         \"\"\"The contents of the module.\"\"\"\n \n+        self.doc_node: Optional[Const] = None\n+        \"\"\"The doc node associated with this node.\"\"\"\n+\n         self.future_imports: Set[str] = set()\n         \"\"\"The imports from ``__future__``.\"\"\"\n \n@@ -490,13 +494,15 @@ def __init__(\n \n     # pylint: enable=redefined-builtin\n \n-    def postinit(self, body=None):\n+    def postinit(self, body=None, *, doc_node: Optional[Const] = None):\n         \"\"\"Do some setup after initialisation.\n \n         :param body: The contents of the module.\n         :type body: list(NodeNG) or None\n+        :param doc_node: The doc node associated with this node.\n         \"\"\"\n         self.body = body\n+        self.doc_node = doc_node\n \n     def _get_stream(self):\n         if self.file_bytes is not None:\n@@ -1463,7 +1469,7 @@ class FunctionDef(mixins.MultiLineBlockMixin, node_classes.Statement, Lambda):\n     <FunctionDef.my_func l.2 at 0x7f23b2e71e10>\n     \"\"\"\n \n-    _astroid_fields = (\"decorators\", \"args\", \"returns\", \"body\")\n+    _astroid_fields = (\"decorators\", \"args\", \"returns\", \"doc_node\", \"body\")\n     _multi_line_block_fields = (\"body\",)\n     returns = None\n     decorators: Optional[node_classes.Decorators] = None\n@@ -1549,6 +1555,9 @@ def __init__(\n         :type doc: str or None\n         \"\"\"\n \n+        self.doc_node: Optional[Const] = None\n+        \"\"\"The doc node associated with this node.\"\"\"\n+\n         self.instance_attrs = {}\n         super().__init__(\n             lineno=lineno,\n@@ -1572,6 +1581,7 @@ def postinit(\n         type_comment_args=None,\n         *,\n         position: Optional[Position] = None,\n+        doc_node: Optional[Const] = None,\n     ):\n         \"\"\"Do some setup after initialisation.\n \n@@ -1589,6 +1599,8 @@ def postinit(\n             The args type annotation passed via a type comment.\n         :params position:\n             Position of function keyword(s) and name.\n+        :param doc_node:\n+            The doc node associated with this node.\n         \"\"\"\n         self.args = args\n         self.body = body\n@@ -1597,6 +1609,7 @@ def postinit(\n         self.type_comment_returns = type_comment_returns\n         self.type_comment_args = type_comment_args\n         self.position = position\n+        self.doc_node = doc_node\n \n     @decorators_mod.cachedproperty\n     def extra_decorators(self) -> List[node_classes.Call]:\n@@ -2098,6 +2111,7 @@ def get_wrapping_class(node):\n     return klass\n \n \n+# pylint: disable=too-many-instance-attributes\n class ClassDef(mixins.FilterStmtsMixin, LocalsDictNodeNG, node_classes.Statement):\n     \"\"\"Class representing an :class:`ast.ClassDef` node.\n \n@@ -2115,7 +2129,7 @@ def my_meth(self, arg):\n     # by a raw factories\n \n     # a dictionary of class instances attributes\n-    _astroid_fields = (\"decorators\", \"bases\", \"keywords\", \"body\")  # name\n+    _astroid_fields = (\"decorators\", \"bases\", \"keywords\", \"doc_node\", \"body\")  # name\n \n     decorators = None\n     \"\"\"The decorators that are applied to this class.\n@@ -2217,6 +2231,9 @@ def __init__(\n         :type doc: str or None\n         \"\"\"\n \n+        self.doc_node: Optional[Const] = None\n+        \"\"\"The doc node associated with this node.\"\"\"\n+\n         self.is_dataclass: bool = False\n         \"\"\"Whether this class is a dataclass.\"\"\"\n \n@@ -2258,6 +2275,7 @@ def postinit(\n         keywords=None,\n         *,\n         position: Optional[Position] = None,\n+        doc_node: Optional[Const] = None,\n     ):\n         \"\"\"Do some setup after initialisation.\n \n@@ -2280,6 +2298,8 @@ def postinit(\n         :type keywords: list(Keyword) or None\n \n         :param position: Position of class keyword and name.\n+\n+        :param doc_node: The doc node associated with this node.\n         \"\"\"\n         if keywords is not None:\n             self.keywords = keywords\n@@ -2291,6 +2311,7 @@ def postinit(\n         if metaclass is not None:\n             self._metaclass = metaclass\n         self.position = position\n+        self.doc_node = doc_node\n \n     def _newstyle_impl(self, context=None):\n         if context is None:\ndiff --git a/astroid/rebuilder.py b/astroid/rebuilder.py\nindex 7a025e8fac..141494ea72 100644\n--- a/astroid/rebuilder.py\n+++ b/astroid/rebuilder.py\n@@ -33,6 +33,7 @@\n \n import sys\n import token\n+import tokenize\n from io import StringIO\n from tokenize import TokenInfo, generate_tokens\n from typing import (\n@@ -42,6 +43,7 @@\n     Generator,\n     List,\n     Optional,\n+    Set,\n     Tuple,\n     Type,\n     TypeVar,\n@@ -52,7 +54,7 @@\n \n from astroid import nodes\n from astroid._ast import ParserModule, get_parser_module, parse_function_type_comment\n-from astroid.const import PY36, PY38, PY38_PLUS, Context\n+from astroid.const import IMPLEMENTATION_PYPY, PY36, PY38, PY38_PLUS, Context\n from astroid.manager import AstroidManager\n from astroid.nodes import NodeNG\n from astroid.nodes.utils import Position\n@@ -86,6 +88,7 @@\n T_Function = TypeVar(\"T_Function\", nodes.FunctionDef, nodes.AsyncFunctionDef)\n T_For = TypeVar(\"T_For\", nodes.For, nodes.AsyncFor)\n T_With = TypeVar(\"T_With\", nodes.With, nodes.AsyncWith)\n+NodesWithDocsType = Union[nodes.Module, nodes.ClassDef, nodes.FunctionDef]\n \n \n # noinspection PyMethodMayBeStatic\n@@ -113,7 +116,10 @@ def __init__(\n             self._parser_module = parser_module\n         self._module = self._parser_module.module\n \n-    def _get_doc(self, node: T_Doc) -> Tuple[T_Doc, Optional[str]]:\n+    def _get_doc(\n+        self, node: T_Doc\n+    ) -> Tuple[T_Doc, Optional[\"ast.Constant | ast.Str\"], Optional[str]]:\n+        \"\"\"Return the doc ast node and the actual docstring.\"\"\"\n         try:\n             if node.body and isinstance(node.body[0], self._module.Expr):\n                 first_value = node.body[0].value\n@@ -122,12 +128,17 @@ def _get_doc(self, node: T_Doc) -> Tuple[T_Doc, Optional[str]]:\n                     and isinstance(first_value, self._module.Constant)\n                     and isinstance(first_value.value, str)\n                 ):\n+                    doc_ast_node = first_value\n                     doc = first_value.value if PY38_PLUS else first_value.s\n                     node.body = node.body[1:]\n-                    return node, doc\n+                    # The ast parser of python < 3.8 sets col_offset of multi-line strings to -1\n+                    # as it is unable to determine the value correctly. We reset this to None.\n+                    if doc_ast_node.col_offset == -1:\n+                        doc_ast_node.col_offset = None\n+                    return node, doc_ast_node, doc\n         except IndexError:\n             pass  # ast built from scratch\n-        return node, None\n+        return node, None, None\n \n     def _get_context(\n         self,\n@@ -198,12 +209,68 @@ def _get_position_info(\n \n         # pylint: disable=undefined-loop-variable\n         return Position(\n-            lineno=node.lineno - 1 + start_token.start[0],\n+            lineno=node.lineno + start_token.start[0] - 1,\n             col_offset=start_token.start[1],\n-            end_lineno=node.lineno - 1 + t.end[0],\n+            end_lineno=node.lineno + t.end[0] - 1,\n             end_col_offset=t.end[1],\n         )\n \n+    def _fix_doc_node_position(self, node: NodesWithDocsType) -> None:\n+        \"\"\"Fix start and end position of doc nodes for Python < 3.8.\"\"\"\n+        if not self._data or not node.doc_node or node.lineno is None:\n+            return\n+        if PY38_PLUS:\n+            return\n+\n+        lineno = node.lineno or 1  # lineno of modules is 0\n+        end_range: Optional[int] = node.doc_node.lineno\n+        if IMPLEMENTATION_PYPY:\n+            end_range = None\n+        # pylint: disable-next=unsubscriptable-object\n+        data = \"\\n\".join(self._data[lineno - 1 : end_range])\n+\n+        found_start, found_end = False, False\n+        open_brackets = 0\n+        skip_token: Set[int] = {token.NEWLINE, token.INDENT}\n+        if PY36:\n+            skip_token.update((tokenize.NL, tokenize.COMMENT))\n+        else:\n+            # token.NL and token.COMMENT were added in 3.7\n+            skip_token.update((token.NL, token.COMMENT))\n+\n+        if isinstance(node, nodes.Module):\n+            found_end = True\n+\n+        for t in generate_tokens(StringIO(data).readline):\n+            if found_end is False:\n+                if (\n+                    found_start is False\n+                    and t.type == token.NAME\n+                    and t.string in {\"def\", \"class\"}\n+                ):\n+                    found_start = True\n+                elif found_start is True and t.type == token.OP:\n+                    if t.exact_type == token.COLON and open_brackets == 0:\n+                        found_end = True\n+                    elif t.exact_type == token.LPAR:\n+                        open_brackets += 1\n+                    elif t.exact_type == token.RPAR:\n+                        open_brackets -= 1\n+                continue\n+            if t.type in skip_token:\n+                continue\n+            if t.type == token.STRING:\n+                break\n+            return\n+        else:\n+            return\n+\n+        # pylint: disable=undefined-loop-variable\n+        node.doc_node.lineno = lineno + t.start[0] - 1\n+        node.doc_node.col_offset = t.start[1]\n+        node.doc_node.end_lineno = lineno + t.end[0] - 1\n+        node.doc_node.end_col_offset = t.end[1]\n+\n     def visit_module(\n         self, node: \"ast.Module\", modname: str, modpath: str, package: bool\n     ) -> nodes.Module:\n@@ -211,7 +278,7 @@ def visit_module(\n \n         Note: Method not called by 'visit'\n         \"\"\"\n-        node, doc = self._get_doc(node)\n+        node, doc_ast_node, doc = self._get_doc(node)\n         newnode = nodes.Module(\n             name=modname,\n             doc=doc,\n@@ -220,7 +287,11 @@ def visit_module(\n             package=package,\n             parent=None,\n         )\n-        newnode.postinit([self.visit(child, newnode) for child in node.body])\n+        newnode.postinit(\n+            [self.visit(child, newnode) for child in node.body],\n+            doc_node=self.visit(doc_ast_node, newnode),\n+        )\n+        self._fix_doc_node_position(newnode)\n         return newnode\n \n     if sys.version_info >= (3, 10):\n@@ -1242,7 +1313,7 @@ def visit_classdef(\n         self, node: \"ast.ClassDef\", parent: NodeNG, newstyle: bool = True\n     ) -> nodes.ClassDef:\n         \"\"\"visit a ClassDef node to become astroid\"\"\"\n-        node, doc = self._get_doc(node)\n+        node, doc_ast_node, doc = self._get_doc(node)\n         if sys.version_info >= (3, 8):\n             newnode = nodes.ClassDef(\n                 name=node.name,\n@@ -1275,7 +1346,9 @@ def visit_classdef(\n                 if kwd.arg != \"metaclass\"\n             ],\n             position=self._get_position_info(node, newnode),\n+            doc_node=self.visit(doc_ast_node, newnode),\n         )\n+        self._fix_doc_node_position(newnode)\n         return newnode\n \n     def visit_continue(self, node: \"ast.Continue\", parent: NodeNG) -> nodes.Continue:\n@@ -1580,7 +1653,7 @@ def _visit_functiondef(\n     ) -> T_Function:\n         \"\"\"visit an FunctionDef node to become astroid\"\"\"\n         self._global_names.append({})\n-        node, doc = self._get_doc(node)\n+        node, doc_ast_node, doc = self._get_doc(node)\n \n         lineno = node.lineno\n         if PY38_PLUS and node.decorator_list:\n@@ -1624,7 +1697,9 @@ def _visit_functiondef(\n             type_comment_returns=type_comment_returns,\n             type_comment_args=type_comment_args,\n             position=self._get_position_info(node, newnode),\n+            doc_node=self.visit(doc_ast_node, newnode),\n         )\n+        self._fix_doc_node_position(newnode)\n         self._global_names.pop()\n         return newnode\n \n",
  "problem_statement": "Impossible to get correct line number for the docstrings\n# Current behavior: \r\n\r\nRemoving the first `ast.Expr` from the tree to populate `.doc` property makes it impossible to get correct line number for the docstirng. \r\n\r\nWe ca start a module docstring at the line 3:\r\n\r\n```\r\n#!/usr/bin/env python3\r\n\r\n\"\"\"module docstring\"\"\"\r\n...\r\n```\r\n\r\nMaybe there is a workaround that I did find, but it looks like the constant node information is lost. \r\n\r\nThe core of the issue lies down in the `TreeRebuilder._get_doc()` method. \r\n\r\nhttps://github.com/PyCQA/astroid/blob/82bf77d54393a52ecd07d50a791f5e1a63369f11/astroid/rebuilder.py#L122\r\n\r\n# Expected behavior: \r\n\r\nThe expected behaviour, in my opinion is not to remove the `Expr` node from the container such that users can use correct line numbers and report docstring warnings with better accuracy. \r\n\r\nAstroid version: 2.9.3\n",
  "pull_number": 1276,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_nodes.py b/tests/unittest_nodes.py\nindex 1ac896fc02..a7735c5c6e 100644\n--- a/tests/unittest_nodes.py\n+++ b/tests/unittest_nodes.py\n@@ -1596,23 +1596,32 @@ class SomeClass:\n \n \n def test_get_doc() -> None:\n-    node = astroid.extract_node(\n-        \"\"\"\n+    code = textwrap.dedent(\n+        \"\"\"\\\n     def func():\n         \"Docstring\"\n         return 1\n     \"\"\"\n     )\n+    node: nodes.FunctionDef = astroid.extract_node(code)  # type: ignore[assignment]\n     assert node.doc == \"Docstring\"\n-\n-    node = astroid.extract_node(\n-        \"\"\"\n+    assert isinstance(node.doc_node, nodes.Const)\n+    assert node.doc_node.value == \"Docstring\"\n+    assert node.doc_node.lineno == 2\n+    assert node.doc_node.col_offset == 4\n+    assert node.doc_node.end_lineno == 2\n+    assert node.doc_node.end_col_offset == 15\n+\n+    code = textwrap.dedent(\n+        \"\"\"\\\n     def func():\n         ...\n         return 1\n     \"\"\"\n     )\n+    node = astroid.extract_node(code)\n     assert node.doc is None\n+    assert node.doc_node is None\n \n \n @test_utils.require_version(minver=\"3.8\")\ndiff --git a/tests/unittest_scoped_nodes.py b/tests/unittest_scoped_nodes.py\nindex 9a156781dc..6a95385cec 100644\n--- a/tests/unittest_scoped_nodes.py\n+++ b/tests/unittest_scoped_nodes.py\n@@ -295,6 +295,69 @@ def test_stream_api(self) -> None:\n             with open(path, \"rb\") as file_io:\n                 self.assertEqual(stream.read(), file_io.read())\n \n+    @staticmethod\n+    def test_singleline_docstring() -> None:\n+        data = textwrap.dedent(\n+            \"\"\"\\\n+            '''Hello World'''\n+            foo = 1\n+        \"\"\"\n+        )\n+        module = builder.parse(data, __name__)\n+        assert isinstance(module.doc_node, nodes.Const)\n+        assert module.doc_node.lineno == 1\n+        assert module.doc_node.col_offset == 0\n+        assert module.doc_node.end_lineno == 1\n+        assert module.doc_node.end_col_offset == 17\n+\n+    @staticmethod\n+    def test_multiline_docstring() -> None:\n+        data = textwrap.dedent(\n+            \"\"\"\\\n+            '''Hello World\n+\n+            Also on this line.\n+            '''\n+            foo = 1\n+        \"\"\"\n+        )\n+        module = builder.parse(data, __name__)\n+\n+        assert isinstance(module.doc_node, nodes.Const)\n+        assert module.doc_node.lineno == 1\n+        assert module.doc_node.col_offset == 0\n+        assert module.doc_node.end_lineno == 4\n+        assert module.doc_node.end_col_offset == 3\n+\n+    @staticmethod\n+    def test_comment_before_docstring() -> None:\n+        data = textwrap.dedent(\n+            \"\"\"\\\n+            # Some comment\n+            '''This is\n+\n+            a multiline docstring.\n+            '''\n+        \"\"\"\n+        )\n+        module = builder.parse(data, __name__)\n+\n+        assert isinstance(module.doc_node, nodes.Const)\n+        assert module.doc_node.lineno == 2\n+        assert module.doc_node.col_offset == 0\n+        assert module.doc_node.end_lineno == 5\n+        assert module.doc_node.end_col_offset == 3\n+\n+    @staticmethod\n+    def test_without_docstring() -> None:\n+        data = textwrap.dedent(\n+            \"\"\"\\\n+            foo = 1\n+        \"\"\"\n+        )\n+        module = builder.parse(data, __name__)\n+        assert module.doc_node is None\n+\n \n class FunctionNodeTest(ModuleLoader, unittest.TestCase):\n     def test_special_attributes(self) -> None:\n@@ -752,6 +815,118 @@ def test(cls):\n         self.assertIsInstance(inferred, nodes.ClassDef)\n         self.assertEqual(inferred.name, \"MyClass\")\n \n+    @staticmethod\n+    def test_singleline_docstring() -> None:\n+        code = textwrap.dedent(\n+            \"\"\"\\\n+            def foo():\n+                '''Hello World'''\n+                bar = 1\n+        \"\"\"\n+        )\n+        func: nodes.FunctionDef = builder.extract_node(code)  # type: ignore[assignment]\n+\n+        assert isinstance(func.doc_node, nodes.Const)\n+        assert func.doc_node.lineno == 2\n+        assert func.doc_node.col_offset == 4\n+        assert func.doc_node.end_lineno == 2\n+        assert func.doc_node.end_col_offset == 21\n+\n+    @staticmethod\n+    def test_multiline_docstring() -> None:\n+        code = textwrap.dedent(\n+            \"\"\"\\\n+            def foo():\n+                '''Hello World\n+\n+                Also on this line.\n+                '''\n+                bar = 1\n+        \"\"\"\n+        )\n+        func: nodes.FunctionDef = builder.extract_node(code)  # type: ignore[assignment]\n+\n+        assert isinstance(func.doc_node, nodes.Const)\n+        assert func.doc_node.lineno == 2\n+        assert func.doc_node.col_offset == 4\n+        assert func.doc_node.end_lineno == 5\n+        assert func.doc_node.end_col_offset == 7\n+\n+    @staticmethod\n+    def test_multiline_docstring_async() -> None:\n+        code = textwrap.dedent(\n+            \"\"\"\\\n+            async def foo(var: tuple = ()):\n+                '''Hello\n+\n+                World\n+                '''\n+        \"\"\"\n+        )\n+        func: nodes.FunctionDef = builder.extract_node(code)  # type: ignore[assignment]\n+\n+        assert isinstance(func.doc_node, nodes.Const)\n+        assert func.doc_node.lineno == 2\n+        assert func.doc_node.col_offset == 4\n+        assert func.doc_node.end_lineno == 5\n+        assert func.doc_node.end_col_offset == 7\n+\n+    @staticmethod\n+    def test_docstring_special_cases() -> None:\n+        code = textwrap.dedent(\n+            \"\"\"\\\n+        def f1(var: tuple = ()):  #@\n+            'Hello World'\n+\n+        def f2() -> \"just some comment with an open bracket(\":  #@\n+            'Hello World'\n+\n+        def f3() -> \"Another comment with a colon: \":  #@\n+            'Hello World'\n+\n+        def f4():  #@\n+            # It should work with comments too\n+            'Hello World'\n+        \"\"\"\n+        )\n+        ast_nodes: List[nodes.FunctionDef] = builder.extract_node(code)  # type: ignore[assignment]\n+        assert len(ast_nodes) == 4\n+\n+        assert isinstance(ast_nodes[0].doc_node, nodes.Const)\n+        assert ast_nodes[0].doc_node.lineno == 2\n+        assert ast_nodes[0].doc_node.col_offset == 4\n+        assert ast_nodes[0].doc_node.end_lineno == 2\n+        assert ast_nodes[0].doc_node.end_col_offset == 17\n+\n+        assert isinstance(ast_nodes[1].doc_node, nodes.Const)\n+        assert ast_nodes[1].doc_node.lineno == 5\n+        assert ast_nodes[1].doc_node.col_offset == 4\n+        assert ast_nodes[1].doc_node.end_lineno == 5\n+        assert ast_nodes[1].doc_node.end_col_offset == 17\n+\n+        assert isinstance(ast_nodes[2].doc_node, nodes.Const)\n+        assert ast_nodes[2].doc_node.lineno == 8\n+        assert ast_nodes[2].doc_node.col_offset == 4\n+        assert ast_nodes[2].doc_node.end_lineno == 8\n+        assert ast_nodes[2].doc_node.end_col_offset == 17\n+\n+        assert isinstance(ast_nodes[3].doc_node, nodes.Const)\n+        assert ast_nodes[3].doc_node.lineno == 12\n+        assert ast_nodes[3].doc_node.col_offset == 4\n+        assert ast_nodes[3].doc_node.end_lineno == 12\n+        assert ast_nodes[3].doc_node.end_col_offset == 17\n+\n+    @staticmethod\n+    def test_without_docstring() -> None:\n+        code = textwrap.dedent(\n+            \"\"\"\\\n+            def foo():\n+                bar = 1\n+        \"\"\"\n+        )\n+        func: nodes.FunctionDef = builder.extract_node(code)  # type: ignore[assignment]\n+        assert func.doc_node is None\n+\n \n class ClassNodeTest(ModuleLoader, unittest.TestCase):\n     def test_dict_interface(self) -> None:\n@@ -2088,6 +2263,52 @@ def update(self):\n         # Should not crash\n         builder.parse(data)\n \n+    @staticmethod\n+    def test_singleline_docstring() -> None:\n+        code = textwrap.dedent(\n+            \"\"\"\\\n+            class Foo:\n+                '''Hello World'''\n+                bar = 1\n+        \"\"\"\n+        )\n+        node: nodes.ClassDef = builder.extract_node(code)  # type: ignore[assignment]\n+        assert isinstance(node.doc_node, nodes.Const)\n+        assert node.doc_node.lineno == 2\n+        assert node.doc_node.col_offset == 4\n+        assert node.doc_node.end_lineno == 2\n+        assert node.doc_node.end_col_offset == 21\n+\n+    @staticmethod\n+    def test_multiline_docstring() -> None:\n+        code = textwrap.dedent(\n+            \"\"\"\\\n+            class Foo:\n+                '''Hello World\n+\n+                Also on this line.\n+                '''\n+                bar = 1\n+        \"\"\"\n+        )\n+        node: nodes.ClassDef = builder.extract_node(code)  # type: ignore[assignment]\n+        assert isinstance(node.doc_node, nodes.Const)\n+        assert node.doc_node.lineno == 2\n+        assert node.doc_node.col_offset == 4\n+        assert node.doc_node.end_lineno == 5\n+        assert node.doc_node.end_col_offset == 7\n+\n+    @staticmethod\n+    def test_without_docstring() -> None:\n+        code = textwrap.dedent(\n+            \"\"\"\\\n+            class Foo:\n+                bar = 1\n+        \"\"\"\n+        )\n+        node: nodes.ClassDef = builder.extract_node(code)  # type: ignore[assignment]\n+        assert node.doc_node is None\n+\n \n def test_issue940_metaclass_subclass_property() -> None:\n     node = builder.extract_node(\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/56f5f055e4847e9fc2b74162ccad8f2a11db3bfc"
}