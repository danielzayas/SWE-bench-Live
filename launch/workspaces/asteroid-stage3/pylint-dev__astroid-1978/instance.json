{
  "all_hints_text": "This seems very similar to https://github.com/PyCQA/astroid/pull/1514 that was fixed in 2.12.0.\nI'm running 2.12.13 (> 2.12.0), so the fix isn't working in this case?\nI don't know why #1514 did not fix this, I think we were capturing both stdout and stderr, so this will need some investigation. My guess would be that there's somewhere else to apply the same method to.\nHello, \r\nI see the same error with pylint on our tool [demcompare](https://github.com/CNES/demcompare). Pylint version:\r\n```\r\npylint --version\r\npylint 2.15.9\r\nastroid 2.12.13\r\nPython 3.8.10 (default, Nov 14 2022, 12:59:47) \r\n[GCC 9.4.0]\r\n```\r\nI confirm the weird astroid lower warning and I don't know how to bypass it with pylint checking. \r\n\r\n```\r\npylint demcompare \r\n/home/duboise/work/src/demcompare/venv/lib/python3.8/site-packages/astroid/raw_building.py:470: FutureWarning: In the future `np.long` will be defined as the corresponding NumPy scalar.  (This may have returned Python scalars in past versions.\r\n  getattr(sys.modules[modname], name)\r\n... (four times)\r\n```\r\n\r\nThanks in advance if there is a solution\r\nCordially\r\n\n> Thanks in advance if there is a solution\r\n\r\nwhile annoying the warning does not make pylint fail. Just ignore it. In a CI you can just check pylint return code. It will return 0 as expected\nI agree, even if annoying because it feels our code as a problem somewhere, the CI with pylint doesn't fail indeed. Thanks for the answer that confirm to not bother for now. \nThat might be fine in a CI environment, but for users, ultimately, ignoring warnings becomes difficult when there are too many such warnings. I would like to see this fixed.\nOh, it was not an argument in favour of not fixing it. It was just to point out that it is not a breaking problem. It is \"just\" a lot of quite annoying warnings. I am following the issue because it annoys me too. So I am in the same \"I hope they will fix it\" boat\n> I don't know why https://github.com/PyCQA/astroid/pull/1514 did not fix this, I think we were capturing both stdout and stderr, so this will need some investigation. My guess would be that there's somewhere else to apply the same method to.\r\n\r\nThat PR only addressed import-time. This `FutureWarning` is emitted by numpy's package-level `__getattr__` method, not during import.\n\n",
  "base_commit": "0c9ab0fe56703fa83c73e514a1020d398d23fa7f",
  "commit_urls": [
    "https://github.com/pylint-dev/astroid/commit/a286c236c820102fbfa09c5d8414d49b4b9fd264",
    "https://github.com/pylint-dev/astroid/commit/e2ddcfd0d4551c90a29818b53c93bb8267a10866",
    "https://github.com/pylint-dev/astroid/commit/53833c608e1725371e6e9c040963a08285d10f5f",
    "https://github.com/pylint-dev/astroid/commit/d2ef224b7bf25fcdcea7777175e56bdfba181ee1",
    "https://github.com/pylint-dev/astroid/commit/1c9871d8a3b21c33e102c3bc9af8fe533e2d4469",
    "https://github.com/pylint-dev/astroid/commit/8acf35fd6b5cb18b32c2ec0ea7f27a440f235f23",
    "https://github.com/pylint-dev/astroid/commit/2976af442005d16905bb1a8d9168a0bbb0c4687b",
    "https://github.com/pylint-dev/astroid/commit/8756269dca39ff49243de5bf7b62dfcb970cf1a1"
  ],
  "created_at": "2023-01-28T06:14:39Z",
  "hints_text": "This seems very similar to https://github.com/PyCQA/astroid/pull/1514 that was fixed in 2.12.0.\nI'm running 2.12.13 (> 2.12.0), so the fix isn't working in this case?\nI don't know why #1514 did not fix this, I think we were capturing both stdout and stderr, so this will need some investigation. My guess would be that there's somewhere else to apply the same method to.\nHello, \r\nI see the same error with pylint on our tool [demcompare](https://github.com/CNES/demcompare). Pylint version:\r\n```\r\npylint --version\r\npylint 2.15.9\r\nastroid 2.12.13\r\nPython 3.8.10 (default, Nov 14 2022, 12:59:47) \r\n[GCC 9.4.0]\r\n```\r\nI confirm the weird astroid lower warning and I don't know how to bypass it with pylint checking. \r\n\r\n```\r\npylint demcompare \r\n/home/duboise/work/src/demcompare/venv/lib/python3.8/site-packages/astroid/raw_building.py:470: FutureWarning: In the future `np.long` will be defined as the corresponding NumPy scalar.  (This may have returned Python scalars in past versions.\r\n  getattr(sys.modules[modname], name)\r\n... (four times)\r\n```\r\n\r\nThanks in advance if there is a solution\r\nCordially\r\n\n> Thanks in advance if there is a solution\r\n\r\nwhile annoying the warning does not make pylint fail. Just ignore it. In a CI you can just check pylint return code. It will return 0 as expected\nI agree, even if annoying because it feels our code as a problem somewhere, the CI with pylint doesn't fail indeed. Thanks for the answer that confirm to not bother for now. \nThat might be fine in a CI environment, but for users, ultimately, ignoring warnings becomes difficult when there are too many such warnings. I would like to see this fixed.\nOh, it was not an argument in favour of not fixing it. It was just to point out that it is not a breaking problem. It is \"just\" a lot of quite annoying warnings. I am following the issue because it annoys me too. So I am in the same \"I hope they will fix it\" boat\n> I don't know why https://github.com/PyCQA/astroid/pull/1514 did not fix this, I think we were capturing both stdout and stderr, so this will need some investigation. My guess would be that there's somewhere else to apply the same method to.\r\n\r\nThat PR only addressed import-time. This `FutureWarning` is emitted by numpy's package-level `__getattr__` method, not during import.\n\n",
  "instance_id": "pylint-dev__astroid-1978",
  "issue_numbers": [
    1904
  ],
  "language": "python",
  "patch": "diff --git a/astroid/raw_building.py b/astroid/raw_building.py\nindex cc3aa01525..8575f41e24 100644\n--- a/astroid/raw_building.py\n+++ b/astroid/raw_building.py\n@@ -10,11 +10,14 @@\n \n import builtins\n import inspect\n+import io\n+import logging\n import os\n import sys\n import types\n import warnings\n from collections.abc import Iterable\n+from contextlib import redirect_stderr, redirect_stdout\n from typing import Any, Union\n \n from astroid import bases, nodes\n@@ -22,6 +25,9 @@\n from astroid.manager import AstroidManager\n from astroid.nodes import node_classes\n \n+logger = logging.getLogger(__name__)\n+\n+\n _FunctionTypes = Union[\n     types.FunctionType,\n     types.MethodType,\n@@ -471,7 +477,26 @@ def imported_member(self, node, member, name: str) -> bool:\n             # check if it sounds valid and then add an import node, else use a\n             # dummy node\n             try:\n-                getattr(sys.modules[modname], name)\n+                with redirect_stderr(io.StringIO()) as stderr, redirect_stdout(\n+                    io.StringIO()\n+                ) as stdout:\n+                    getattr(sys.modules[modname], name)\n+                    stderr_value = stderr.getvalue()\n+                    if stderr_value:\n+                        logger.error(\n+                            \"Captured stderr while getting %s from %s:\\n%s\",\n+                            name,\n+                            sys.modules[modname],\n+                            stderr_value,\n+                        )\n+                    stdout_value = stdout.getvalue()\n+                    if stdout_value:\n+                        logger.info(\n+                            \"Captured stdout while getting %s from %s:\\n%s\",\n+                            name,\n+                            sys.modules[modname],\n+                            stdout_value,\n+                        )\n             except (KeyError, AttributeError):\n                 attach_dummy_node(node, name, member)\n             else:\n",
  "problem_statement": "Deprecation warnings from numpy\n### Steps to reproduce\r\n\r\n1. Run pylint over the following test case:\r\n\r\n```\r\n\"\"\"Test case\"\"\"\r\n\r\nimport numpy as np\r\nvalue = np.random.seed(1234)\r\n```\r\n\r\n### Current behavior\r\n```\r\n/home/bje/source/nemo/myenv/lib/python3.10/site-packages/astroid/raw_building.py:470: FutureWarning: In the future `np.long` will be defined as the corresponding NumPy scalar.  (This may have returned Python scalars in past versions.\r\n  getattr(sys.modules[modname], name)\r\n/home/bje/source/nemo/myenv/lib/python3.10/site-packages/astroid/raw_building.py:470: FutureWarning: In the future `np.long` will be defined as the corresponding NumPy scalar.  (This may have returned Python scalars in past versions.\r\n  getattr(sys.modules[modname], name)\r\n```\r\n\r\n### Expected behavior\r\nThere should be no future warnings.\r\n\r\n### python -c \"from astroid import __pkginfo__; print(__pkginfo__.version)\" output\r\n2.12.13\n",
  "pull_number": 1978,
  "repo": "pylint-dev/astroid",
  "test_patch": "diff --git a/tests/unittest_raw_building.py b/tests/unittest_raw_building.py\nindex 64c2272711..ad0f0af7a3 100644\n--- a/tests/unittest_raw_building.py\n+++ b/tests/unittest_raw_building.py\n@@ -8,8 +8,15 @@\n # For details: https://github.com/PyCQA/astroid/blob/main/LICENSE\n # Copyright (c) https://github.com/PyCQA/astroid/blob/main/CONTRIBUTORS.txt\n \n+from __future__ import annotations\n+\n+import logging\n+import os\n+import sys\n import types\n import unittest\n+from typing import Any\n+from unittest import mock\n \n import _io\n import pytest\n@@ -117,5 +124,45 @@ def test_module_object_with_broken_getattr(self) -> None:\n         AstroidBuilder().inspect_build(fm_getattr, \"test\")\n \n \n+@pytest.mark.skipif(\n+    \"posix\" not in sys.builtin_module_names, reason=\"Platform doesn't support posix\"\n+)\n+def test_build_module_getattr_catch_output(\n+    capsys: pytest.CaptureFixture[str],\n+    caplog: pytest.LogCaptureFixture,\n+) -> None:\n+    \"\"\"Catch stdout and stderr in module __getattr__ calls when building a module.\n+\n+    Usually raised by DeprecationWarning or FutureWarning.\n+    \"\"\"\n+    caplog.set_level(logging.INFO)\n+    original_sys = sys.modules\n+    original_module = sys.modules[\"posix\"]\n+    expected_out = \"INFO (TEST): Welcome to posix!\"\n+    expected_err = \"WARNING (TEST): Monkey-patched version of posix - module getattr\"\n+\n+    class CustomGetattr:\n+        def __getattr__(self, name: str) -> Any:\n+            print(f\"{expected_out}\")\n+            print(expected_err, file=sys.stderr)\n+            return getattr(original_module, name)\n+\n+    def mocked_sys_modules_getitem(name: str) -> types.ModuleType | CustomGetattr:\n+        if name != \"posix\":\n+            return original_sys[name]\n+        return CustomGetattr()\n+\n+    with mock.patch(\"astroid.raw_building.sys.modules\") as sys_mock:\n+        sys_mock.__getitem__.side_effect = mocked_sys_modules_getitem\n+        builder = AstroidBuilder()\n+        builder.inspect_build(os)\n+\n+    out, err = capsys.readouterr()\n+    assert expected_out in caplog.text\n+    assert expected_err in caplog.text\n+    assert not out\n+    assert not err\n+\n+\n if __name__ == \"__main__\":\n     unittest.main()\n",
  "commit_url": "https://github.com/pylint-dev/astroid/tree/0c9ab0fe56703fa83c73e514a1020d398d23fa7f"
}